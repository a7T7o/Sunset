# 补丁004V2 验收指南（V4）

> 基于 designV4 模块 H/I/J/K/L
> 创建时间：2026-02-21

---

## 一、P1 + P2 联动验收：WASD 中断行为

### 测试1：动画执行中 WASD 中断
1. 选择锄头，点击一块空地开始耕地
2. 动画播放过程中按 WASD 移动
3. 预期：动画继续播放完毕，耕地正常创建，执行预览正常消失

### 测试2：导航途中 WASD 中断
1. 选择锄头，点击一块远距离空地（需要导航过去）
2. 导航途中按 WASD 移动
3. 预期：操作被取消，队列预览消失，不残留任何预览

### 测试3：队列操作 + WASD 中断
1. 连续点击 3 块空地入队
2. 第一个动画播放中按 WASD
3. 预期：第一个耕地正常创建，队列中剩余 2 个操作被清空，队列预览消失

---

## 二、P3 验收：Ghost 预览增量差集

### 测试4：水平直接相邻
1. 先耕一块地 A
2. 鼠标移到 A 右边的空地 B
3. 预期：A 的右边界位置只显示增量方向（如 B_R 而非 B_LR），不与 A 已有的边界重叠

### 测试5：斜角直接相邻
1. 先耕一块地 A
2. 鼠标移到 A 右上方的空地 B
3. 预期：共享边界位置只显示增量方向，不重复已有方向

### 测试6：完全新位置
1. 鼠标移到周围没有任何耕地的空地
2. 预期：显示完整的 1+8 预览（中心块 + 边界 + 阴影），与之前行为一致

### 测试7：阴影位置
1. 先耕一块地 A
2. 鼠标移到 A 斜角隔一格的位置（A 的阴影覆盖区域）
3. 预期：ghost 层显示预览 tile 覆盖阴影（Sorting Order 覆盖），视觉正确

---

## 三、P4 验收：canTill=false 红色反馈

### 测试8：已有耕地上
1. 先耕一块地
2. 鼠标移到已耕的中心块上
3. 预期：显示红色方框光标（无 ghost tile）

### 测试9：枯萎作物上
1. 找到一个枯萎的作物
2. 鼠标移到枯萎作物上
3. 预期：显示绿色方框光标（可清除枯萎）

### 测试10：可锄地时
1. 鼠标移到空地上
2. 预期：显示 ghost tile 预览，不显示方框光标（与之前行为一致）

---

## 四、P6 验收：Sorting Order

### 测试11：视觉层级
1. 在已有耕地旁边预览新耕地
2. 预期：ghost 预览 tile 在实际耕地边界之上（绿色叠加色可见），不被遮挡

---

## 五、已知限制

- P5（批量操作预览冲突）：连续快速点击多块相邻空地时，队列预览之间的边界 tile 可能互相覆盖。落地时 `UpdateBorderAt` 会重新计算正确结果，不影响最终效果。
