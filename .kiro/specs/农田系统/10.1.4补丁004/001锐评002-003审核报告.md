# 000é”è¯„002-003 å®¡æ ¸æŠ¥å‘Š

> å®¡æ ¸æ—¶é—´ï¼š2026-02-22ï¼ˆä¼šè¯2ç»­17ï¼‰
> é”è¯„æ¥æºï¼š`000é”è¯„002.md`ï¼ˆGemini æ¬¢ä¹ç‰ˆï¼‰ã€`000é”è¯„003.md`ï¼ˆGemini è®¤çœŸç‰ˆï¼‰
> å®¡æ ¸å¯¹è±¡ï¼šä¸¤ä»½é”è¯„å‡æ˜¯å¯¹ `000é”è¯„001å®¡è§†æŠ¥å‘Š.md`ï¼ˆV5.1 æ–¹æ¡ˆï¼‰çš„å›žåº”
> è·¯å¾„åˆ¤æ–­ï¼šðŸŸ¢ è·¯å¾„ Aï¼ˆå…¨éƒ¨ âœ…ï¼Œæ— å¼‚è®®ï¼‰â€” é”è¯„002 ä»£ç æ–¹æ¡ˆåŸºæœ¬å‡†ç¡®ï¼Œé”è¯„003 å‘çŽ°çš„æž¯èŽä½œç‰©æ¼æ´žçœŸå®žå­˜åœ¨

---

## ä¸€ã€é”è¯„002 æ ¸å¿ƒå†…å®¹

Gemini å¯¹ V5.1 æ–¹æ¡ˆé«˜åº¦è®¤å¯ï¼Œç›´æŽ¥æä¾›äº†ä¸‰å¤§æ–¹æ³•çš„ç²¾ç¡®ä»£ç æ›¿æ¢æ–¹æ¡ˆï¼š

1. `UpdateHoePreview`ï¼šcanTill æ‹¦æˆª b å±‚ + canTill=false å…¨é‡é“º 1+8 + åºŸå¼ƒç™½æ¡† + shader æŸ“è‰²
2. `UpdateWateringPreview`ï¼šcanWater æ‹¦æˆª b å±‚ + æ— è®º isValid éƒ½æ”¾ç½®æ°´æ¸ tile + shader æŸ“è‰²
3. `UpdateSeedPreview`ï¼šcanPlant æ‹¦æˆª b å±‚

## äºŒã€é”è¯„003 æ ¸å¿ƒå†…å®¹

å‘çŽ°ä¸€ä¸ªéšè”½çš„"å¹½çµ Bug"ï¼šæž¯èŽä½œç‰©çš„åŒé‡æ¼ç½‘ä¹‹é±¼ã€‚

åœºæ™¯æŽ¨æ¼”ï¼š
1. æž¯èŽä½œç‰©æ‰€åœ¨æ ¼å­å·²å…¥é˜Ÿ â†’ `queuePreviewPositions` åŒ…å«è¯¥ä½ç½®
2. `CanTillAt` è¿”å›ž falseï¼ˆåº•ä¸‹å·²æ˜¯è€•åœ°ï¼‰
3. V5.1 çš„ b å±‚æ‹¦æˆª `if (canTill && queuePreviewPositions.Contains)` â†’ `canTill` å·²ç»æ˜¯ false â†’ **æ‹¦æˆªè¢«è·³è¿‡**
4. `canClearWithered = true`ï¼ˆæž¯èŽä½œç‰©å­˜åœ¨ï¼‰
5. `isValid = true` â†’ ghost æ˜¾ç¤ºç»¿è‰²ï¼Œè§†è§‰è¯¯å¯¼

ä¿®å¤æ–¹æ¡ˆï¼šå°† b å±‚æ‹¦æˆªç§»åˆ° `canTill` å’Œ `canClearWithered` éƒ½è®¡ç®—å®Œä¹‹åŽï¼Œç»Ÿä¸€æ‹¦æˆªã€‚

---

## ä¸‰ã€äº‹å®žæ ¸æŸ¥

### 3.1 é”è¯„002 ä»£ç æ–¹æ¡ˆå‡†ç¡®æ€§

é€ä¸€å¯¹æ¯”é”è¯„002æä¾›çš„ä»£ç ä¸Žå½“å‰å®žé™…ä»£ç ï¼ˆå·²åœ¨å½“å‰ä¼šè¯ä¸­ readFile éªŒè¯ï¼‰ï¼š

#### UpdateHoePreview æ–¹æ¡ˆæ ¸æŸ¥

| é”è¯„002 ä»£ç  | å½“å‰å®žé™…ä»£ç  | æ ¸æŸ¥ç»“è®º |
|-------------|------------|---------|
| `canTill` åˆ¤æ–­åŽå¢žåŠ  `queuePreviewPositions.Contains` æ‹¦æˆª | å½“å‰æ— æ­¤æ‹¦æˆª | âœ… æ–¹å‘æ­£ç¡®ï¼Œä¸Ž V5.1 æ¨¡å— N ä¸€è‡´ |
| canTill=false æ—¶å…¨é‡é“º 1+8ï¼ˆä¸åšå¢žé‡è¿‡æ»¤ï¼‰ | å½“å‰ canTill=false æ—¶åªæ˜¾ç¤º `cursorRenderer` ç™½æ¡† | âœ… æ–¹å‘æ­£ç¡®ï¼Œä¸Ž V5.1 æ¨¡å— O ä¸€è‡´ |
| åºŸå¼ƒ `cursorRenderer`ï¼ˆ`cursorRenderer.enabled = false`ï¼‰ | å½“å‰ canTill=false æ—¶ `cursorRenderer.enabled = true` | âœ… æ–¹å‘æ­£ç¡® |
| `previewOverlayMaterial.SetColor` æ ¹æ® isValid æŸ“è‰² | å½“å‰å·²æœ‰æ­¤é€»è¾‘ï¼ˆç¬¬565è¡Œï¼‰ | âœ… ä¿æŒä¸å˜ |
| canTill=false åˆ†æ”¯è°ƒç”¨ `GetPreviewTiles(layerIndex, cellPos, queuePreviewPositions)` | å½“å‰åªåœ¨ canTill=true åˆ†æ”¯è°ƒç”¨ | âœ… æ–¹å‘æ­£ç¡® |

âš ï¸ ç»†èŠ‚æ³¨æ„ï¼šé”è¯„002 çš„ä»£ç ç¤ºä¾‹ä¸­ `_currentGhostTileData?.Clear()` æ”¾åœ¨ else åˆ†æ”¯å¼€å¤´ï¼Œè¿™ä¸Žå½“å‰ä»£ç ä¸€è‡´ã€‚ä½†é”è¯„002 æ²¡æœ‰å¤„ç† `_hasLoggedPreviewTiles` è¯Šæ–­æ—¥å¿—ï¼Œè¿™æ˜¯å°ç»†èŠ‚ï¼Œä¸å½±å“åŠŸèƒ½ã€‚

#### UpdateWateringPreview æ–¹æ¡ˆæ ¸æŸ¥

| é”è¯„002 ä»£ç  | å½“å‰å®žé™…ä»£ç  | æ ¸æŸ¥ç»“è®º |
|-------------|------------|---------|
| `canWater` åˆ¤æ–­åŽå¢žåŠ  `queuePreviewPositions.Contains` æ‹¦æˆª | å½“å‰æ— æ­¤æ‹¦æˆª | âœ… æ–¹å‘æ­£ç¡®ï¼Œä¸Ž V5.1 æ¨¡å— P ä¸€è‡´ |
| æ— è®º isValid éƒ½æ”¾ç½®æ°´æ¸ tile | å½“å‰åªåœ¨ `if (isValid)` å†…æ”¾ç½® | âœ… æ–¹å‘æ­£ç¡®ï¼Œä¿®å¤ R3 é—æ¼ |
| åºŸå¼ƒ `cursorRenderer` | å½“å‰æµ‡æ°´æ¨¡å¼å·² `cursorRenderer.enabled = false` | âœ… å½“å‰å·²æ­£ç¡® |
| `previewOverlayMaterial.SetColor` æ ¹æ® isValid æŸ“è‰² | å½“å‰å·²æœ‰æ­¤é€»è¾‘ | âœ… ä¿æŒä¸å˜ |

âš ï¸ ç»†èŠ‚æ³¨æ„ï¼šé”è¯„002 å°†æ°´æ¸ tile æ”¾ç½®é€»è¾‘å®Œå…¨æå–åˆ° `if (isValid)` å¤–é¢ï¼ŒåŒ…æ‹¬"è¿›å…¥æ–°æ ¼å­æ‰éšæœº"çš„é€»è¾‘ã€‚å½“å‰ä»£ç ä¸­è¿™æ®µé€»è¾‘åœ¨ `if (isValid)` å†…éƒ¨ã€‚ä¿®æ”¹æ—¶éœ€è¦å°†æ•´ä¸ªæ°´æ¸è®¡ç®—+æ”¾ç½®å—ç§»å‡º `if (isValid)` ä¿æŠ¤åœˆã€‚

#### UpdateSeedPreview æ–¹æ¡ˆæ ¸æŸ¥

| é”è¯„002 ä»£ç  | å½“å‰å®žé™…ä»£ç  | æ ¸æŸ¥ç»“è®º |
|-------------|------------|---------|
| `canPlant` åˆ¤æ–­åŽå¢žåŠ  `queuePreviewPositions.Contains` æ‹¦æˆª | å½“å‰æ— æ­¤æ‹¦æˆª | âœ… æ–¹å‘æ­£ç¡®ï¼Œä¸Ž V5.1 æ¨¡å— P ä¸€è‡´ |
| å…¶ä½™é€»è¾‘ä¿æŒä¸å˜ | â€” | âœ… æ­£ç¡®ï¼Œç§å­é¢„è§ˆä¸éœ€è¦å…¶ä»–æ”¹åŠ¨ |

**é”è¯„002 æ€»ç»“**ï¼šä»£ç æ–¹æ¡ˆä¸Ž V5.1 ä¿®æ­£æ–¹æ¡ˆå®Œå…¨ä¸€è‡´ï¼Œæ–¹å‘å…¨éƒ¨æ­£ç¡®ã€‚ç»†èŠ‚ä¸Šéœ€è¦æ³¨æ„è¯Šæ–­æ—¥å¿—ä¿ç•™å’Œæ°´æ¸é€»è¾‘çš„å®Œæ•´è¿ç§»ã€‚

---

### 3.2 é”è¯„003 æž¯èŽä½œç‰©æ¼æ´žæ ¸æŸ¥

**ä»£ç äº‹å®žéªŒè¯**ï¼ˆåŸºäºŽå½“å‰ `UpdateHoePreview` ç¬¬428-442è¡Œï¼‰ï¼š

```csharp
// ç¬¬428è¡Œ
bool canTill = FarmTileManager.Instance != null && 
               FarmTileManager.Instance.CanTillAt(layerIndex, cellPos);

// ç¬¬433è¡Œ
bool canClearWithered = false;
if (!canTill && FarmTileManager.Instance != null)
{
    var tileData = FarmTileManager.Instance.GetTileData(layerIndex, cellPos);
    if (tileData?.cropController != null && tileData.cropController.GetState() == CropState.WitheredImmature)
        canClearWithered = true;
}

// ç¬¬441è¡Œ
bool isValid = !hasObstacle && (canTill || canClearWithered);
```

**åœºæ™¯æŽ¨æ¼”éªŒè¯**ï¼š

| æ­¥éª¤ | çŠ¶æ€ | ä»£ç è¡Œä¸º | ç»“è®º |
|------|------|---------|------|
| 1. æž¯èŽä½œç‰©æ ¼å­å·²å…¥é˜Ÿ | `queuePreviewPositions` åŒ…å«è¯¥ä½ç½® | â€” | å‰ææˆç«‹ |
| 2. `CanTillAt` æ£€æŸ¥ | åº•ä¸‹å·²æ˜¯è€•åœ° | è¿”å›ž `false` | âœ… `canTill = false` |
| 3. V5.1 b å±‚æ‹¦æˆª | `if (canTill && ...)` | `canTill` å·²æ˜¯ falseï¼ŒçŸ­è·¯è·³è¿‡ | âœ… **æ‹¦æˆªå¤±æ•ˆ** |
| 4. æž¯èŽæ£€æµ‹ | `!canTill` ä¸º trueï¼Œè¿›å…¥æ£€æµ‹ | `canClearWithered = true` | âœ… æ¼ç½‘ |
| 5. æœ€ç»ˆåˆ¤å®š | `isValid = !hasObstacle && (false \|\| true)` | `isValid = true` | âœ… **è§†è§‰è¯¯å¯¼ç¡®è®¤** |

**åŽç«¯é˜²é‡å¤éªŒè¯**ï¼š
- `EnqueueAction` ç¬¬2è¡Œï¼š`_queuedPositions.Contains(key)` â†’ åŒä¸€æ ¼å­ä¸ä¼šçœŸæ­£é‡å¤å…¥é˜Ÿ
- `AddQueuePreview` ç¬¬1è¡Œï¼š`queuePreviewPositions.Contains(cellPos)` â†’ ä¸ä¼šé‡å¤æ·»åŠ é¢„è§ˆ

**æ ¸æŸ¥ç»“è®ºï¼šâœ… é”è¯„003 å®Œå…¨æ­£ç¡®ã€‚**

æ¼æ´žæ€§è´¨ï¼š**è§†è§‰ bug**ï¼ˆghost æ˜¾ç¤ºç»¿è‰²è¯¯å¯¼ï¼‰ï¼Œä¸æ˜¯åŠŸèƒ½ bugï¼ˆåŽç«¯æœ‰é˜²é‡å¤ï¼‰ã€‚ä½†è§†è§‰è¯¯å¯¼ä¼šè®©çŽ©å®¶å›°æƒ‘â€”â€”æ˜Žæ˜Žå·²ç»å…¥é˜Ÿäº†ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¾ç¤ºç»¿è‰²å¯æ“ä½œï¼Ÿ

**é”è¯„003 çš„ä¿®å¤æ–¹æ¡ˆéªŒè¯**ï¼š

```csharp
// é”è¯„003 æ–¹æ¡ˆï¼šç»Ÿä¸€æ‹¦æˆªï¼Œç§»åˆ° canTill å’Œ canClearWithered éƒ½è®¡ç®—å®Œä¹‹åŽ
if (queuePreviewPositions.Contains(cellPos))
{
    canTill = false;
    canClearWithered = false;
}
```

è¿™ä¸ªæ–¹æ¡ˆé€»è¾‘æ­£ç¡®ï¼šæ— è®ºåŽŸæœ¬æ˜¯å¯ä»¥é”„åœ°è¿˜æ˜¯å¯ä»¥æ¸…ç†æž¯èŽï¼Œåªè¦åœ¨é˜Ÿåˆ—é‡Œå°±ç»Ÿç»Ÿæ— æ•ˆã€‚ä½ç½®åœ¨ `canClearWithered` è®¡ç®—ä¹‹åŽã€`isValid` è®¡ç®—ä¹‹å‰ã€‚

---

## å››ã€é‡‡çº³å†³ç­–

| æ¥æº | è§‚ç‚¹ | é‡‡çº³ | è¯´æ˜Ž |
|------|------|------|------|
| é”è¯„002 | UpdateHoePreview ä»£ç æ–¹æ¡ˆ | âœ… é‡‡çº³æ–¹å‘ï¼Œç»†èŠ‚å¾®è°ƒ | éœ€ä¿ç•™è¯Šæ–­æ—¥å¿—ã€æ³¨æ„æ°´æ¸é€»è¾‘å®Œæ•´è¿ç§» |
| é”è¯„002 | UpdateWateringPreview ä»£ç æ–¹æ¡ˆ | âœ… é‡‡çº³æ–¹å‘ï¼Œç»†èŠ‚å¾®è°ƒ | æ°´æ¸æ”¾ç½®ç§»å‡º `if (isValid)` |
| é”è¯„002 | UpdateSeedPreview ä»£ç æ–¹æ¡ˆ | âœ… å®Œå…¨é‡‡çº³ | åªåŠ ä¸€å¤„æ‹¦æˆª |
| é”è¯„003 | æž¯èŽä½œç‰©åŒé‡æ¼ç½‘ä¹‹é±¼ | âœ… å®Œå…¨é‡‡çº³ | çœŸå®žæ¼æ´žï¼Œä¿®å¤æ–¹æ¡ˆæ­£ç¡® |
| é”è¯„003 | ç»Ÿä¸€æ‹¦æˆªä½ç½®ï¼ˆç§»åˆ° canClearWithered ä¹‹åŽï¼‰ | âœ… å®Œå…¨é‡‡çº³ | æ¯” V5.1 åŽŸæ–¹æ¡ˆæ›´ä¸¥å¯† |

---

## äº”ã€æœ€ç»ˆè¯¦ç»†æ–¹æ¡ˆï¼ˆV5.1 ä¿®æ­£ç‰ˆï¼‰

åŸºäºŽ V5.1 + é”è¯„002 ä»£ç æ–¹æ¡ˆ + é”è¯„003 æž¯èŽä½œç‰©ä¿®å¤ï¼Œæ•²å®šæœ€ç»ˆæ–¹æ¡ˆã€‚

### 5.1 UpdateHoePreview ä¿®æ”¹

**ä¿®æ”¹ç‚¹ 1ï¼šb å±‚æ‹¦æˆªä½ç½®è°ƒæ•´ï¼ˆé‡‡çº³é”è¯„003ï¼‰**

åŽŸ V5.1 æ–¹æ¡ˆï¼š
```csharp
if (canTill && queuePreviewPositions.Contains(cellPos))
    canTill = false;
```

æœ€ç»ˆæ–¹æ¡ˆï¼ˆé”è¯„003 ç»Ÿä¸€æ‹¦æˆªï¼‰ï¼š
```csharp
// å…ˆè®¡ç®— canTill å’Œ canClearWitheredï¼ˆä¿æŒåŽŸæœ‰é€»è¾‘ä¸å˜ï¼‰
bool canTill = FarmTileManager.Instance != null && 
               FarmTileManager.Instance.CanTillAt(layerIndex, cellPos);

bool canClearWithered = false;
if (!canTill && FarmTileManager.Instance != null)
{
    var tileData = FarmTileManager.Instance.GetTileData(layerIndex, cellPos);
    if (tileData?.cropController != null && 
        tileData.cropController.GetState() == CropState.WitheredImmature)
        canClearWithered = true;
}

// ðŸ”´ è¡¥ä¸004V5.1 ç»ˆæžæ‹¦æˆªï¼šå·²åœ¨é˜Ÿåˆ—ä¸­çš„æ ¼å­ç»Ÿç»Ÿæ— æ•ˆ
if (queuePreviewPositions.Contains(cellPos))
{
    canTill = false;
    canClearWithered = false;
}

bool isValid = !hasObstacle && (canTill || canClearWithered);
```

**ä¿®æ”¹ç‚¹ 2ï¼šcanTill=false åˆ†æ”¯é‡æž„ï¼ˆé‡‡çº³é”è¯„002 + V5.1 æ¨¡å— Oï¼‰**

å½“å‰ä»£ç ï¼ˆcanTill=false åˆ†æ”¯ï¼Œç¬¬553-564è¡Œï¼‰ï¼š
```csharp
else
{
    _currentGhostTileData?.Clear();
    if (cursorRenderer != null)
    {
        cursorRenderer.enabled = true;
        UpdateCursor(layerIndex, cellPos);
    }
    // è¯Šæ–­æ—¥å¿—...
}
```

æœ€ç»ˆæ–¹æ¡ˆï¼š
```csharp
else
{
    _currentGhostTileData?.Clear();
    
    // ðŸ”´ V5.1 æ¨¡å—Oï¼šcanTill=false ä¹Ÿå…¨é‡æ˜¾ç¤º 1+8 é¢„è§ˆï¼ˆè·³è¿‡å¢žé‡è¿‡æ»¤ï¼‰
    if (FarmlandBorderManager.Instance != null)
    {
        var previewTiles = FarmlandBorderManager.Instance.GetPreviewTiles(
            layerIndex, cellPos, queuePreviewPositions);
        foreach (var kvp in previewTiles)
        {
            if (kvp.Value == null) continue;
            ghostTilemap.SetTile(kvp.Key, kvp.Value);  // ç›´æŽ¥é“ºï¼Œä¸åšå¢žé‡è¿‡æ»¤
            currentPreviewPositions.Add(kvp.Key);
        }
    }
    
    // ðŸ”´ V5.1ï¼šåºŸå¼ƒç™½æ¡†ï¼Œè€•åœ°æ¨¡å¼ä¸å†ä½¿ç”¨ cursorRenderer
    if (cursorRenderer != null)
        cursorRenderer.enabled = false;
    
    if (!_hasLoggedPreviewTiles)
    {
        _hasLoggedPreviewTiles = true;
        Debug.Log($"[FarmToolPreview] canTill=false å…¨é‡é“ºè®¾ 1+8 é¢„è§ˆ");
    }
}
```

**ä¿®æ”¹ç‚¹ 3ï¼šshader æŸ“è‰²ä¿æŒä¸å˜**

å½“å‰ç¬¬565-568è¡Œçš„ `previewOverlayMaterial.SetColor` é€»è¾‘å·²ç»æ­£ç¡®ï¼Œæ ¹æ® `isValid` è®¾ç½®ç»¿è‰²/çº¢è‰²ï¼Œæ— éœ€ä¿®æ”¹ã€‚

---

### 5.2 UpdateWateringPreview ä¿®æ”¹

**ä¿®æ”¹ç‚¹ 1ï¼šcanWater æ‹¦æˆª b å±‚ï¼ˆV5.1 æ¨¡å— Pï¼‰**

åœ¨ `canWater` è®¡ç®—ä¹‹åŽã€`isValid` è®¡ç®—ä¹‹å‰æ’å…¥ï¼š
```csharp
// ðŸ”´ V5.1 æ¨¡å—Pï¼šæµ‡æ°´ ghost çº³å…¥ b å±‚æ£€æŸ¥
if (canWater && queuePreviewPositions.Contains(cellPos))
{
    canWater = false;
}
```

**ä¿®æ”¹ç‚¹ 2ï¼šæ°´æ¸ tile æ”¾ç½®ç§»å‡º `if (isValid)` ä¿æŠ¤åœˆï¼ˆé‡‡çº³é”è¯„002 + V5.1 R3 ä¿®å¤ï¼‰**

å½“å‰ä»£ç ï¼ˆç¬¬637-655è¡Œï¼‰ï¼š
```csharp
if (isValid)
{
    if (cellPos != _lastWateringCellPos)
    {
        // è¿›å…¥æ–°æ ¼å­æ‰éšæœº...
    }
    var tiles = FarmVisualManager.Instance?.GetPuddleTiles();
    if (tiles != null && ...)
    {
        ghostTilemap.SetTile(cellPos, tiles[_cachedPuddleVariant]);
        currentPreviewPositions.Add(cellPos);
    }
}
```

æœ€ç»ˆæ–¹æ¡ˆï¼šå°†æ•´ä¸ªæ°´æ¸è®¡ç®—+æ”¾ç½®å—ç§»å‡º `if (isValid)`ï¼š
```csharp
// ðŸ”´ V5.1ï¼šåºŸå¼ƒæµ‡æ°´æ¨¡å¼çš„æ–¹æ¡†å…‰æ ‡
if (cursorRenderer != null) cursorRenderer.enabled = false;

// ðŸ”´ V5.1 R3 ä¿®å¤ï¼šæ— è®º isValidï¼Œéƒ½è®¡ç®—å¹¶æ”¾ç½®æ°´æ¸ tileï¼ˆä½œä¸º shader è½½ä½“ï¼‰
if (cellPos != _lastWateringCellPos)
{
    var puddleTiles = FarmVisualManager.Instance?.GetPuddleTiles();
    int count = puddleTiles != null ? puddleTiles.Length : 3;
    _cachedPuddleVariant = Random.Range(0, count);
    _lastWateringCellPos = cellPos;
}

var tiles = FarmVisualManager.Instance?.GetPuddleTiles();
if (tiles != null && _cachedPuddleVariant >= 0 && _cachedPuddleVariant < tiles.Length)
{
    ghostTilemap.SetTile(cellPos, tiles[_cachedPuddleVariant]);
    currentPreviewPositions.Add(cellPos);
}
```

**ä¿®æ”¹ç‚¹ 3ï¼šshader æŸ“è‰²ä¿æŒä¸å˜**

å½“å‰çš„ `previewOverlayMaterial.SetColor` é€»è¾‘å·²æ­£ç¡®ã€‚

---

### 5.3 UpdateSeedPreview ä¿®æ”¹

**ä¿®æ”¹ç‚¹ 1ï¼šcanPlant æ‹¦æˆª b å±‚ï¼ˆV5.1 æ¨¡å— Pï¼‰**

åœ¨ `canPlant` è®¡ç®—ä¹‹åŽã€`isValid` è®¡ç®—ä¹‹å‰æ’å…¥ï¼š
```csharp
// ðŸ”´ V5.1 æ¨¡å—Pï¼šæ’­ç§ ghost çº³å…¥ b å±‚æ£€æŸ¥
if (canPlant && queuePreviewPositions.Contains(cellPos))
{
    canPlant = false;
}
```

æ— å…¶ä»–ä¿®æ”¹ã€‚

---

## å…­ã€ä¿®æ”¹æ–‡ä»¶æ±‡æ€»

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `FarmToolPreview.cs` | UpdateHoePreviewï¼ˆb å±‚ç»Ÿä¸€æ‹¦æˆª + canTill=false å…¨é‡é“º 1+8 + åºŸå¼ƒç™½æ¡†ï¼‰ã€UpdateWateringPreviewï¼ˆcanWater æ‹¦æˆª b å±‚ + æ°´æ¸ç§»å‡º isValidï¼‰ã€UpdateSeedPreviewï¼ˆcanPlant æ‹¦æˆª b å±‚ï¼‰ |

---

## ä¸ƒã€ä¸Ž V5.1 å®¡è§†æŠ¥å‘Šçš„å·®å¼‚

| é¡¹ç›® | V5.1 å®¡è§†æŠ¥å‘Š | æœ¬æ¬¡æœ€ç»ˆæ–¹æ¡ˆ | å˜åŒ–åŽŸå›  |
|------|-------------|------------|---------|
| b å±‚æ‹¦æˆªä½ç½® | `if (canTill && ...)` åœ¨ canClearWithered ä¹‹å‰ | ç»Ÿä¸€æ‹¦æˆªåœ¨ canClearWithered ä¹‹åŽ | é”è¯„003 å‘çŽ°æž¯èŽä½œç‰©æ¼æ´ž |
| æ‹¦æˆªèŒƒå›´ | åªæ‹¦æˆª `canTill` | åŒæ—¶æ‹¦æˆª `canTill` å’Œ `canClearWithered` | é”è¯„003 ç»Ÿä¸€æ‹¦æˆªæ–¹æ¡ˆ |
| å…¶ä½™å†…å®¹ | â€” | ä¸å˜ | â€” |

å”¯ä¸€å®žè´¨æ€§å˜åŒ–å°±æ˜¯ b å±‚æ‹¦æˆªçš„ä½ç½®å’ŒèŒƒå›´ã€‚å…¶ä½™æ‰€æœ‰å†…å®¹ï¼ˆä¿ç•™ Shaderã€å…¨é‡é“º 1+8ã€æ°´æ¸ç§»å‡º isValidã€åºŸå¼ƒç™½æ¡†ã€æµ‡æ°´/æ’­ç§æ‹¦æˆª b å±‚ï¼‰ä¸Ž V5.1 å®¡è§†æŠ¥å‘Šå®Œå…¨ä¸€è‡´ã€‚
