# 补丁004 验收指南 V6

> 基于 designV6.md 9个模块 + tasksV6.md 5阶段6任务
> 编译验证：getDiagnostics 0 错误 0 警告 ✅

---

## 功能验收清单

### 模块Q：极限操作绝对锁定（已实施）
- [ ] 左键耕地动画开始瞬间按WASD → 动画正常播完，耕地正常出现
- [ ] 动画中按WASD → 玩家不移动，等动画播完后才能移动
- [ ] 队列中有多个操作时，WASD只清空等待队列，不中断当前执行

### 模块S：锄头全状态农作物清除
- [ ] 锄头悬停在有农作物的耕地上 → 不显示任何预览（空白）
- [ ] 锄头悬停在无农作物的已有耕地上 → 显示放置系统红方框
- [ ] 锄头悬停在空地上 → 显示绿色1+8预览
- [ ] 锄头点击有农作物的耕地 → 播放Crush动画 → 农作物被清除，耕地保留
- [ ] 所有作物状态（幼苗/成熟/枯萎等）都可被锄头清除
- [ ] 入队时有农作物 → 入队类型为RemoveCrop（非Till）

### 模块V：Ghost增量差集合并c+b方向（已实施）
- [ ] c层附近有队列预览时，ghost增量差集正确合并c+b方向
- [ ] 例：M=(0,0)空地，b=(1,0)耕地列上下有队列预览 → ghost在M处只显示增量方向

### 模块N'：b层统一拦截（已实施）
- [ ] 已在队列中的格子 → 锄头显示红方框（canTill=false, hasCrop=false）
- [ ] 不可重复入队

### 模块T：浇水随机重写
- [ ] 切换到水壶时 → 随机一次默认水渍样式
- [ ] 鼠标在耕地间移动 → 水渍样式不变
- [ ] 浇水后鼠标仍在同一格子 → 样式不变
- [ ] 浇水后移出格子 → 触发随机新样式 → 锁定直到下次浇水+移出
- [ ] 切换到锄头/种子再切回水壶 → 重新随机默认样式

### 模块U：浇水b层纳入
- [ ] 已在队列中的格子 → 浇水显示红色预览（canWater=false）

### 模块P'：水渍移出isValid保护圈
- [ ] 不可浇水的格子（已浇水/非耕地等）→ 显示红色水渍预览（有载体）
- [ ] 可浇水的格子 → 显示绿色水渍预览

### 模块O''：Shader染色（已实施）
- [ ] canTill时绿色shader叠加
- [ ] 其他情况Color.clear（无叠加）

### 模块P''：播种b层拦截
- [ ] 已在队列中的格子 → 种子显示红色预览（canPlant=false）

---

## 已知限制

1. 模块R（种子放置化）未在V6中实施，已记入代办
2. 批量操作预览冲突（多个队列预览互相覆盖边界）是已知视觉瑕疵，落地时 UpdateBorderAt 会重新计算正确结果
3. 浇水随机样式在切换工具后会重置（设计如此）

---

## 正确性属性审查结果

| 编号 | 属性 | 状态 |
|------|------|------|
| CP-Q1~Q3 | 绝对锁定 | ✅ 通过 |
| CP-S1~S6 | 锄头农作物 | ✅ 通过 |
| CP-V1 | 增量差集合并 | ✅ 通过 |
| CP-N1 | b层统一拦截 | ✅ 通过 |
| CP-T1~T5 | 浇水随机 | ✅ 通过 |
| CP-U1 | 浇水b层 | ✅ 通过 |
| CP-P1~P2 | 水渍移出isValid | ✅ 通过 |
| CP-O1 | Shader三分支 | ✅ 通过 |
| CP-P3 | 播种b层 | ✅ 通过 |
