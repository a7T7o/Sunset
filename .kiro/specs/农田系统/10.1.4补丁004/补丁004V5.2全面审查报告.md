# è¡¥ä¸004V5.2 å…¨é¢å®¡æŸ¥æŠ¥å‘Š

> åˆ›å»ºæ—¶é—´ï¼š2026-02-22ï¼ˆä¼šè¯2ç»­19ï¼‰
> è§¦å‘åŸå› ï¼šç”¨æˆ·éªŒæ”¶åæå‡º5ä¸ªæ–°é—®é¢˜ + æ•´åˆé”è¯„002-003å®¡æ ¸æŠ¥å‘Šæœ€ç»ˆæ–¹æ¡ˆ
> åŸºç¡€æ–‡æ¡£ï¼šè¡¥ä¸004V5å…¨é¢å®¡æŸ¥æŠ¥å‘Š + 001é”è¯„002-003å®¡æ ¸æŠ¥å‘Šï¼ˆV5.1æœ€ç»ˆæ–¹æ¡ˆï¼‰

---

## ä¸€ã€ç”¨æˆ·åŸå§‹è¯‰æ±‚ï¼ˆ5ä¸ªé—®é¢˜ï¼‰

| ç¼–å· | ä¼˜å…ˆçº§ | é—®é¢˜ | ç±»å‹ |
|------|--------|------|------|
| Bug1 | ğŸ”´ æœ€é«˜ | æé™æ“ä½œï¼šå·¦é”®è€•åœ°åŠ¨ç”»å¼€å§‹ç¬é—´æŒ‰æ–¹å‘é”® â†’ åŠ¨ç”»æ’­æ”¾ä½†è€•åœ°ä¸å‡ºç°ã€é¢„è§ˆä¸æ¶ˆå¤± | æ—¶åºç«æ€ |
| Bug2 | ğŸ”´ é«˜ | å†œä½œç‰©ç§æ¤é˜Ÿåˆ—å½»åº•åˆ é™¤ï¼šç§å­ä¸èµ°å†œç”°äº¤äº’é˜Ÿåˆ—ï¼Œæ”¹ä¸ºæ”¾ç½®ç‰©å“ï¼ˆå’Œæ ‘è‹—ä¸€æ ·ï¼‰ | æ¶æ„è°ƒæ•´ |
| Bug3 | ğŸ”´ é«˜ | é•å­åªèƒ½è€•åœ°ï¼šç¼ºå°‘ä¸Šå±‚å†œä½œç‰©å¤„ç†é€»è¾‘ï¼ˆå…ˆå¤„ç†ä¸Šå±‚å†å¤„ç†è€•åœ°ï¼‰ | é€»è¾‘ç¼ºå¤± |
| Bug4 | ğŸŸ¡ ä¸­ | æµ‡æ°´é¢„è§ˆæ ·å¼éšæœºé€»è¾‘ä¼˜åŒ–ï¼šç§»å‡ºå½“å‰æ ¼å­æ‰éšæœºï¼Œä¸‰å±‚ç»Ÿä¸€ | ä½“éªŒä¼˜åŒ– |
| Bug5 | ğŸŸ¡ ä¸­ | æµ‡æ°´çº¢è‰²ä¸å¯æµ‡æ°´é¢„è§ˆç¼ºå°‘ b å±‚çº³å…¥ | ä¸€è‡´æ€§ç¼ºå¤± |

---

## äºŒã€Bug1 æé™æ“ä½œ â€” å¸§çº§æ—¶åºæ·±åº¦åˆ†æï¼ˆğŸ”´ æœ€é«˜ä¼˜å…ˆçº§ï¼‰

### 2.1 é—®é¢˜ç°è±¡

ç©å®¶åœ¨å·¦é”®è€•åœ°åŠ¨ç”»å¼€å§‹çš„ç¬é—´æŒ‰ä¸‹æ–¹å‘é”®ï¼ˆWASDï¼‰ï¼Œç»“æœï¼š
- âœ… åŠ¨ç”»æ­£å¸¸æ’­æ”¾
- âŒ è€•åœ°æœ€ç»ˆä¸å‡ºç°
- âŒ é¢„è§ˆä¸æ¶ˆå¤±ï¼Œç•™åœ¨åŸåœ°
- åç»­ä»å¯å¯¹è¯¥ä½ç½®è€•ç§ï¼ˆè¯´æ˜ c å±‚æ•°æ®æœªè¢«åˆ›å»ºï¼‰

### 2.2 å¸§çº§æ‰§è¡Œæ—¶åº

`Update()` æ¯å¸§æ‰§è¡Œé¡ºåºï¼ˆGameInputManager ç¬¬190-245è¡Œï¼‰ï¼š
```
1. UpdatePreviews()          â† é¢„è§ˆæ›´æ–°
2. HandleMovement()          â† WASD è¾“å…¥å¤„ç†
3. _pendingTileUpdate ç›‘å¬   â† åŠ¨ç”»è¿›åº¦æ£€æµ‹ â†’ è§¦å‘ ExecuteTillSoil
4. HandleUseCurrentTool()    â† å·¦é”®ç‚¹å‡»å¤„ç†
```

### 2.3 æé™æ“ä½œåœºæ™¯ â€” å¸§çº§æ¨¡æ‹Ÿ

**åœºæ™¯ï¼šå¸§ N å·¦é”®ç‚¹å‡»å…¥é˜Ÿå¹¶æ‰§è¡Œï¼Œå¸§ N+1 WASD æŒ‰ä¸‹**

å¸§ Nï¼š
- HandleUseCurrentTool â†’ TryEnqueueFarmTool â†’ EnqueueAction â†’ ProcessNextAction
- ProcessNextAction: `_farmActionQueue.Dequeue()`, `_isProcessingQueue = true`
- ExecuteFarmAction: `_isExecutingFarming = true`, PromoteToExecutingPreview
- playerInteraction.RequestAction(Crush) â†’ StartAction â†’ `isPerformingAction = true`, `lockManager.BeginAction()` â†’ IsLocked = true
- `playerMovement.StopMovement()`
- `_pendingTileUpdate = request`, `_tileUpdateTriggered = false`

å¸§ N+1ï¼š
- HandleMovement:
  - `hasWASD = true`
  - `hasActiveQueue = (_farmActionQueue.Count > 0 || _isProcessingQueue)` â†’ `(0 > 0 || true) = true`
  - è¿›å…¥ WASD ä¸­æ–­åˆ†æ”¯ï¼ˆç¬¬454-458è¡Œï¼‰ï¼š
    1. `ClearActionQueue()` â†’ æ¨¡å— H æ£€æŸ¥ `_isExecutingFarming = true` â†’ ä¿ç•™ `_pendingTileUpdate` âœ…
    2. `CancelFarmingNavigation()` â†’ **ğŸ”´ ç¬¬2003è¡Œï¼š`_isExecutingFarming = false`ï¼ˆæ— æ¡ä»¶æ¸…é™¤ï¼ï¼‰**
    3. `ForceUnlock()` â†’ **ğŸ”´ lockManager.IsLocked = false**
  - ç»§ç»­åˆ° lockManager.IsLocked æ£€æŸ¥ â†’ å·²è§£é” â†’ ä¸è¿›å…¥é”å®šåˆ†æ”¯
  - åº•éƒ¨ï¼š`playerMovement.SetMovementInput(input, shift)` â†’ **ğŸ”´ ç©å®¶å¼€å§‹ç§»åŠ¨ï¼**

å¸§ N+1 ä¹‹åï¼š
- ç©å®¶ç§»åŠ¨ â†’ PlayerMovement åˆ‡æ¢ Animator çŠ¶æ€ä¸º Walk/Run
- **Crush åŠ¨ç”»è¢«ä¸­æ–­** â†’ Animation Eventï¼ˆOnActionCompleteï¼‰æ°¸ä¸è§¦å‘
- `_pendingTileUpdate` ç›‘å¬åŸºäº `GetAnimationProgress()`ï¼ˆæ—¶é—´è®¡ç®—ï¼Œä¸ä¾èµ– Animatorï¼‰
  - `_isPerformingToolAction` ä»ä¸º trueï¼ˆStopAnimationTracking åªåœ¨ OnActionComplete ä¸­è°ƒç”¨ï¼‰
  - è¿›åº¦ä¼šéšæ—¶é—´é€’å¢ â†’ **å¯èƒ½è§¦å‘ ExecuteTillSoil**
- ä½† OnActionComplete æ°¸ä¸è§¦å‘ â†’ ä»¥ä¸‹çŠ¶æ€æ°¸ä¹…å¡æ­»ï¼š
  - `isPerformingAction = true` â†’ HandleUseCurrentTool æ°¸è¿œè¿›å…¥æ‰§è¡Œä¿æŠ¤åˆ†æ”¯
  - `RemoveExecutingPreview` æ°¸ä¸è°ƒç”¨ â†’ **æ‰§è¡Œé¢„è§ˆæ°¸è¿œç•™åœ¨åŸåœ°**
  - `_pendingTileUpdate` ä¸ä¼šè¢«æ¸…ç©ºï¼ˆåªåœ¨ OnFarmActionAnimationComplete ä¸­æ¸…ç©ºï¼‰

### 2.4 æ ¹å› æ€»ç»“

**æ ¹å› é“¾**ï¼š
```
WASD åœ¨åŠ¨ç”»å¼€å§‹åçš„ä¸‹ä¸€å¸§æŒ‰ä¸‹
  â†’ ClearActionQueue()ï¼ˆæ¨¡å— H ä¿æŠ¤ _pendingTileUpdateï¼‰
  â†’ CancelFarmingNavigation()
    â†’ _isExecutingFarming = false  â† ğŸ”´ æ ¹å› 1ï¼šæ— æ¡ä»¶æ¸…é™¤æ‰§è¡Œæ ‡å¿—
  â†’ ForceUnlock()                  â† ğŸ”´ æ ¹å› 2ï¼šè§£é™¤ç§»åŠ¨é”å®š
  â†’ ç©å®¶å¼€å§‹ç§»åŠ¨ â†’ Animator åˆ‡æ¢åˆ° Walk
  â†’ Crush åŠ¨ç”»ä¸­æ–­ â†’ OnActionComplete æ°¸ä¸è§¦å‘  â† ğŸ”´ æ ¹å› 3ï¼šå›è°ƒé“¾æ–­è£‚
  â†’ isPerformingAction æ°¸ä¹… true
  â†’ RemoveExecutingPreview æ°¸ä¸è°ƒç”¨ â†’ é¢„è§ˆä¸æ¶ˆå¤±
  â†’ ExecuteTillSoil å¯èƒ½è¢«æ—¶é—´ç›‘å¬è§¦å‘ï¼Œä¹Ÿå¯èƒ½ä¸è§¦å‘ï¼ˆå–å†³äºæ—¶æœºï¼‰
```

**æ ¸å¿ƒé—®é¢˜**ï¼š
1. `CancelFarmingNavigation()` æ— æ¡ä»¶æ¸…é™¤ `_isExecutingFarming`ï¼Œæ²¡æœ‰æ£€æŸ¥æ˜¯å¦æœ‰åŠ¨ç”»æ­£åœ¨æ‰§è¡Œ
2. `ForceUnlock()` è§£é™¤ç§»åŠ¨é”å®šåï¼Œç©å®¶ç§»åŠ¨æ‰“æ–­å·¥å…·åŠ¨ç”»ï¼Œå¯¼è‡´å›è°ƒé“¾æ–­è£‚

### 2.5 ä¿®å¤æ–¹æ¡ˆ â€” æ¨¡å— Q

æ ¸å¿ƒæ€è·¯ï¼š**WASD ä¸­æ–­é˜Ÿåˆ—æ—¶ï¼Œå¦‚æœæœ‰åŠ¨ç”»æ­£åœ¨æ‰§è¡Œï¼Œåªæ¸…ç©ºé˜Ÿåˆ—ï¼Œä¸å–æ¶ˆæ‰§è¡ŒçŠ¶æ€ï¼Œä¸è§£é”ç§»åŠ¨ã€‚è®©åŠ¨ç”»æ­£å¸¸å®Œæˆåç”±å›è°ƒé“¾æ¸…ç†ã€‚**

**Q1ï¼šä¿®æ”¹ HandleMovement ä¸­ WASD ä¸­æ–­åˆ†æ”¯**ï¼ˆç¬¬454-458è¡Œï¼‰ï¼š
```csharp
if (hasWASD && hasActiveQueue)
{
    bool wasExecuting = _isExecutingFarming;
    ClearActionQueue();
    if (!wasExecuting)
    {
        CancelFarmingNavigation();
        ToolActionLockManager.Instance?.ForceUnlock();
    }
    // else: åŠ¨ç”»æ‰§è¡Œä¸­ â†’ åªæ¸…ç©ºé˜Ÿåˆ—ï¼Œä¸å–æ¶ˆå¯¼èˆª/ä¸è§£é”
    // åŠ¨ç”»å®Œæˆåç”± OnFarmActionAnimationComplete æ­£å¸¸æ¸…ç†
}
```

**Q2ï¼šä¿®æ”¹ CancelFarmingNavigation å¢åŠ æ‰§è¡Œä¿æŠ¤**ï¼ˆç¬¬1985è¡Œï¼‰ï¼š
```csharp
private void CancelFarmingNavigation()
{
    if (_farmNavState == FarmNavState.Idle || _farmNavState == FarmNavState.Preview) return;
    
    if (_farmingNavigationCoroutine != null)
    {
        StopCoroutine(_farmingNavigationCoroutine);
        _farmingNavigationCoroutine = null;
    }
    
    // ğŸ”´ V5.2 æ¨¡å—Qï¼ˆCP-Q3ï¼‰ï¼šæ‰§è¡Œä¸­ä¸æ¸…é™¤æ ‡å¿—ï¼Œä¸è§£é”
    if (_isExecutingFarming)
    {
        _farmNavState = FarmNavState.Executing;
        _farmNavigationAction = null;
        _cachedSeedData = null;
        ClearSnapshot();
        return;  // ä¸æ¸…é™¤ _isExecutingFarmingï¼Œä¸ ForceUnlock
    }
    
    // åŸæœ‰é€»è¾‘ï¼ˆéæ‰§è¡ŒçŠ¶æ€ï¼‰
    _farmNavState = IsHoldingFarmTool() ? FarmNavState.Preview : FarmNavState.Idle;
    _farmNavigationAction = null;
    _cachedSeedData = null;
    _isExecutingFarming = false;
    ClearSnapshot();
    
    var lockMgr = ToolActionLockManager.Instance;
    if (lockMgr != null && lockMgr.IsLocked)
        lockMgr.ForceUnlock();
}
```

### 2.6 æ­£ç¡®æ€§å±æ€§

| ç¼–å· | å±æ€§ | éªŒè¯æ–¹å¼ |
|------|------|---------|
| CP-Q1 | `_isExecutingFarming = true` æ—¶ï¼ŒWASD ä¸è°ƒç”¨ `CancelFarmingNavigation` | ä»£ç å®¡æŸ¥ |
| CP-Q2 | `_isExecutingFarming = true` æ—¶ï¼ŒWASD ä¸è°ƒç”¨ `ForceUnlock` | ä»£ç å®¡æŸ¥ |
| CP-Q3 | `CancelFarmingNavigation` ä¸­ `_isExecutingFarming = true` æ—¶ä¿æŒæ‰§è¡ŒçŠ¶æ€ | ä»£ç å®¡æŸ¥ |
| CP-Q4 | æé™æ“ä½œååŠ¨ç”»æ­£å¸¸å®Œæˆ â†’ è€•åœ°æ­£å¸¸åˆ›å»º â†’ æ‰§è¡Œé¢„è§ˆæ­£å¸¸æ¸…é™¤ | æ¸¸æˆå†…éªŒæ”¶ |
| CP-Q5 | æé™æ“ä½œå `isPerformingAction` æœ€ç»ˆæ¢å¤ä¸º false | æ¸¸æˆå†…éªŒæ”¶ |

---

## ä¸‰ã€Bug2 å†œä½œç‰©ç§æ¤é˜Ÿåˆ—å½»åº•åˆ é™¤ï¼ˆğŸ”´ é«˜ä¼˜å…ˆçº§ï¼‰

### 3.1 é—®é¢˜æè¿°

ç”¨æˆ·è¦æ±‚ï¼šå½»åº•åˆ é™¤å†œä½œç‰©ç§æ¤çš„é˜Ÿåˆ—é¢„è§ˆå’Œå¤„ç†ï¼Œç§å­æ”¹ä¸ºæ”¾ç½®ç‰©å“ï¼ˆå’Œæ ‘è‹— TreeControllerV2 ä¸€æ ·ï¼‰ï¼Œä¸å†èµ°å†œç”°äº¤äº’é˜Ÿåˆ—ã€‚

### 3.2 å½“å‰ç§å­é˜Ÿåˆ—ç›¸å…³ä»£ç æ¸…å•

**GameInputManager.cs**ï¼š

| æ–¹æ³•/ä½ç½® | è¯´æ˜ |
|-----------|------|
| HandleUseCurrentTool ç¬¬785è¡Œ `TryEnqueueSeed(seedData)` | ç§å­å…¥é˜Ÿå…¥å£ |
| TryEnqueueSeed ç¬¬2665è¡Œ | ç§å­å…¥é˜Ÿé€»è¾‘ |
| TryEnqueueFromCurrentInput ç¬¬2705è¡Œ `TryEnqueueSeed(seedData)` | åŠ¨ç”»æœŸé—´ç§å­å…¥é˜Ÿ |
| ExecuteFarmAction ç¬¬2462è¡Œ `case FarmActionType.PlantSeed:` | ç§å­æ‰§è¡Œåˆ†æ”¯ |
| ProcessNextAction ç¬¬2341è¡Œ `case FarmActionType.PlantSeed:` | ç§å­äºŒæ¬¡éªŒè¯ |
| ExecutePlantSeed ç¬¬1560è¡Œ | ç§å­ç§æ¤æ‰§è¡Œï¼ˆä¿ç•™ï¼Œæ”¹ä¸ºæ”¾ç½®ç³»ç»Ÿè°ƒç”¨ï¼‰ |
| HasSeedRemaining / GetCurrentSeedData | è¾…åŠ©æ–¹æ³• |

**FarmToolPreview.cs**ï¼š

| æ–¹æ³•/ä½ç½® | è¯´æ˜ |
|-----------|------|
| UpdateSeedPreview ç¬¬677è¡Œ | ç§å­ ghost é¢„è§ˆï¼ˆä¿ç•™ï¼Œæ”¹ä¸ºæ”¾ç½®ç³»ç»Ÿé¢„è§ˆï¼‰ |
| AddQueuePreview ç§å­åˆ†æ”¯ | ç§å­é˜Ÿåˆ—é¢„è§ˆæ·»åŠ ï¼ˆåˆ é™¤ï¼‰ |
| RemoveExecutingPreview ç§å­åˆ†æ”¯ | ç§å­æ‰§è¡Œé¢„è§ˆç§»é™¤ï¼ˆåˆ é™¤ï¼‰ |
| ClearAllQueuePreviews ç§å­éƒ¨åˆ† | ç§å­é˜Ÿåˆ—é¢„è§ˆæ¸…ç†ï¼ˆåˆ é™¤ï¼‰ |
| `activeSeedQueuePreviews`, `executingSeedPreviews`, `seedQueuePool` | ç§å­é¢„è§ˆæ•°æ®ç»“æ„ï¼ˆåˆ é™¤ï¼‰ |

**UpdatePreviews è·¯ç”±**ï¼ˆç¬¬326è¡Œï¼‰ï¼š
- `else if (itemData is SeedData seedData)` â†’ å½“å‰è°ƒç”¨ `UpdateSeedPreview`ï¼ˆä¿ç•™è·¯ç”±ï¼Œæ”¹ä¸ºæ”¾ç½®ç³»ç»Ÿï¼‰

### 3.3 ä¿®å¤æ–¹æ¡ˆ â€” æ¨¡å— Rï¼ˆç§å­æ”¾ç½®åŒ–ï¼‰

æ ¸å¿ƒæ€è·¯ï¼šç§å­ä»å†œç”°äº¤äº’é˜Ÿåˆ—ä¸­å®Œå…¨å‰¥ç¦»ï¼Œæ”¹ä¸ºèµ°æ”¾ç½®ç³»ç»Ÿï¼ˆPlacementManagerï¼‰è·¯å¾„ï¼Œå’Œæ ‘è‹—ä¸€æ ·ã€‚

**R1ï¼šHandleUseCurrentTool ä¸­ç§å­åˆ†æ”¯æ”¹ä¸ºæ”¾ç½®ç³»ç»Ÿ**ï¼š
- å½“å‰ï¼š`TryEnqueueSeed(seedData)` â†’ èµ° FIFO é˜Ÿåˆ—
- ä¿®æ”¹åï¼šç§å­èµ° PlacementManager è·¯å¾„ï¼Œç±»ä¼¼ PlaceableItemData çš„å¤„ç†
- å…·ä½“æ–¹æ¡ˆï¼šSeedData åœ¨ HandleUseCurrentTool ä¸­ä¸å†è°ƒç”¨ `TryEnqueueSeed`ï¼Œè€Œæ˜¯è°ƒç”¨ `ExecutePlantSeed` ç›´æ¥ç§æ¤ï¼ˆç§å­æ— åŠ¨ç”»ï¼Œä¸éœ€è¦é˜Ÿåˆ—ï¼‰

**R2ï¼šUpdatePreviews ä¸­ç§å­è·¯ç”±ä¿æŒä¸å˜**ï¼š
- `UpdateSeedPreview` å·²ç»æ˜¯ç‹¬ç«‹çš„é¢„è§ˆç³»ç»Ÿï¼ˆseedGridRenderer + seedPreviewRendererï¼‰ï¼Œä¸ä¾èµ–é˜Ÿåˆ—
- ä¿ç•™ç°æœ‰é¢„è§ˆé€»è¾‘ï¼Œåªæ˜¯å…¥é˜Ÿ/æ‰§è¡Œè·¯å¾„æ”¹å˜

**R3ï¼šæ¸…ç†é˜Ÿåˆ—ç›¸å…³ä»£ç **ï¼š
- `TryEnqueueSeed` æ–¹æ³•ï¼šæ ‡è®°ä¸º `[Obsolete]` æˆ–åˆ é™¤
- `TryEnqueueFromCurrentInput` ä¸­ç§å­åˆ†æ”¯ï¼šç§»é™¤
- `ExecuteFarmAction` ä¸­ `PlantSeed` åˆ†æ”¯ï¼šç§»é™¤
- `ProcessNextAction` ä¸­ `PlantSeed` äºŒæ¬¡éªŒè¯ï¼šç§»é™¤
- `FarmActionType.PlantSeed` æšä¸¾å€¼ï¼šä¿ç•™ï¼ˆé¿å…åºåˆ—åŒ–é—®é¢˜ï¼‰ï¼Œä½†ä¸å†ä½¿ç”¨
- FarmToolPreview ä¸­ç§å­é˜Ÿåˆ—é¢„è§ˆç›¸å…³å­—æ®µå’Œé€»è¾‘ï¼šæ¸…ç†

**R4ï¼šç§å­ç›´æ¥ç§æ¤æµç¨‹**ï¼š
```
HandleUseCurrentTool
  â†’ itemData is SeedData
  â†’ æ£€æŸ¥ farmPreview.IsValid()
  â†’ ç›´æ¥è°ƒç”¨ ExecutePlantSeed(seedData, layerIndex, cellPos)
  â†’ æ— åŠ¨ç”»ï¼Œæ— é˜Ÿåˆ—ï¼Œæ— å¯¼èˆª
```

**æ³¨æ„**ï¼š`ExecutePlantSeed` å·²ç»åŒ…å«å®Œæ•´çš„ç§æ¤é€»è¾‘ï¼ˆæ¶ˆè€—ç§å­ã€å®ä¾‹åŒ–ä½œç‰©ã€åˆå§‹åŒ– CropControllerï¼‰ï¼Œä¸éœ€è¦ä¿®æ”¹ã€‚åªéœ€è¦æ”¹å˜è°ƒç”¨å…¥å£ã€‚

### 3.4 æ­£ç¡®æ€§å±æ€§

| ç¼–å· | å±æ€§ | éªŒè¯æ–¹å¼ |
|------|------|---------|
| CP-R1 | ç§å­ä¸å†é€šè¿‡ `EnqueueAction` å…¥é˜Ÿ | ä»£ç å®¡æŸ¥ |
| CP-R2 | ç§å­ç§æ¤é€šè¿‡ HandleUseCurrentTool ç›´æ¥æ‰§è¡Œ | ä»£ç å®¡æŸ¥ |
| CP-R3 | ç§å­é¢„è§ˆï¼ˆseedGridRenderer + seedPreviewRendererï¼‰æ­£å¸¸æ˜¾ç¤º | æ¸¸æˆå†…éªŒæ”¶ |
| CP-R4 | ç§å­ç§æ¤åè€•åœ°æ•°æ®æ­£ç¡®æ›´æ–°ï¼ˆcropController åˆå§‹åŒ–ï¼‰ | æ¸¸æˆå†…éªŒæ”¶ |
| CP-R5 | ç§å­ç”¨å®Œåæ­£ç¡®æ¸…é™¤èƒŒåŒ…æ§½ä½ | æ¸¸æˆå†…éªŒæ”¶ |

---

## å››ã€Bug3 é•å­ç¼ºå°‘ä¸Šå±‚å†œä½œç‰©å¤„ç†ï¼ˆğŸ”´ é«˜ä¼˜å…ˆçº§ï¼‰

### 4.1 é—®é¢˜æè¿°

é•å­ï¼ˆé”„å¤´ï¼‰å½“å‰åªèƒ½è€•åœ°ï¼Œä¸¢å¤±äº†æ¸…é™¤è€•åœ°ä¸Šæ–¹å†œä½œç‰©çš„é€»è¾‘ã€‚å†œä½œç‰©åœ¨è€•åœ°ä¹‹ä¸Šï¼Œåº”è¯¥å…ˆå¤„ç†ä¸Šå±‚å†œä½œç‰©äº¤äº’å†å¤„ç†è€•åœ°ã€‚

### 4.2 ä»£ç äº‹å®

**ExecuteTillSoil**ï¼ˆGameInputManager ç¬¬1317è¡Œï¼‰å·²ç»åŒ…å«æ¯èä½œç‰©å¤„ç†ï¼š
```csharp
var tileData = farmTileManager.GetTileData(layerIndex, cellPos);
if (tileData?.cropController != null && 
    tileData.cropController.GetState() == CropState.WitheredImmature)
{
    tileData.cropController.ClearWitheredImmature();
    return true;  // â† ğŸ”´ æ¸…é™¤æ¯èä½œç‰©åç›´æ¥è¿”å›ï¼Œä¸åˆ›å»ºè€•åœ°
}
```

**é—®é¢˜åˆ†æ**ï¼š
1. `ExecuteTillSoil` åªå¤„ç† `WitheredImmature` çŠ¶æ€çš„æ¯èä½œç‰©
2. å¯¹äºæ­£å¸¸ç”Ÿé•¿ä¸­çš„ä½œç‰©ï¼ˆGrowing/Mature ç­‰çŠ¶æ€ï¼‰ï¼Œé”„å¤´æ²¡æœ‰ä»»ä½•å¤„ç†
3. ç”¨æˆ·è¯´"é•å­åªèƒ½è€•åœ°"â€”â€”å¯èƒ½æŒ‡çš„æ˜¯é”„å¤´å¯¹éæ¯èä½œç‰©å®Œå…¨æ— ååº”

**UpdateHoePreview ä¸­çš„ canClearWithered**ï¼ˆç¬¬433-438è¡Œï¼‰ï¼š
```csharp
bool canClearWithered = false;
if (!canTill && FarmTileManager.Instance != null)
{
    var tileData = FarmTileManager.Instance.GetTileData(layerIndex, cellPos);
    if (tileData?.cropController != null && 
        tileData.cropController.GetState() == CropState.WitheredImmature)
        canClearWithered = true;
}
```

é¢„è§ˆåªæ£€æµ‹ `WitheredImmature`ï¼Œä¸æ£€æµ‹å…¶ä»–ä½œç‰©çŠ¶æ€ã€‚è¿™ä¸ `ExecuteTillSoil` çš„é€»è¾‘ä¸€è‡´ã€‚

### 4.3 ç”¨æˆ·æ„å›¾æ¾„æ¸…

ç”¨æˆ·è¯´"å…ˆå¤„ç†ä¸Šå±‚å†œä½œç‰©äº¤äº’å†å¤„ç†è€•åœ°"â€”â€”è¿™æ„å‘³ç€ï¼š
- å¦‚æœè€•åœ°ä¸Šæœ‰ä»»ä½•å†œä½œç‰©ï¼ˆä¸åªæ˜¯æ¯èçš„ï¼‰ï¼Œé”„å¤´åº”è¯¥å…ˆä¸å†œä½œç‰©äº¤äº’
- å†œä½œç‰©äº¤äº’å¯èƒ½åŒ…æ‹¬ï¼šæ¸…é™¤æ¯èä½œç‰©ã€æ”¶è·æˆç†Ÿä½œç‰©ç­‰
- åªæœ‰è€•åœ°ä¸Šæ²¡æœ‰å†œä½œç‰©æ—¶ï¼Œé”„å¤´æ‰å¤„ç†è€•åœ°æœ¬èº«

**ä½†æ˜¯**â€”â€”æ ¹æ®æœ€ç»ˆäº¤äº’çŸ©é˜µï¼Œé”„å¤´çš„åŠŸèƒ½æ˜¯"è€•åœ°"å’Œ"æ¸…é™¤æ¯èä½œç‰©"ï¼Œä¸åŒ…æ‹¬æ”¶è·ã€‚æ”¶è·æ˜¯é€šè¿‡ `TryDetectAndEnqueueHarvest` ç‹¬ç«‹å¤„ç†çš„ã€‚

### 4.4 ä¿®å¤æ–¹æ¡ˆ â€” æ¨¡å— S

**å½“å‰é—®é¢˜çš„ç²¾ç¡®å®šä¹‰**ï¼šé”„å¤´å¯¹å·²æœ‰è€•åœ°+æ¯èä½œç‰©çš„æ ¼å­ï¼Œé¢„è§ˆå’Œæ‰§è¡Œé€»è¾‘æ˜¯æ­£ç¡®çš„ï¼ˆcanClearWithered + ClearWitheredImmatureï¼‰ã€‚ä½†å¦‚æœç”¨æˆ·å‘ç°"é•å­åªèƒ½è€•åœ°"ï¼Œå¯èƒ½æ˜¯ä»¥ä¸‹æƒ…å†µä¹‹ä¸€ï¼š

1. é¢„è§ˆæ˜¾ç¤ºçº¢è‰²ï¼ˆcanTill=false, canClearWithered=falseï¼‰â†’ ç”¨æˆ·æ— æ³•ç‚¹å‡»
2. æ‰§è¡Œæ—¶ `ExecuteTillSoil` çš„æ¯èæ£€æµ‹æ²¡æœ‰åŒ¹é…åˆ°

**éœ€è¦ç”¨æˆ·ç¡®è®¤**ï¼šç”¨æˆ·è¯´çš„"ä¸Šå±‚å†œä½œç‰©"å…·ä½“æŒ‡å“ªäº›çŠ¶æ€ï¼Ÿæ˜¯åªæœ‰æ¯èä½œç‰©ï¼Œè¿˜æ˜¯åŒ…æ‹¬æ‰€æœ‰ä½œç‰©ï¼Ÿ

**æš‚å®šæ–¹æ¡ˆ**ï¼ˆåŸºäºå½“å‰ç†è§£ï¼‰ï¼šç¡®ä¿é”„å¤´å¯¹æ¯èä½œç‰©çš„å®Œæ•´å¤„ç†é“¾è·¯æ­£å¸¸å·¥ä½œã€‚å¦‚æœç”¨æˆ·éœ€è¦æ‰©å±•åˆ°å…¶ä»–ä½œç‰©çŠ¶æ€ï¼Œåç»­è¿­ä»£ã€‚

**S1ï¼šç¡®è®¤ canClearWithered çš„è§¦å‘æ¡ä»¶**ï¼š
- å½“å‰ï¼š`!canTill` æ—¶æ‰æ£€æµ‹æ¯è â†’ å¦‚æœæ ¼å­æ²¡æœ‰è€•åœ°ï¼ˆcanTill=trueï¼‰ï¼Œä¸ä¼šæ£€æµ‹æ¯è
- ä½†æ¯èä½œç‰©ä¸€å®šåœ¨è€•åœ°ä¸Š â†’ canTill=falseï¼ˆå·²æœ‰è€•åœ°ï¼‰â†’ è¿›å…¥æ¯èæ£€æµ‹ âœ…
- é€»è¾‘æ­£ç¡®ï¼Œæ— éœ€ä¿®æ”¹

**S2ï¼šç¡®è®¤ ExecuteTillSoil çš„æ‰§è¡Œä¼˜å…ˆçº§**ï¼š
- å…ˆæ£€æµ‹æ¯èä½œç‰© â†’ æœ‰åˆ™æ¸…é™¤å¹¶è¿”å›
- å†æ£€æµ‹ CanTillAt â†’ å¯ä»¥åˆ™åˆ›å»ºè€•åœ°
- ä¼˜å…ˆçº§æ­£ç¡®ï¼šä¸Šå±‚ï¼ˆæ¯èä½œç‰©ï¼‰ä¼˜å…ˆäºä¸‹å±‚ï¼ˆè€•åœ°ï¼‰âœ…

**ç»“è®º**ï¼šå½“å‰ä»£ç é€»è¾‘å¯¹æ¯èä½œç‰©çš„å¤„ç†æ˜¯æ­£ç¡®çš„ã€‚å¦‚æœç”¨æˆ·é‡åˆ°"é•å­åªèƒ½è€•åœ°"çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯ç‰¹å®šåœºæ™¯ä¸‹ canClearWithered æ²¡æœ‰æ­£ç¡®è§¦å‘ã€‚éœ€è¦ç”¨æˆ·æä¾›å…·ä½“çš„å¤ç°æ­¥éª¤ã€‚

**ğŸ”´ æ ‡è®°ä¸ºå¾…ç”¨æˆ·ç¡®è®¤**ï¼šéœ€è¦ç”¨æˆ·æ˜ç¡®"ä¸Šå±‚å†œä½œç‰©"çš„å…·ä½“å«ä¹‰å’Œå¤ç°æ­¥éª¤ã€‚

### 4.5 æ­£ç¡®æ€§å±æ€§

| ç¼–å· | å±æ€§ | éªŒè¯æ–¹å¼ |
|------|------|---------|
| CP-S1 | æ¯èä½œç‰©æ ¼å­ä¸Šé”„å¤´é¢„è§ˆæ˜¾ç¤ºç»¿è‰²ï¼ˆcanClearWithered=trueï¼‰ | æ¸¸æˆå†…éªŒæ”¶ |
| CP-S2 | é”„å¤´ç‚¹å‡»æ¯èä½œç‰©æ ¼å­ â†’ æ¸…é™¤æ¯èä½œç‰©ï¼Œä¸åˆ›å»ºæ–°è€•åœ° | æ¸¸æˆå†…éªŒæ”¶ |
| CP-S3 | æ¸…é™¤æ¯èä½œç‰©åï¼Œè€•åœ°æ•°æ®ä¿æŒä¸å˜ | æ¸¸æˆå†…éªŒæ”¶ |

---

## äº”ã€Bug4 æµ‡æ°´é¢„è§ˆæ ·å¼éšæœºé€»è¾‘ä¼˜åŒ–ï¼ˆğŸŸ¡ ä¸­ç­‰ä¼˜å…ˆçº§ï¼‰

### 5.1 é—®é¢˜æè¿°

ç”¨æˆ·è¦æ±‚ï¼šæµ‡æ°´é¢„è§ˆæ ·å¼ä¸åº”è¯¥æ¯æ¬¡æµ‡æ°´éƒ½éšæœºï¼Œè€Œæ˜¯"ç§»å‡ºå½“å‰æ ¼å­æ‰éšæœºä¸€æ¬¡"ï¼Œä¸‰å±‚ï¼ˆghost/é˜Ÿåˆ—/æ‰§è¡Œï¼‰ç»Ÿä¸€æ ·å¼ã€‚

### 5.2 å½“å‰é€»è¾‘

**UpdateWateringPreview**ï¼ˆFarmToolPreview ç¬¬637-649è¡Œï¼‰ï¼š
```csharp
if (isValid)
{
    if (cellPos != _lastWateringCellPos)
    {
        var puddleTiles = FarmVisualManager.Instance?.GetPuddleTiles();
        int count = puddleTiles != null ? puddleTiles.Length : 3;
        _cachedPuddleVariant = Random.Range(0, count);
        _lastWateringCellPos = cellPos;
    }
    // ä½¿ç”¨ _cachedPuddleVariant æ”¾ç½® tile
}
```

å½“å‰è¡Œä¸ºï¼šè¿›å…¥æ–°æ ¼å­æ—¶éšæœºä¸€æ¬¡ â†’ åœç•™åœ¨åŒä¸€æ ¼å­ä¸å˜ â†’ ç§»åˆ°å¦ä¸€æ ¼å­å†éšæœºã€‚

**TryEnqueueFarmTool**ï¼ˆGameInputManager ç¬¬2649è¡Œï¼‰ï¼š
```csharp
variant = farmPreview.CurrentPuddleVariant;
```

å…¥é˜Ÿæ—¶ä½¿ç”¨ ghost ç¼“å­˜çš„ variant â†’ é˜Ÿåˆ—é¢„è§ˆå’Œ ghost ä¸€è‡´ âœ…

### 5.3 ç”¨æˆ·è¦æ±‚ vs å½“å‰é€»è¾‘

ç”¨æˆ·è¦æ±‚ï¼š"ç§»å‡ºå½“å‰æ‰§è¡Œçš„ä½ç½®å°±éšæœºä¸€ä¸ªæ¥æ›´æ–°é¢„è§ˆæ ·å¼ï¼Œå¹¶ä¸”ä¸€ç›´ä¿æŒåˆ°ä¸‹ä¸€æ¬¡è¿™æ ·çš„äº‹ä»¶"

å½“å‰é€»è¾‘å·²ç»æ˜¯"è¿›å…¥æ–°æ ¼å­æ‰éšæœº"ï¼Œè¿™ä¸ç”¨æˆ·è¦æ±‚åŸºæœ¬ä¸€è‡´ã€‚ä½†ç”¨æˆ·å¼ºè°ƒ"ç§»å‡ºå½“å‰æ‰§è¡Œçš„ä½ç½®"â€”â€”å¯èƒ½æŒ‡çš„æ˜¯ï¼š
- æµ‡æ°´æ‰§è¡Œåï¼Œé¼ æ ‡ä»åœ¨åŒä¸€æ ¼å­ â†’ ä¸éšæœº
- é¼ æ ‡ç§»å‡ºè¯¥æ ¼å­ â†’ éšæœºä¸€æ¬¡
- é¼ æ ‡ç§»å›è¯¥æ ¼å­ â†’ ä¿æŒä¸Šæ¬¡éšæœºçš„æ ·å¼ï¼Ÿè¿˜æ˜¯å†éšæœºï¼Ÿ

å½“å‰é€»è¾‘ï¼š`cellPos != _lastWateringCellPos` â†’ æ¯æ¬¡è¿›å…¥æ–°æ ¼å­éƒ½éšæœºã€‚å¦‚æœç§»å‡ºå†ç§»å›ï¼Œä¼šå†æ¬¡éšæœºã€‚

**ç”¨æˆ·å¯èƒ½æœŸæœ›**ï¼šæµ‡æ°´æ‰§è¡Œåï¼Œåªæœ‰"ç§»å‡º"äº‹ä»¶è§¦å‘éšæœºï¼Œç§»å›ä¸å†éšæœºã€‚ä½†è¿™éœ€è¦æ›´å¤æ‚çš„çŠ¶æ€è¿½è¸ªã€‚

**ç®€åŒ–ç†è§£**ï¼šå½“å‰é€»è¾‘å·²ç»æ»¡è¶³"è¿›å…¥æ–°æ ¼å­æ‰éšæœº"çš„æ ¸å¿ƒéœ€æ±‚ã€‚ç”¨æˆ·å¯èƒ½åªæ˜¯åœ¨æè¿°è¿™ä¸ªè¡Œä¸ºï¼Œè€Œä¸æ˜¯è¦æ±‚æ”¹å˜ã€‚

**ä¸‰å±‚ç»Ÿä¸€**ï¼š
- ghostï¼ˆa å±‚ï¼‰ï¼šä½¿ç”¨ `_cachedPuddleVariant` âœ…
- é˜Ÿåˆ—ï¼ˆb å±‚ï¼‰ï¼šå…¥é˜Ÿæ—¶ä» `CurrentPuddleVariant` è·å– âœ…
- æ‰§è¡Œï¼ˆc å±‚ï¼‰ï¼š`ExecuteWaterTile` ä½¿ç”¨ `request.puddleVariant` âœ…

ä¸‰å±‚å·²ç»ç»Ÿä¸€ã€‚

### 5.4 ä¿®å¤æ–¹æ¡ˆ â€” æ¨¡å— T

**å½“å‰é€»è¾‘åŸºæœ¬æ­£ç¡®**ï¼Œä½†éœ€è¦ç¡®è®¤ä¸€ä¸ªç»†èŠ‚ï¼š

**T1ï¼šæµ‡æ°´æ‰§è¡Œåçš„éšæœºæ—¶æœº**

å½“å‰ï¼šæµ‡æ°´æ‰§è¡Œåï¼Œå¦‚æœé¼ æ ‡ä»åœ¨åŒä¸€æ ¼å­ï¼Œ`_lastWateringCellPos` ä»ç„¶ç­‰äº `cellPos` â†’ ä¸éšæœº âœ…
ç§»å‡ºåï¼š`cellPos != _lastWateringCellPos` â†’ éšæœº âœ…

**ä½†æ˜¯**â€”â€”æµ‡æ°´æ‰§è¡Œåï¼Œè¯¥æ ¼å­å˜ä¸º"å·²æµ‡æ°´"ï¼ˆ`wateredToday = true`ï¼‰ï¼Œ`canWater = false`ï¼Œä¸è¿›å…¥ `if (isValid)` åˆ†æ”¯ â†’ ä¸ä¼šæ›´æ–° `_lastWateringCellPos`ã€‚

ä¸‹æ¬¡ç§»åˆ°æ–°çš„å¯æµ‡æ°´æ ¼å­æ—¶ï¼š`cellPos != _lastWateringCellPos`ï¼ˆ_lastWateringCellPos ä»æ˜¯ä¸Šæ¬¡æµ‡æ°´çš„æ ¼å­ï¼‰â†’ éšæœº âœ…

**ç»“è®ºï¼šå½“å‰é€»è¾‘å·²ç»æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼Œæ— éœ€ä¿®æ”¹ã€‚**

ä½†éœ€è¦é…åˆ V5.1 çš„ä¿®æ”¹ï¼ˆæ°´æ¸ tile ç§»å‡º `if (isValid)` ä¿æŠ¤åœˆï¼‰é‡æ–°å®¡è§†ï¼š

å¦‚æœæ°´æ¸ tile æ”¾ç½®ç§»å‡º `if (isValid)`ï¼Œé‚£ä¹ˆéšæœºé€»è¾‘ä¹Ÿéœ€è¦ç§»å‡ºï¼š
```csharp
// ç§»å‡º if (isValid) åçš„é€»è¾‘
if (cellPos != _lastWateringCellPos)
{
    var puddleTiles = FarmVisualManager.Instance?.GetPuddleTiles();
    int count = puddleTiles != null ? puddleTiles.Length : 3;
    _cachedPuddleVariant = Random.Range(0, count);
    _lastWateringCellPos = cellPos;
}
// æ— è®º isValidï¼Œéƒ½æ”¾ç½®æ°´æ¸ tile
```

è¿™æ ·å³ä½¿ `isValid = false`ï¼ˆçº¢è‰²é¢„è§ˆï¼‰ï¼Œä¹Ÿä¼šæ˜¾ç¤ºæ°´æ¸ tileï¼ˆä½œä¸º shader è½½ä½“ï¼‰ï¼Œä¸”æ ·å¼åœ¨è¿›å…¥æ–°æ ¼å­æ—¶éšæœºã€‚

### 5.5 æ­£ç¡®æ€§å±æ€§

| ç¼–å· | å±æ€§ | éªŒè¯æ–¹å¼ |
|------|------|---------|
| CP-T1 | åœç•™åœ¨åŒä¸€æ ¼å­æ—¶æµ‡æ°´é¢„è§ˆæ ·å¼ä¸å˜ | æ¸¸æˆå†…éªŒæ”¶ |
| CP-T2 | ç§»åˆ°æ–°æ ¼å­æ—¶æµ‡æ°´é¢„è§ˆæ ·å¼éšæœºå˜åŒ– | æ¸¸æˆå†…éªŒæ”¶ |
| CP-T3 | ghost/é˜Ÿåˆ—/æ‰§è¡Œä¸‰å±‚ä½¿ç”¨ç›¸åŒçš„ puddleVariant | ä»£ç å®¡æŸ¥ |

---

## å…­ã€Bug5 æµ‡æ°´çº¢è‰²é¢„è§ˆç¼ºå°‘ b å±‚çº³å…¥ï¼ˆğŸŸ¡ ä¸­ç­‰ä¼˜å…ˆçº§ï¼‰

### 6.1 é—®é¢˜æè¿°

æµ‡æ°´é¢„è§ˆæ²¡æœ‰æŠŠ b å±‚ï¼ˆé˜Ÿåˆ—é¢„è§ˆä½ç½®ï¼‰çº³å…¥"ä¸å¯æµ‡æ°´"åˆ¤æ–­ï¼Œä¸è€•åœ°é¢„è§ˆä¸ä¸€è‡´ã€‚

### 6.2 ä»£ç äº‹å®

**UpdateWateringPreview**ï¼ˆFarmToolPreview ç¬¬597-600è¡Œï¼‰ï¼š
```csharp
var tileData = FarmTileManager.Instance?.GetTileData(layerIndex, cellPos);
bool canWater = tileData != null && tileData.isTilled && !tileData.wateredToday;
```

`canWater` åªæ£€æŸ¥ c å±‚æ•°æ®ï¼Œä¸æ£€æŸ¥ b å±‚ `queuePreviewPositions`ã€‚

### 6.3 ä¿®å¤æ–¹æ¡ˆ

ä¸ V5.1 æ¨¡å— P ä¸€è‡´ï¼ˆå·²åœ¨é”è¯„002-003å®¡æ ¸æŠ¥å‘Šä¸­æ•²å®šï¼‰ï¼š

```csharp
bool canWater = tileData != null && tileData.isTilled && !tileData.wateredToday;

// ğŸ”´ V5.2 æ¨¡å—Uï¼ˆ= V5.1 æ¨¡å—P CP-P1ï¼‰ï¼šæµ‡æ°´ ghost çº³å…¥ b å±‚æ£€æŸ¥
if (canWater && queuePreviewPositions.Contains(cellPos))
    canWater = false;
```

### 6.4 æ­£ç¡®æ€§å±æ€§

| ç¼–å· | å±æ€§ | éªŒè¯æ–¹å¼ |
|------|------|---------|
| CP-U1 | å·²å…¥é˜Ÿæµ‡æ°´ä½ç½®ä¸Š ghost æ˜¾ç¤ºçº¢è‰²ï¼ˆcanWater=falseï¼‰ | æ¸¸æˆå†…éªŒæ”¶ |
| CP-U2 | æœªå…¥é˜Ÿæµ‡æ°´ä½ç½®ä¸Š ghost æ­£å¸¸æ˜¾ç¤ºè“è‰² | æ¸¸æˆå†…éªŒæ”¶ |

---

## ä¸ƒã€æ•´åˆ V5.1 æœ€ç»ˆæ–¹æ¡ˆï¼ˆé”è¯„002-003å®¡æ ¸æŠ¥å‘Šï¼‰

ä»¥ä¸‹æ˜¯ V5.1 æœ€ç»ˆæ–¹æ¡ˆä¸­å·²æ•²å®šä½†å°šæœªå®æ–½çš„ä¿®æ”¹ï¼Œçº³å…¥ V5.2 ç»Ÿä¸€å®æ–½ï¼š

### 7.1 æ¨¡å— N'ï¼šè€•åœ° b å±‚ç»Ÿä¸€æ‹¦æˆªï¼ˆé”è¯„003 æ–¹æ¡ˆï¼‰

```csharp
// å…ˆè®¡ç®— canTill å’Œ canClearWitheredï¼ˆä¿æŒåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
// ...

// ğŸ”´ V5.2ï¼ˆ= V5.1 ç»ˆææ‹¦æˆªï¼‰ï¼šå·²åœ¨é˜Ÿåˆ—ä¸­çš„æ ¼å­ç»Ÿç»Ÿæ— æ•ˆ
if (queuePreviewPositions.Contains(cellPos))
{
    canTill = false;
    canClearWithered = false;
}

bool isValid = !hasObstacle && (canTill || canClearWithered);
```

### 7.2 æ¨¡å— O'ï¼šcanTill=false å…¨é‡é“º 1+8 + åºŸå¼ƒç™½æ¡†

canTill=false åˆ†æ”¯é‡æ„ï¼š
- ä¹Ÿè°ƒç”¨ `GetPreviewTiles` è®¡ç®—å®Œæ•´ 1+8 é¢„è§ˆ
- å†™å…¥ ghostTilemapï¼ˆä¸åšå¢é‡è¿‡æ»¤ï¼‰
- åºŸå¼ƒ `cursorRenderer`ï¼ˆ`cursorRenderer.enabled = false`ï¼‰

### 7.3 æ¨¡å— O''ï¼šshader æŸ“è‰²ä¿æŒ

ä¿ç•™ `previewOverlayMaterial.SetColor` æ ¹æ® `isValid` è®¾ç½®é¢œè‰²ã€‚
- isValid=trueï¼šç»¿è‰²ï¼ˆ`overlayValidColor`ï¼‰
- isValid=falseï¼šçº¢è‰²ï¼ˆ`overlayInvalidColor`ï¼‰

### 7.4 æ¨¡å— P'ï¼šæµ‡æ°´æ°´æ¸ tile ç§»å‡º isValid ä¿æŠ¤åœˆ

æ— è®º isValidï¼Œéƒ½è®¡ç®—å¹¶æ”¾ç½®æ°´æ¸ tileï¼ˆä½œä¸º shader è½½ä½“ï¼‰ã€‚éšæœºé€»è¾‘ä¹Ÿç§»å‡º isValidã€‚

### 7.5 æ¨¡å— P''ï¼šæ’­ç§ b å±‚æ‹¦æˆª

```csharp
if (canPlant && queuePreviewPositions.Contains(cellPos))
    canPlant = false;
```

---

## å…«ã€ä¿®å¤æ¨¡å—æ±‡æ€»

| æ¨¡å— | é—®é¢˜ | ä¿®æ”¹æ–‡ä»¶ | ä¼˜å…ˆçº§ |
|------|------|---------|--------|
| Q | Bug1 æé™æ“ä½œ | GameInputManager.csï¼ˆHandleMovement + CancelFarmingNavigationï¼‰ | ğŸ”´ æœ€é«˜ |
| R | Bug2 ç§å­æ”¾ç½®åŒ– | GameInputManager.csï¼ˆHandleUseCurrentTool + æ¸…ç†é˜Ÿåˆ—ä»£ç ï¼‰ã€FarmToolPreview.csï¼ˆæ¸…ç†ç§å­é˜Ÿåˆ—é¢„è§ˆï¼‰ | ğŸ”´ é«˜ |
| S | Bug3 é•å­ä¸Šå±‚å†œä½œç‰© | å¾…ç”¨æˆ·ç¡®è®¤å…·ä½“åœºæ™¯ | ğŸ”´ é«˜ï¼ˆå¾…ç¡®è®¤ï¼‰ |
| T | Bug4 æµ‡æ°´éšæœºé€»è¾‘ | FarmToolPreview.csï¼ˆUpdateWateringPreview éšæœºé€»è¾‘ç§»å‡º isValidï¼‰ | ğŸŸ¡ ä¸­ |
| U | Bug5 æµ‡æ°´ b å±‚çº³å…¥ | FarmToolPreview.csï¼ˆUpdateWateringPreview canWater æ‹¦æˆªï¼‰ | ğŸŸ¡ ä¸­ |
| N' | V5.1 è€•åœ° b å±‚ç»Ÿä¸€æ‹¦æˆª | FarmToolPreview.csï¼ˆUpdateHoePreviewï¼‰ | ğŸ”´ é«˜ |
| O' | V5.1 canTill=false å…¨é‡é“º 1+8 | FarmToolPreview.csï¼ˆUpdateHoePreviewï¼‰ | ğŸŸ¡ ä¸­ |
| O'' | V5.1 shader æŸ“è‰² | FarmToolPreview.csï¼ˆUpdateHoePreview + UpdateWateringPreviewï¼‰ | ğŸŸ¡ ä¸­ |
| P' | V5.1 æµ‡æ°´æ°´æ¸ç§»å‡º isValid | FarmToolPreview.csï¼ˆUpdateWateringPreviewï¼‰ | ğŸŸ¡ ä¸­ |
| P'' | V5.1 æ’­ç§ b å±‚æ‹¦æˆª | FarmToolPreview.csï¼ˆUpdateSeedPreviewï¼‰ | ğŸŸ¡ ä½ |

---

## ä¹ã€æ¶‰åŠæ–‡ä»¶æ±‡æ€»

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| GameInputManager.cs | æ¨¡å— Qï¼ˆHandleMovement WASD æ‰§è¡Œä¿æŠ¤ + CancelFarmingNavigation æ‰§è¡Œä¿æŠ¤ï¼‰+ æ¨¡å— Rï¼ˆç§å­æ”¾ç½®åŒ–ï¼Œæ¸…ç†é˜Ÿåˆ—ä»£ç ï¼‰ |
| FarmToolPreview.cs | æ¨¡å— N'ï¼ˆè€•åœ° b å±‚ç»Ÿä¸€æ‹¦æˆªï¼‰+ æ¨¡å— O'ï¼ˆcanTill=false å…¨é‡é“º 1+8ï¼‰+ æ¨¡å— O''ï¼ˆshader æŸ“è‰²ï¼‰+ æ¨¡å— P'ï¼ˆæµ‡æ°´æ°´æ¸ç§»å‡º isValidï¼‰+ æ¨¡å— P''ï¼ˆæ’­ç§ b å±‚æ‹¦æˆªï¼‰+ æ¨¡å— Rï¼ˆæ¸…ç†ç§å­é˜Ÿåˆ—é¢„è§ˆï¼‰+ æ¨¡å— Tï¼ˆæµ‡æ°´éšæœºé€»è¾‘ï¼‰+ æ¨¡å— Uï¼ˆæµ‡æ°´ b å±‚çº³å…¥ï¼‰ |

**ä¸éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- PlayerInteraction.cs â€” å›è°ƒé“¾ä¸å˜
- FarmlandBorderManager.cs â€” é¢„è§ˆè®¡ç®—ä¸å˜
- FarmTileManager.cs â€” æ•°æ®å±‚ä¸å˜
- PlayerAnimController.cs â€” åŠ¨ç”»è¿›åº¦è®¡ç®—ä¸å˜

---

## åã€å®æ–½é¡ºåºå»ºè®®

1. æ¨¡å— Qï¼ˆBug1 æé™æ“ä½œï¼‰â€” æœ€é«˜ä¼˜å…ˆçº§ï¼Œç‹¬ç«‹ä¿®æ”¹
2. æ¨¡å— N' + O' + O''ï¼ˆV5.1 è€•åœ°é¢„è§ˆé‡æ„ï¼‰â€” åŸºç¡€è®¾æ–½
3. æ¨¡å— U + P'ï¼ˆBug5 æµ‡æ°´ b å±‚ + æ°´æ¸ç§»å‡º isValidï¼‰â€” æµ‡æ°´é¢„è§ˆä¿®å¤
4. æ¨¡å— Tï¼ˆBug4 æµ‡æ°´éšæœºé€»è¾‘ï¼‰â€” éš P' ä¸€èµ·
5. æ¨¡å— P''ï¼ˆV5.1 æ’­ç§ b å±‚ï¼‰â€” ç®€å•ä¿®æ”¹
6. æ¨¡å— Rï¼ˆBug2 ç§å­æ”¾ç½®åŒ–ï¼‰â€” æ¶æ„è°ƒæ•´ï¼Œæœ€ååš
7. æ¨¡å— Sï¼ˆBug3 é•å­ä¸Šå±‚å†œä½œç‰©ï¼‰â€” å¾…ç”¨æˆ·ç¡®è®¤

---

## åä¸€ã€å¾…ç”¨æˆ·ç¡®è®¤äº‹é¡¹

1. **Bug3 å…·ä½“åœºæ™¯**ï¼šç”¨æˆ·è¯´"é•å­åªèƒ½è€•åœ°ï¼Œç¼ºå°‘ä¸Šå±‚å†œä½œç‰©å¤„ç†"â€”â€”å½“å‰ä»£ç å·²æœ‰æ¯èä½œç‰©å¤„ç†ï¼ˆClearWitheredImmatureï¼‰ã€‚è¯·ç¡®è®¤ï¼š
   - æ˜¯æ¯èä½œç‰©æ¸…é™¤ä¸ç”Ÿæ•ˆï¼Ÿè¿˜æ˜¯éœ€è¦å¯¹å…¶ä»–çŠ¶æ€çš„ä½œç‰©ä¹Ÿæœ‰äº¤äº’ï¼Ÿ
   - èƒ½å¦æä¾›å…·ä½“çš„å¤ç°æ­¥éª¤ï¼Ÿ

2. **Bug4 éšæœºé€»è¾‘ç¡®è®¤**ï¼šå½“å‰"è¿›å…¥æ–°æ ¼å­æ‰éšæœº"çš„é€»è¾‘æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿè¿˜æ˜¯éœ€è¦æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Ÿ

3. **æ¨¡å— R ç§å­æ”¾ç½®åŒ–çš„èŒƒå›´**ï¼šç§å­æ”¹ä¸ºç›´æ¥ç§æ¤ï¼ˆæ— é˜Ÿåˆ—æ— åŠ¨ç”»ï¼‰ï¼Œæ˜¯å¦éœ€è¦ä¿ç•™å¯¼èˆªåŠŸèƒ½ï¼ˆè¿œè·ç¦»è‡ªåŠ¨èµ°è¿‡å»å†ç§ï¼‰ï¼Ÿè¿˜æ˜¯åªæ”¯æŒè¿‘è·ç¦»ç›´æ¥ç§æ¤ï¼Ÿ
