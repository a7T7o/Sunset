# ç»§æ‰¿å¿«ç…§ï¼šä¼šè¯3-ç»­4

## ç”¨æˆ· prompt å®Œæ•´æ‘˜æŠ„

> è¯·ä½ ç»§ç»­ä¸€æ¡é¾™å®Œæˆåç»­è®¾è®¡å’Œä»»åŠ¡æ–‡æ¡£çš„åˆ›å»ºï¼Œè¯·åŠ¡å¿…è¯¦ç»†ä¸”è°¨æ…ï¼Œä¾æ—§æ˜¯è¯·ä½ ä¸¥æ ¼æ£€æŸ¥ä»£ç å®é™…æƒ…å†µåœ¨è¿›è¡Œå®Œå¤‡çš„è®¾è®¡ï¼Œç¡®ä¿è®¾è®¡æ˜¯å®Œå…¨ç¬¦åˆå½“å‰ä»£ç çš„å®é™…æƒ…å†µçš„ï¼Œç¬¦åˆé¡¹ç›®æƒ…å†µçš„ï¼Œè€Œä¸æ˜¯å‡­ç©ºäº§ç”Ÿå’Œæé€ ç”šè‡³æ˜¯ä¸é€‚é…çš„ï¼Œè¯·ä½ åŠ¡å¿…æ³¨æ„è¿™ä¸€ç‚¹ï¼Œä»»åŠ¡ç¡®å®å¾ˆç¹é‡ï¼Œä½†è¯·ä½ åŠ¡å¿…è€å¿ƒä»”ç»†è®¤çœŸåŠ¡å®ï¼Œè¯·ä½ å¼€å§‹

## AI è¿›åº¦æ‘˜è¦

### å·²å®Œæˆ
1. åŠ è½½ steering è§„åˆ™ï¼šarchive/farming.md + save-system.md
2. æ·±å…¥è¯»å–æ‰€æœ‰æ ¸å¿ƒä»£ç æ–‡ä»¶ï¼ˆå…¨éƒ¨é‡æ–°è¯»å–éªŒè¯ï¼Œéå‡­è®°å¿†ï¼‰ï¼š
   - GameInputManager.csï¼šHandleUseCurrentToolï¼ˆä¸¤é“é˜»æ–­ _isExecutingFarming ç¬¬614è¡Œ + IsPerformingAction ç¬¬654è¡Œï¼‰ã€TryTillSoilï¼ˆé”å®šâ†’è·ç¦»åˆ†æµâ†’è¿‘è·ç¦»åŒæ­¥æ‰§è¡Œ/è¿œè·ç¦»å¯¼èˆªï¼‰ã€TryWaterTileï¼ˆåŒç»“æ„ï¼‰ã€TryPlantSeedï¼ˆåŒç»“æ„+ç§å­æ ¡éªŒï¼‰ã€ExecuteTillSoilï¼ˆæ¯èæ¸…é™¤+CanTillAt+CreateTileï¼‰ã€StartFarmingNavigationï¼ˆä¸è°ƒç”¨CancelFarmingNavigationé˜²æ­¢è§£é”ï¼‰ã€CancelFarmingNavigationï¼ˆUnlockPosition+é‡ç½®çŠ¶æ€ï¼‰
   - PlayerInteraction.csï¼šå®Œæ•´ä»£ç ç¡®è®¤ â€” OnActionComplete é•¿æŒ‰ç»§ç»­åªè°ƒç”¨ StartAction(actionToRepeat, true) é‡æ’­åŠ¨ç”»ï¼Œä¸é€šçŸ¥ GameInputManagerï¼›IsPerformingAction è¿”å› isPerformingAction å­—æ®µ
   - FarmToolPreview.csï¼šLockPosition åªè®¾ç½® _isLocked/_lockedWorldPosition/_lockedCellPos/_lockedLayerIndexï¼Œä¸åˆ·æ–°è§†è§‰
   - FarmTileManager.csï¼šSave å†™å…¥ tileX/tileY/layer/soilState/isWatered å…±5å­—æ®µï¼›CreateTileFromSaveData æ¢å¤ moistureState/wateredToday å…±2å­—æ®µï¼ˆåŠ ä¸Šä½ç½®3å­—æ®µï¼‰ï¼›CreateTile åˆ›å»ºè€•åœ°åæ— è§†è§‰æ›´æ–°è°ƒç”¨ï¼›SetWatered æµ‡æ°´åè°ƒç”¨ UpdateTileVisualï¼›OnHourChanged æ°´æ¸æ¶ˆé€€é€»è¾‘ï¼›ResetDailyWaterState æ—¥ç»“é‡ç½®
   - FarmVisualManager.csï¼šUpdateTileVisual åªæ“ä½œ puddleTilemapï¼ˆæ°´æ¸å åŠ å±‚ï¼‰ï¼ŒdryFarmlandTile/wetDarkTile å­—æ®µå­˜åœ¨ä½†å®Œå…¨æœªä½¿ç”¨ï¼›RefreshAllTileVisuals éå†æ‰€æœ‰è€•åœ°è°ƒç”¨ UpdateTileVisual
   - SaveDataDTOs.csï¼šFarmTileSaveData 5ä¸ªæ´»è·ƒå­—æ®µ + 5ä¸ªåºŸå¼ƒå­—æ®µ
   - FarmTileData.csï¼šå®Œæ•´8ä¸ªè¿è¡Œæ—¶å­—æ®µï¼ˆposition/layerIndex/isTilled/wateredToday/wateredYesterday/waterTime/moistureState/puddleVariant + cropData/cropControllerï¼‰
3. åˆ›å»º design.md å¹¶å†™å…¥ä¸‰å¤§éƒ¨åˆ†ï¼ˆçº¦200è¡Œï¼‰ï¼š
   - ç¬¬ä¸€éƒ¨åˆ† US-1ï¼šé—®é¢˜æ ¹å› ï¼ˆä¸¤é“é˜»æ–­ï¼‰+ è®¾è®¡æ–¹æ¡ˆï¼ˆè¾“å…¥ç¼“å­˜ç»“æ„ã€HandleUseCurrentToolä¿®æ”¹ã€CacheFarmInputã€ConsumePendingFarmInputã€PlayerInteractionå›è°ƒã€é•¿æŒ‰å¤„ç†ã€å¯¼èˆªä¸­é‡æ–°è¾“å…¥ã€LockPositionè§†è§‰åŒæ­¥ã€_isExecutingFarmingè°ƒæ•´ï¼‰+ æ¶‰åŠæ–‡ä»¶ + ä¸ä¿®æ”¹çš„éƒ¨åˆ†
   - ç¬¬äºŒéƒ¨åˆ† US-2ï¼šé—®é¢˜æ ¹å› ï¼ˆ5å­—æ®µvs8å­—æ®µï¼‰+ è®¾è®¡æ–¹æ¡ˆï¼ˆFarmTileSaveDataæ–°å¢3å­—æ®µã€Saveé€‚é…ã€CreateTileFromSaveDataé€‚é…ã€æ—§å­˜æ¡£å…¼å®¹åˆ†æï¼‰+ æ¶‰åŠæ–‡ä»¶
   - ç¬¬ä¸‰éƒ¨åˆ† US-3ï¼šé—®é¢˜æ ¹å› ï¼ˆdryFarmlandTile/wetDarkTileæœªä½¿ç”¨ï¼‰+ è®¾è®¡æ–¹æ¡ˆï¼ˆUpdateTileVisualæ‰©å±•ã€CreateTileè§†è§‰æ›´æ–°ã€æ¸å˜åç¨‹GradualMoistureTransitionã€æ—¥ç»“å›é€€ã€è¯»æ¡£æ¢å¤ï¼‰+ æ¶‰åŠæ–‡ä»¶

### æœªå®Œæˆ
1. design.md è¿½åŠ ç¬¬å››éƒ¨åˆ†ï¼šä¿®æ”¹å½±å“åˆ†æ + æ­£ç¡®æ€§å±æ€§ä¸è®¾è®¡çš„æ˜ å°„è¡¨
2. åˆ›å»º tasks.md â€” åŸºäº design.md æ‹†åˆ†å®ç°ä»»åŠ¡
3. æ›´æ–°ä¸» memoryï¼ˆå†œç”°ç³»ç»Ÿ/memory.mdï¼‰

## ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨
- `design.md`ï¼ˆæ–°å»ºï¼‰â€” 10.1.0 è®¾è®¡æ–‡æ¡£ï¼Œå·²å†™å…¥ US-1/US-2/US-3 ä¸‰å¤§éƒ¨åˆ†
- `memory.md`ï¼ˆ10.1.0 å­å·¥ä½œåŒºï¼‰â€” è¿½åŠ ä¼šè¯3-ç»­4è®°å½•

## æœ¬è½®å…³é”®å†³ç­–ä¸ç”¨æˆ·åå¥½
- ç”¨æˆ·å¼ºè°ƒ"ä¸¥æ ¼æ£€æŸ¥ä»£ç å®é™…æƒ…å†µ"ï¼Œè®¾è®¡å¿…é¡»å®Œå…¨åŸºäºä»£ç äº‹å®
- ç”¨æˆ·è¦æ±‚"ä¸€æ¡é¾™"å®Œæˆ design.md + tasks.md
- ç”¨æˆ·å¼ºè°ƒ"è€å¿ƒä»”ç»†è®¤çœŸåŠ¡å®"
- è®¾è®¡æ–¹æ¡ˆä¸­çš„æ‰€æœ‰ä»£ç å¼•ç”¨å‡å·²é€šè¿‡ readCode éªŒè¯
- æ¸å˜æ•ˆæœé€‰æ‹©äº† Tilemap.SetColor é¢œè‰²æ’å€¼æ–¹æ¡ˆï¼ˆæœ€ç¨³å¦¥ï¼Œä¸éœ€è¦ Shader æˆ–é¢å¤– Tileï¼‰
- è¾“å…¥ç¼“å­˜é€‰æ‹©äº†å›è°ƒé€šçŸ¥æ¨¡å¼ï¼ˆPlayerInteraction â†’ GameInputManagerï¼‰

## å…³è”æ–‡ä»¶ä¸å¾…åŒæ­¥çŠ¶æ€
| æ–‡ä»¶ | çŠ¶æ€ |
|------|------|
| `10.1.0å…¨é¢æŒä¹…åŒ–å‰å¤•/design.md` | ğŸš§ è¿›è¡Œä¸­ï¼ˆUS-1/US-2/US-3 ä¸‰å¤§éƒ¨åˆ†å·²å†™å…¥ï¼Œç¬¬å››éƒ¨åˆ†å¾…è¿½åŠ ï¼‰ |
| `10.1.0å…¨é¢æŒä¹…åŒ–å‰å¤•/requirements.md` | âœ… å®Œæˆ |
| `10.1.0å…¨é¢æŒä¹…åŒ–å‰å¤•/tasks.md` | âŒ æœªåˆ›å»º |
| `10.1.0å…¨é¢æŒä¹…åŒ–å‰å¤•/memory.md` | âœ… å·²æ›´æ–°ä¼šè¯3-ç»­4 |
| `å†œç”°ç³»ç»Ÿ/memory.md` | âš ï¸ å¾…åŒæ­¥ï¼ˆIS_COMPRESSING è·³è¿‡ï¼‰ |

## é—ç•™é—®é¢˜å®Œæ•´ä¸Šä¸‹æ–‡

### é—®é¢˜ 1ï¼šdesign.md å‰©ä½™å†…å®¹
design.md å·²å†™å…¥ä¸‰å¤§éƒ¨åˆ†ï¼ˆUS-1/US-2/US-3ï¼‰ï¼Œè¿˜éœ€è¿½åŠ ï¼š
- ç¬¬å››éƒ¨åˆ†ï¼šä¿®æ”¹å½±å“åˆ†æï¼ˆåˆ—å‡ºæ‰€æœ‰è¢«ä¿®æ”¹çš„æ–‡ä»¶åŠå…¶å½±å“èŒƒå›´ï¼Œç¡®ä¿"æ–°å¢å¹¶å…¼å®¹"ï¼‰
- ç¬¬äº”éƒ¨åˆ†ï¼šæ­£ç¡®æ€§å±æ€§ä¸è®¾è®¡çš„æ˜ å°„è¡¨ï¼ˆCP-1~CP-12 å¦‚ä½•è¢«è®¾è®¡æ–¹æ¡ˆè¦†ç›–ï¼‰

### é—®é¢˜ 2ï¼štasks.md åˆ›å»º
åŸºäº design.md æ‹†åˆ†å®ç°ä»»åŠ¡ï¼Œéœ€è¦è¦†ç›–ï¼š
- US-1 è¾“å…¥ç¼“å­˜ï¼ˆGameInputManager ä¿®æ”¹ + PlayerInteraction å›è°ƒ + FarmToolPreview è§†è§‰åŒæ­¥ï¼‰
- US-2 å­˜æ¡£å­—æ®µè¡¥å…¨ï¼ˆSaveDataDTOs + FarmTileManager Save/Loadï¼‰
- US-3 è€•åœ°è§†è§‰ï¼ˆFarmVisualManager UpdateTileVisual æ‰©å±• + CreateTile è§†è§‰ + æ¸å˜åç¨‹ï¼‰
- å±æ€§æµ‹è¯•ä»»åŠ¡

### é—®é¢˜ 3ï¼šdesign.md ä¸­çš„å…³é”®è®¾è®¡å†³ç­–
- US-1 è¾“å…¥ç¼“å­˜ï¼šç¼“å­˜é¼ æ ‡ä¸–ç•Œåæ ‡ï¼ˆä¸ç¼“å­˜ cellPosï¼‰ï¼Œåªä¿ç•™æœ€åä¸€æ¬¡ï¼Œé€šè¿‡ PlayerInteraction.OnActionComplete å›è°ƒæ¶ˆè´¹
- US-1 é•¿æŒ‰ï¼šOnActionComplete ä¸­æ£€æµ‹ GetMouseButton(0)ï¼Œé€šçŸ¥ GameInputManager ä»¥å½“å‰é¼ æ ‡ä½ç½®æ‰§è¡Œ
- US-1 LockPositionï¼šé”å®šæ—¶è‡ªåŠ¨è°ƒç”¨ UpdateCursor åˆ·æ–°è§†è§‰
- US-2 æ—§å­˜æ¡£å…¼å®¹ï¼šJsonUtility è‡ªåŠ¨ä½¿ç”¨ç±»å‹é»˜è®¤å€¼ï¼Œæ— éœ€é¢å¤–ä»£ç 
- US-3 æ¸å˜ï¼šTilemap.SetColor é¢œè‰²æ’å€¼ï¼Œ30æ¸¸æˆåˆ†é’Ÿå†…ä»ç™½è‰²æ¸å˜åˆ°æ¹¿æ¶¦è‰²ï¼Œå®Œæˆåæ›¿æ¢ä¸º wetDarkTile
- US-3 CreateTileï¼šæœ«å°¾æ–°å¢ UpdateTileVisual è°ƒç”¨è®¾ç½® dryFarmlandTile
