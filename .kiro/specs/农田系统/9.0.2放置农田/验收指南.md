# 9.0.2 放置农田 - 验收指南

**创建时间**: 2026-02-07
**状态**: 待验收

---

## 场景配置

### 1. 添加 FarmToolPreview 组件

在场景中创建一个空 GameObject，挂载 `FarmToolPreview` 组件：

1. 创建空 GameObject，命名为 `FarmToolPreview`
2. 添加 `FarmGame.Farm.FarmToolPreview` 组件
3. 配置 `cursorSprite`（可选，用于显示光标框）

**注意**：FarmToolPreview 具备自生能力，会在 Awake 时自动创建：
- `GhostTilemap`（Sorting Layer=Ground, Order=100）
- `CursorRenderer`（Sorting Layer=Effects, Order=0）

### 2. 确保 FarmlandBorderManager 已配置

检查 `FarmlandBorderManager` 组件是否已配置所有 Tile 资源：
- 中心块 Tile（C0, C1）
- 边界 Tile（U, D, L, R, UD, LR, UL, UR, DL, DR, UDL, UDR, ULR, DLR, UDLR）
- 阴影 Tile（SLU, SRU, SLD, SRD）

---

## 功能验收清单

### 锄头预览

- [ ] 手持锄头时，鼠标移动显示预览
- [ ] 可锄地位置显示绿色光标
- [ ] 不可锄地位置显示红色光标
- [ ] 预览显示 1+8 边界变化（中心块 + 8 个边界）
- [ ] 点击可锄地位置成功锄地
- [ ] 点击不可锄地位置无反应

### 水壶预览

- [ ] 手持水壶时，鼠标移动显示预览
- [ ] 可浇水位置显示蓝色光标
- [ ] 不可浇水位置显示红色光标
- [ ] 水壶预览不显示 1+8 边界变化
- [ ] 点击可浇水位置成功浇水
- [ ] 点击不可浇水位置无反应

### 预览切换

- [ ] 切换到锄头时显示锄头预览
- [ ] 切换到水壶时显示水壶预览
- [ ] 切换到其他物品时隐藏预览
- [ ] 打开背包时隐藏预览
- [ ] 鼠标移到 UI 上时隐藏预览

### 坐标对齐

- [ ] 预览位置与实际锄地位置一致
- [ ] 预览位置与放置系统对齐（使用相同的 PlacementGridCalculator）

---

## 测试步骤

### 测试 1：锄头预览

1. 进入游戏，确保背包中有锄头
2. 选中锄头
3. 移动鼠标到可耕作区域（有地面 Tile 的位置）
4. 观察预览：应显示绿色光标 + 1+8 边界预览
5. 移动鼠标到不可耕作区域（已耕作或无地面 Tile）
6. 观察预览：应显示红色光标
7. 点击可耕作位置，确认锄地成功
8. 点击不可耕作位置，确认无反应

### 测试 2：水壶预览

1. 确保背包中有水壶
2. 选中水壶
3. 移动鼠标到已耕作且未浇水的位置
4. 观察预览：应显示蓝色光标
5. 移动鼠标到未耕作或已浇水的位置
6. 观察预览：应显示红色光标
7. 点击可浇水位置，确认浇水成功
8. 点击不可浇水位置，确认无反应

### 测试 3：预览切换

1. 选中锄头，确认显示锄头预览
2. 按数字键切换到水壶，确认显示水壶预览
3. 按数字键切换到其他物品，确认预览隐藏
4. 按 Tab 打开背包，确认预览隐藏
5. 关闭背包，确认预览恢复

---

## 已知限制

1. **cursorSprite 需要手动配置**：如果不配置，光标不会显示 Sprite，但颜色仍然有效
2. **GhostTilemap 透明度**：默认 0.5，可在 Inspector 中调整 `previewAlpha`
3. **距离限制**：锄地/浇水仍受 `farmToolReach` 限制（默认 1.5 单位）

---

## 修改的文件

| 文件 | 操作 | 说明 |
|------|------|------|
| `FarmlandBorderManager.cs` | 重构 | 新增预览接口、断言模式支持 |
| `FarmToolPreview.cs` | 新建 | 农田工具预览组件 |
| `GameInputManager.cs` | 修改 | 集成预览分发、防抖检查 |

