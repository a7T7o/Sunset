**CODE REAPER STATUS:**
**AUDIT RESPONSE: TARGET ACQUIRED.**
**TARGET:** Kiro's "Independent Thought & Validation" (独立思考与审视).

老大，Kiro 的思考很有价值。他指出的 **“静态类职责”** 和 **“场景配置依赖”** 是执行阶段最容易炸雷的点。
我将针对他的疑虑进行 **最终战术修正**，确保他生成的代码是**自包含 (Self-Contained)** 的，不需要你再去编辑器里拖拖拽拽。

以下是给 Kiro 的最终回应与修正指令。

---

### 💀 战术修正指令 (TACTICAL CORRECTION ORDER)

**To Kiro:**
Code Reaper 已收到你的《锐评审视报告》。
你的防御性思维（疑虑部分）挽救了潜在的编译错误，**提出得很好**。

针对你的三点疑虑，我发布 **最终修正指令**。请将此作为生成代码的绝对标准：

#### 1. 关于 `GetMouseWorldPosition` (修正)

* **Code Reaper 裁决**: 你是对的。`PlacementGridCalculator` 是纯数学/网格计算类，不应耦合 `Camera` 或 `Input`。
* **修正方案**:
* 在 `GameInputManager` 中保留 `GetMouseWorldPosition()`（作为获取原始世界坐标的方法）。
* **关键变更**: 在调用逻辑中，必须将这个原始坐标传给 `PlacementGridCalculator.GetCellCenter(rawPos)` 进行对齐，然后再传给 `FarmToolPreview`。
* **禁止**: 禁止在 `PlacementGridCalculator` 中添加涉及 `Camera.main` 的代码。



#### 2. 关于 `Update` 逻辑冲突 (驳回)

* **Code Reaper 裁决**: 这不是冲突，这是**功能缺失**。现在的 `GameInputManager` 是“瞎子”，我们要让他“复明”。
* **执行指令**: 你必须在 `GameInputManager.Update()` 中加入实时检测：
```csharp
// 伪代码
void Update() {
    // ... 原有逻辑 ...
    UpdatePreviews(); // 新增方法：根据手持物品显隐 FarmToolPreview 或 PlacementPreview
}

```



#### 3. 关于 场景配置依赖 (关键修正：全自动化)

* **Code Reaper 裁决**: 拒绝手动配置。你的代码必须具备 **“自生能力 (Self-Generation)”**。
* **执行指令**: `FarmToolPreview.Awake()` 必须包含自动初始化逻辑。
* 如果找不到 `GhostTilemap`，**代码自动创建一个 GameObject**，挂载 `Tilemap` 和 `TilemapRenderer`，并设置 Sorting Layer 为 "Ground" (Order 100)。
* 如果找不到 `CursorRenderer`，**代码自动创建一个 GameObject**，挂载 `SpriteRenderer`。
* **目标**: 无论场景里有没有配，代码挂上去就能跑。



---

### 🔥 最终执行清单 (FINAL EXECUTION LIST)

Kiro，带着上述修正，立即生成以下 **3 个完整文件**。
(不需要修改 `PlacementGridCalculator.cs`，复用现有的即可)。

1. **`FarmlandBorderManager.cs`**
* [重构] 彻底解耦计算与副作用。
* [新增] `GetPreviewTiles` 接口 (依赖断言)。


2. **`FarmToolPreview.cs`** (全新)
* [核心] 实现 1+8 渲染。
* [自动化] `Awake` 中自动生成所需的 Tilemap 和 SpriteRenderer 组件（如果缺失）。
* [视觉] 实现绿/红/蓝光标逻辑。


3. **`GameInputManager.cs`**
* [接入] 在 `Update` 中根据手持工具调用 `FarmToolPreview.Show/Hide`。
* [修正] `TryTillSoil` / `TryWaterTile` 改为调用 `FarmToolPreview.IsValid()` 进行防抖。
* [坐标] 强制使用 `PlacementGridCalculator` 进行网格对齐。



**GO. 生成代码。**