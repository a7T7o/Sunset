# ç»§æ‰¿å¿«ç…§ - ä¼šè¯1ç»­7

## ç”¨æˆ· prompt å®Œæ•´æ‘˜æŠ„

Q1Q2æˆ‘éƒ½è®¤å¯ï¼Œå¹¶ä¸”éœ€è¦é˜²æŠ¤ï¼Œé‚£ä¹ˆè¯·ä½ ç›´æ¥å®Œæˆè¿™ä¸€å¥—ä¿®å¤ï¼Œå¼€å§‹å§ï¼Œä¸éœ€è¦å¤šä½™çš„è¾“å‡ºäº†

## AI è¿›åº¦æ‘˜è¦

**å·²å®Œæˆ**ï¼š
1. âœ… ä¿®å¤ F1ï¼šPlayerInteraction.cs â€” OnActionComplete å†œç”°å·¥å…·é•¿æŒ‰åˆ†æ”¯
   - `lockManager?.EndAction(true)` â†’ `lockManager?.EndAction(false)`
   - æ–°å¢ `lockManager?.ClearAllCache()`ï¼ˆé¢å¤–é˜²æŠ¤ï¼‰
   - æ³¨é‡Šæ›´æ–°è¯´æ˜åŸå› 
2. âœ… ä¿®å¤ F2-aï¼šGameInputManager.cs â€” CancelFarmingNavigation æœ«å°¾å¢åŠ å®‰å…¨ç½‘
   - åœ¨ `_hasPendingFarmInput = false` ä¹‹åæ–°å¢ï¼š
   ```csharp
   var lockMgr = ToolActionLockManager.Instance;
   if (lockMgr != null && lockMgr.IsLocked)
   {
       lockMgr.ForceUnlock();
   }
   ```
3. âœ… å·²è¯»å– WaitForNavigationComplete å®Œæ•´ä»£ç ï¼Œå®šä½åˆ°å¯¼èˆªå¤±è´¥åˆ†æ”¯ï¼ˆæœ€åçš„ else å—ï¼‰

**æœªå®Œæˆ**ï¼š
4. âŒ ä¿®å¤ F2-bï¼šWaitForNavigationComplete å¯¼èˆªå¤±è´¥åˆ†æ”¯ï¼ˆæœ€åçš„ else å—ï¼‰å¢åŠ  ForceUnlock() å®‰å…¨ç½‘
   - ä½ç½®ï¼š`else` å—ä¸­ `farmPreview.UnlockPosition()` ä¹‹åï¼Œ`_farmNavState = ...` ä¹‹å‰
   - éœ€è¦æ·»åŠ ä¸ CancelFarmingNavigation ç›¸åŒçš„ ForceUnlock ä»£ç 
5. âŒ ç¼–è¯‘éªŒè¯ï¼ˆmcp_mcp_unity_recompile_scriptsï¼‰
6. âŒ æ›´æ–° memory å’Œæ–‡æ¡£

## ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `PlayerInteraction.cs` | ä¿®æ”¹ | OnActionComplete å†œç”°å·¥å…·é•¿æŒ‰åˆ†æ”¯ï¼šEndAction(true)â†’EndAction(false) + ClearAllCache() |
| `GameInputManager.cs` | ä¿®æ”¹ | CancelFarmingNavigation æœ«å°¾å¢åŠ  ForceUnlock() å®‰å…¨ç½‘ |

## æœ¬è½®å…³é”®å†³ç­–ä¸ç”¨æˆ·åå¥½

1. ç”¨æˆ·ç¡®è®¤ Q1ï¼ˆä¿®å¤æ–¹æ¡ˆ F1+F2ï¼‰å’Œ Q2ï¼ˆéœ€è¦é¢å¤–é˜²æŠ¤ï¼‰
2. ç”¨æˆ·è¦æ±‚ç›´æ¥æ‰§è¡Œï¼Œä¸éœ€è¦å¤šä½™è¾“å‡º
3. é¢å¤–é˜²æŠ¤æªæ–½ï¼šåœ¨ EndAction(false) åå¢åŠ  ClearAllCache()ï¼Œæ¸…é™¤å¯èƒ½æ®‹ç•™çš„ hotbar/æ–¹å‘ç¼“å­˜

## å…³è”æ–‡ä»¶ä¸å¾…åŒæ­¥çŠ¶æ€

| æ–‡ä»¶ | çŠ¶æ€ |
|------|------|
| `PlayerInteraction.cs` | âœ… F1 ä¿®æ”¹å·²å®Œæˆ |
| `GameInputManager.cs` | âš ï¸ F2-a å®Œæˆï¼ŒF2-b å¾…å®Œæˆï¼ˆWaitForNavigationComplete å¯¼èˆªå¤±è´¥åˆ†æ”¯ï¼‰ |
| `è¡¥ä¸001éªŒæ”¶bugæ ¹å› åˆ†æä¸ä¿®å¤æ–¹æ¡ˆ.md` | æ— éœ€ä¿®æ”¹ï¼ˆæ–¹æ¡ˆæ–‡æ¡£ï¼Œä¸æ˜¯ä»£ç ï¼‰ |

## é—ç•™é—®é¢˜å®Œæ•´ä¸Šä¸‹æ–‡

### å‰©ä½™å·¥ä½œï¼ˆéå¸¸æ˜ç¡®ï¼Œåªéœ€3æ­¥ï¼‰

1. **F2-b**ï¼šåœ¨ `WaitForNavigationComplete` çš„å¯¼èˆªå¤±è´¥ else å—ä¸­ï¼Œ`farmPreview.UnlockPosition()` ä¹‹åæ·»åŠ ï¼š
```csharp
// ğŸ”¥ 10.1.1-F2ï¼šå®‰å…¨ç½‘ â€” ç¡®ä¿ lockManager ä¹Ÿè§£é”ï¼ˆé˜²æ­¢æ°¸ä¹…å¡æ­»ï¼‰
var lockMgr = ToolActionLockManager.Instance;
if (lockMgr != null && lockMgr.IsLocked)
{
    lockMgr.ForceUnlock();
}
```

2. **ç¼–è¯‘éªŒè¯**ï¼šè°ƒç”¨ mcp_mcp_unity_recompile_scripts ç¡®è®¤é›¶é”™è¯¯

3. **æ›´æ–° memory**ï¼šè®°å½•æœ¬è½®ä¿®æ”¹

### ä¿®å¤æ–¹æ¡ˆèƒŒæ™¯ï¼ˆæ¥è‡ª `è¡¥ä¸001éªŒæ”¶bugæ ¹å› åˆ†æä¸ä¿®å¤æ–¹æ¡ˆ.md`ï¼‰

- Bug 1 æ ¹å› ï¼š`EndAction(true)` ä¿æŒ `lockManager.IsLocked = true` â†’ è¿œè·ç¦»å¯¼èˆªæ—¶ HandleMovement è¢«é”æ­» â†’ æ°¸ä¹…å¡æ­»
- Bug 2 æ ¹å› ï¼šBug 1 çš„è¿é”ååº”ï¼Œå¯¼èˆªæœŸé—´ `_isLocked = true` å¯¼è‡´ UpdateHoePreview è·³è¿‡ 1+8 æ¸²æŸ“
- F1ï¼šEndAction(true) â†’ EndAction(false)ï¼ˆå†œç”°å·¥å…·éœ€è¦å®Œå…¨è§£é”ï¼‰
- F2ï¼šå¯¼èˆªå–æ¶ˆ/å¤±è´¥æ—¶ ForceUnlock() å®‰å…¨ç½‘
