# 农田系统重生 - 验收指南

**版本**: 9.0.1
**创建时间**: 2026-02-06

---

## 功能验收清单

### P0：锄地功能

- [ ] 1. 场景配置检查
  - [ ] FarmTileManager 组件存在于场景中
  - [ ] FarmlandBorderManager 组件存在于场景中
  - [ ] FarmTileManager.layerTilemaps 已配置（至少一个楼层）
  - [ ] LayerTilemaps.groundTilemap 已配置
  - [ ] LayerTilemaps.farmlandTilemap 已配置

- [ ] 2. 锄地功能测试
  - [ ] 装备锄头
  - [ ] 在有地面 Tile 的位置点击
  - [ ] 观察 Console 日志输出
  - [ ] 耕地 Tile 正确显示

### P1：存档功能

- [ ] 3. 耕地存档测试
  - [ ] 锄出几块耕地
  - [ ] 保存游戏
  - [ ] 检查存档文件中是否有 FarmTileManager 数据
  - [ ] 重新加载游戏
  - [ ] 耕地正确恢复

- [ ] 4. 作物存档测试（如果有种植功能）
  - [ ] 种植作物
  - [ ] 保存游戏
  - [ ] 检查存档文件中是否有 Crop 数据
  - [ ] 重新加载游戏
  - [ ] 作物正确恢复
  - [ ] 作物与耕地关联正确

### 兼容性测试

- [ ] 5. 旧存档兼容性
  - [ ] 加载旧存档
  - [ ] 不报错
  - [ ] 旧数据正确读取

---

## 测试步骤说明

### 步骤 1：验证场景配置

1. 打开 Primary 场景
2. 在 Hierarchy 中搜索 "FarmTileManager"
3. 检查 Inspector 中的配置：
   - `Layer Tilemaps` 数组不为空
   - 每个 LayerTilemaps 的 `Ground Tilemap` 已配置
   - 每个 LayerTilemaps 的 `Farmland Tilemap` 已配置

### 步骤 2：测试锄地

1. 运行游戏
2. 装备锄头（如果有快捷键）
3. 在草地上点击
4. 观察 Console 输出：
   - 如果看到 `[GameInputManager] TryTillSoil: 成功`，说明锄地成功
   - 如果看到 `[FarmTileManager] CreateTile 失败`，说明配置有问题
5. 观察场景中是否出现耕地 Tile

### 步骤 3：测试存档

1. 锄出几块耕地
2. 按保存快捷键（或通过菜单保存）
3. 打开存档文件（通常在 `Saves/slot1.json`）
4. 搜索 "FarmTileManager"，确认数据存在
5. 重新加载游戏
6. 确认耕地正确恢复

---

## 预期结果

### 成功标志

- ✅ 锄地时 Console 输出成功日志
- ✅ 耕地 Tile 正确显示
- ✅ 存档文件中包含 FarmTileManager 数据
- ✅ 加载后耕地正确恢复

### 失败标志

- ❌ Console 输出 `groundTilemap 未配置` 错误
- ❌ 锄地后没有 Tile 显示
- ❌ 存档文件中没有 FarmTileManager 数据
- ❌ 加载后耕地消失

---

## 已知限制

1. **作物种植功能**：本次只实现了存档框架，种植功能需要额外的 UI 和交互逻辑
2. **旧存档兼容**：旧存档中的作物数据（cropId 等）会被忽略，因为已标记为 [Obsolete]
3. **CropController 的 persistentId**：需要在种植时生成 GUID，否则不会保存

---

## 问题排查

### 问题 1：锄地无反应

1. 检查 Console 是否有错误日志
2. 检查 FarmTileManager 是否存在
3. 检查 layerTilemaps 是否配置

### 问题 2：耕地不显示

1. 检查 FarmlandBorderManager 是否存在
2. 检查 centerTileUnfertilized Tile 资源是否配置
3. 检查 farmlandCenterTilemap 是否配置

### 问题 3：存档后耕地消失

1. 检查存档文件中是否有 FarmTileManager 数据
2. 检查 PersistentObjectRegistry 是否正确注册
3. 检查 Load() 方法是否被调用

---

**文档维护者**: Kiro
**最后更新**: 2026-02-06
