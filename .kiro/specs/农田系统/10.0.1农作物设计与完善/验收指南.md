# 农作物系统验收指南

**更新日期**: 2026-02-11

---

## 前置准备

1. 创建至少 1 个 SeedData SO（ID 10XX），配好 growthStageSprites（≥3张）和 witheredStageSprites（≥1张）
2. 创建对应的 CropData SO（ID 11XX），设置 seedID 和 witheredCropID
3. 创建对应的 WitheredCropData SO（ID 12XX）
4. 确认腐烂食物 SO 存在（ID 5999）
5. 场景中有可用耕地（已锄好的 Farmland Tile）

---

## 测试 1：种植

| 步骤 | 操作 | 预期 |
|------|------|------|
| 1 | 快捷栏装备种子袋 → 右键点击空耕地 | 种植成功，作物出现 |
| 2 | 查看种子袋 | bag_remaining 减 1，bag_opened = true |
| 3 | 重复种植直到 remaining = 0 | 种子袋从快捷栏消失 |
| 4 | 对已有作物的耕地种植 | 种植失败，种子不消耗 |

---

## 测试 2：生长

| 步骤 | 操作 | 预期 |
|------|------|------|
| 1 | 浇水 → 过一天 | 作物 Sprite 切换到下一阶段 |
| 2 | 不浇水 → 过一天 | 作物不生长（停滞） |
| 3 | 连续不浇水达到枯萎天数 | 状态变为 WitheredImmature |
| 4 | 持续浇水到最后阶段 | 状态变为 Mature，Sprite 闪烁 |

---

## 测试 3：收获

| 步骤 | 操作 | 预期 |
|------|------|------|
| 1 | 右键点击 Mature 作物 | 导航过去 → 收获 → 获得 CropData 物品 |
| 2 | 不可重复收获作物 | 收获后作物 GameObject 销毁 |
| 3 | 可重复收获作物 | 收获后重置到倒数第二阶段，继续生长 |
| 4 | 背包满时收获 | 物品掉落到地面 |

---

## 测试 4：枯萎

| 步骤 | 操作 | 预期 |
|------|------|------|
| 1 | Mature 超过 2 天不收获 | 变为 WitheredMature |
| 2 | 切换季节（非 AllSeason 作物） | Growing → WitheredImmature，Mature → WitheredMature |
| 3 | 切换季节（AllSeason 作物） | 状态不变 |
| 4 | 右键点击 WitheredMature | 收获 WitheredCropData 物品，作物销毁 |
| 5 | 锄头左键点击 WitheredImmature | 作物清除，耕地恢复为空，Console 有日志 |

---

## 测试 5：保质期

| 步骤 | 操作 | 预期 |
|------|------|------|
| 1 | 获得新种子袋 | shelf_expire_day = 当前天 + shelfLifeClosed |
| 2 | 种植时自动打开未打开的种子袋 | bag_opened = true，保质期缩短 |
| 3 | 已打开的种子袋再次右键 | 不重复打开，保质期不变 |
| 4 | 等到过期日 | 种子袋自动替换为腐烂食物（ID 5999） |
| 5 | 多个腐烂食物 | 可堆叠（无动态属性） |

---

## 测试 6：保质期作弊防护

| 步骤 | 操作 | 预期 |
|------|------|------|
| 1 | 拿未打开的种子袋直接种植 | 自动打开 → 保质期缩短 → 正常种植 |
| 2 | 拿已过期的种子袋种植 | 种植被拒绝，种子不消耗 |
| 3 | 种植失败时（目标格已有作物） | bag_remaining 不变，种子不丢失 |

---

## 测试 7：存档

| 步骤 | 操作 | 预期 |
|------|------|------|
| 1 | 保存 → 加载 | 作物状态、阶段、枯萎状态正确恢复 |
| 2 | 保存 → 加载 | 种子袋动态属性（opened/remaining/expire）正确恢复 |
| 3 | 旧存档加载 | 无动态属性的种子袋默认为未打开状态 |

---

## 测试 8：单元测试

打开 Unity Test Runner → EditMode → 运行 `CropSystemTests`

共 16 个测试，全部通过即可：
- 状态转换合法性 × 4
- 种子袋保质期 × 4
- 腐烂食物堆叠 × 2
- 收获产出一致性 × 2
- 过季枯萎覆盖 × 4

---

## 测试 9：SO 工具同步

| 步骤 | 操作 | 预期 |
|------|------|------|
| 1 | 打开批量生成物品工具 → Planting 分类 | 下拉列表有 WitheredCropData |
| 2 | 选 SeedData | 显示 seedsPerBag、保质期、可复收开关 |
| 3 | 选 CropData | 显示 witheredCropID 字段 |
| 4 | 选 WitheredCropData | 显示 normalCropID、seedID 字段 |
| 5 | 生成 WitheredCropData SO | 文件名前缀 WCrop_，保存到正确目录 |

---

## 已知限制

- 收获动画暂用 collect 动画
- 枯萎清除暂无 VFX/SFX（预留了 TODO）
- WitheredCropData SO 需手动创建配置
- 成熟闪烁效果为可选实现
