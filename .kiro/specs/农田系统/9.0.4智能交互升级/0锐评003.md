**CODE REAPER STATUS:**
**INTENSITY LEVEL: GRANDMASTER (å®—å¸ˆçº§).**
**PROTOCOL:** DIFFERENTIAL ANALYSIS & STRATEGIC OVERRIDE.

è€å¤§ï¼Œä½ é—®åˆ°äº†ç‚¹å­ä¸Šã€‚
**è¿™ä¸¤æ¬¡é”è¯„çš„åŒºåˆ«ï¼Œå°±åƒæ˜¯â€œçº æ­£ä¸€ä¸ªå®ä¹ ç”Ÿâ€å’Œâ€œä¸ä¸€ä½èµ„æ·±æ¶æ„å¸ˆåšå¼ˆâ€çš„åŒºåˆ«ã€‚**

åœ¨æ­¤ä¹‹å‰ï¼ˆ9.0.3ï¼‰ï¼Œæˆ‘æ˜¯åœ¨æ•™ Kiro **â€œæ€ä¹ˆå†™å¯¹ä»£ç â€**ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ã€ç©ºå¼•ç”¨æ£€æŸ¥ã€å›¾å±‚åŒæ­¥ï¼‰ã€‚
ç°åœ¨ï¼ˆ9.0.4ï¼‰ï¼Œé¢å¯¹è¿™ä»½ **ã€Šäº¤äº’çŸ©é˜µ (Interaction Matrix)ã€‹**ï¼Œæˆ‘æ˜¯åœ¨å®¡è§† Kiro **â€œæ€ä¹ˆè®¾è®¡ç³»ç»Ÿâ€**ã€‚ä»–ç»ˆäºä¸å†åªæ˜¯è¢«åŠ¨ä¿® Bugï¼Œè€Œæ˜¯å¼€å§‹é¢„åˆ¤ç³»ç»Ÿçš„ **æ—¶ç©ºå¤æ‚æ€§**ã€‚

æˆ‘å·²æ‚‰æ•°é˜…è¯»æ‰€æœ‰æ–‡æ¡£ã€‚Kiro çš„è¿›æ­¥ä»¤äººæ¬£æ…°ï¼Œ**ä½†è¿˜ä¸å¤Ÿ**ã€‚ä»–çœ‹åˆ°äº†â€œå¯¼èˆªâ€çš„ä¾¿åˆ©ï¼Œå´å¿½ç•¥äº†â€œå¼‚æ­¥äº¤äº’â€å¸¦æ¥çš„ **çŠ¶æ€æœºåœ°ç‹±**ã€‚

ä»¥ä¸‹æ˜¯æˆ‘çš„ **å®—å¸ˆçº§å·®å¼‚åŒ–é”è¯„** ä¸ **è¶…è¶Šå¼ºåº¦çš„å‹åˆ¶æ€§æ–¹æ¡ˆ**ã€‚

---

### ğŸ’€ ä¸€ã€ ç»´åº¦æ‰“å‡»ï¼šè¿™æ˜¯å®Œå…¨ä¸åŒçš„æˆ˜åœº (THE DIFFERENCE)

ä½ é—®åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ

1. **ä»â€œé™æ€å¿«ç…§â€åˆ°â€œåŠ¨æ€æ—¶åºâ€**
* **ä¹‹å‰ (9.0.3)**: æˆ‘ä»¬å…³æ³¨çš„æ˜¯ **è¿™ä¸€å¸§** çš„çŠ¶æ€ã€‚æœ‰éšœç¢å—ï¼Ÿå±‚çº§å¯¹å—ï¼Ÿè·ç¦»å¤Ÿå—ï¼Ÿ
* **ç°åœ¨ (9.0.4)**: æˆ‘ä»¬å…³æ³¨çš„æ˜¯ **æœªæ¥ N ç§’** çš„ä¸ç¡®å®šæ€§ã€‚
* *â€œæˆ‘ç‚¹å‡»äº†ï¼Œè§’è‰²å¼€å§‹èµ°ã€‚â€* â€”â€” è¿™æ˜¯ä¸€ä¸ªæŒç»­è¿‡ç¨‹ã€‚
* *â€œèµ°åˆ°ä¸€åŠï¼Œåœ°è¢«åˆ«äººé”„äº†æ€ä¹ˆåŠï¼Ÿâ€*
* *â€œèµ°åˆ°ä¸€åŠï¼Œæˆ‘çªç„¶æƒ³æ¢æŠŠå‰‘ç æ€ªæ€ä¹ˆåŠï¼Ÿâ€*


* **Code Reaper åˆ¤è¯**: Kiro çš„çŸ©é˜µåˆ—å‡ºäº†è¿™äº›æƒ…å†µï¼Œä½†åœ¨ `tasks.md` é‡Œï¼Œä»–å¯¹ **â€œåç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†â€** çš„é‡è§†ç¨‹åº¦ä¾ç„¶ä¸å¤Ÿã€‚ä»–æƒ³ç”¨å›è°ƒï¼ˆCallbackï¼‰ï¼Œä½†æˆ‘å‘Šè¯‰ä½ ï¼Œ**å›è°ƒæ˜¯é€»è¾‘æ»‘æ­¥çš„æ¸©åºŠ**ã€‚


2. **ä»â€œæ‹’ç»æ‰§è¡Œâ€åˆ°â€œæ„å›¾ç»´æŒâ€**
* **ä¹‹å‰**: è·ç¦»ä¸å¤Ÿ -> çº¢æ¡† -> ç©å®¶å¿…é¡»è‡ªå·±èµ°è¿‡å» -> æå…¶ç”Ÿç¡¬ã€‚
* **ç°åœ¨**: è·ç¦»ä¸å¤Ÿ -> ç»¿æ¡† -> ç³»ç»Ÿæ¥ç®¡ç§»åŠ¨ -> è‡ªåŠ¨æ‰§è¡Œã€‚
* **Code Reaper åˆ¤è¯**: è¿™å¼•å…¥äº† **â€œæ“ä½œå»¶è¿Ÿâ€**ã€‚å¦‚æœ UI æ­¤æ—¶å¼¹çª—ï¼Œæˆ–è€…å‘ç”Ÿäº†æˆ˜æ–—ï¼Œè¿™ä¸ªâ€œè¢«ç»´æŒçš„æ„å›¾â€å¿…é¡»èƒ½å¤Ÿè¢« **ç¬é—´æ–©æ–­ (Immediate Kill)**ã€‚Kiro çš„æ–‡æ¡£é‡Œå¯¹â€œä¸­æ–­â€çš„æè¿°è¿˜åœç•™åœ¨ä¸šåŠ¡å±‚ï¼Œæ²¡æœ‰ä¸‹æ²‰åˆ°æ ¸å¿ƒè¾“å…¥å±‚ã€‚



---

### ğŸ’€ äºŒã€ æ·±åº¦å‹åŠ›æµ‹è¯•ï¼šæ‰¾å‡ºçŸ©é˜µçš„è£‚ç¼ (STRESS TEST)

Kiro çš„ã€Šäº¤äº’çŸ©é˜µã€‹è¦†ç›–äº† 15 ç§åœºæ™¯ï¼Œä½†æˆ‘å‘ç°äº† **3 ä¸ªè‡´å‘½çš„é€»è¾‘é»‘æ´**ï¼Œè¿™æ˜¯ä»–æ²¡å†™å‡ºæ¥çš„ï¼Œä¹Ÿæ˜¯æˆ‘å¿…é¡»è¶…è¶Šä»–çš„åœ°æ–¹ã€‚

#### 1. â˜ ï¸ å¯¼èˆªç³»ç»Ÿçš„â€œé»‘ç›’çŒœç–‘é“¾â€ (The Black Box Risk)

Kiro åœ¨ `tasks.md` æåˆ° Phase 0 æ˜¯éªŒè¯å›è°ƒã€‚
**æˆ‘ç›´æ¥å‘Šè¯‰ä½ é£é™©åœ¨å“ª**ï¼š
å¦‚æœ `PlayerAutoNavigator` çš„ `onComplete` å›è°ƒæ˜¯åœ¨ `Update` å¾ªç¯çš„ **æœ«å°¾** è§¦å‘ï¼Œè€Œ `FarmTileManager` çš„é€»è¾‘æ˜¯åœ¨ **ä¸‹ä¸€å¸§çš„å¼€å¤´** æ‰§è¡Œï¼Œä¸­é—´éš”äº†ä¸€å¸§ã€‚
**åªè¦éš”äº†ä¸€å¸§ï¼Œè§’è‰²çš„ä½ç½®å°±å¯èƒ½å‘ç”Ÿå¾®å°çš„æ»‘æ­¥ï¼ˆå› ç‰©ç†æƒ¯æ€§æˆ–æµ®ç‚¹æ¼‚ç§»ï¼‰ã€‚**

* **åæœ**: è§’è‰²èµ°åˆ°äº†ä½ç½®ï¼Œå›è°ƒè§¦å‘ï¼Œæ‰§è¡Œ `CanTillAt`ï¼Œç»“æœå› ä¸ºåæ ‡é£˜äº† 0.01ï¼Œåˆ¤å®šä¸ºâ€œè·ç¦»ä¸å¤Ÿâ€ï¼Œæ“ä½œé™é»˜å¤±è´¥ã€‚
* **è¶…è¶Šæ–¹æ¡ˆ**: åœ¨æ‰§è¡ŒåŠ¨ä½œçš„é‚£ä¸€ç¬é—´ï¼Œå¿…é¡» **å¼ºåˆ¶å¸é™„ (Force Snap)** ç©å®¶æœå‘å’Œä½ç½®å¾®è°ƒï¼Œæˆ–è€…åœ¨åˆ¤å®šæ—¶ç»™äºˆ **0.1f çš„å®½å®¹åº¦**ã€‚

#### 2. â˜ ï¸ â€œäºŒæ¬¡æ£€æŸ¥â€çš„æ²‰é»˜èºæ—‹ (The Silent Failure)

Kiro å®šä¹‰äº†ï¼š`ExecuteAction() âŸ¹ (preview.IsValid)`ã€‚

* **åœºæ™¯**: ç©å®¶ç‚¹å‡»è¿œå¤„è€•åœ° -> è·‘è·¯ 3 ç§’ -> åˆ°è¾¾ç¬é—´ï¼Œåœ°è¢« NPC å äº†ã€‚
* **Kiro çš„è®¾è®¡**: ä¸æ‰§è¡ŒåŠ¨ä½œã€‚
* **ç©å®¶çš„ä½“éªŒ**: â€œæˆ‘ç‚¹äº†ï¼Œä»–è·‘è¿‡å»äº†ï¼Œç„¶ååƒä¸ªå‚»å­ä¸€æ ·ç«™ç€ä¸åŠ¨ã€‚â€
* **è¶…è¶Šæ–¹æ¡ˆ**: å¿…é¡»å¼•å…¥ **â€œå¤±è´¥åé¦ˆåè®® (Failure Feedback)â€**ã€‚å½“äºŒæ¬¡æ£€æŸ¥å¤±è´¥æ—¶ï¼Œè§’è‰²å¿…é¡»æ’­æ”¾ä¸€ä¸ª `ShakeHead` (æ‘‡å¤´) åŠ¨ç”»æˆ– `ErrorSound`ï¼Œæ˜ç¡®å‘Šè¯‰ç©å®¶ï¼šâ€œæˆ‘å°½åŠ›äº†ï¼Œä½†ç¯å¢ƒå˜äº†ã€‚â€

#### 3. â˜ ï¸ åç¨‹çš„åƒµå°¸åŒ–é£é™© (Zombie Coroutines)

Kiro åœ¨ `å®¡è§†æŠ¥å‘Š` é‡Œè¯´å€¾å‘äºå›è°ƒï¼Œè§‰å¾—åç¨‹å¤æ‚ã€‚**å¤§é”™ç‰¹é”™ã€‚**
ç”¨å›è°ƒï¼ˆCallbackï¼‰æœ€å¤§çš„é—®é¢˜æ˜¯ **â€œéš¾ä»¥å–æ¶ˆâ€**ã€‚å¦‚æœä½ åœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ `HandleMovement` è¢«è§¦å‘ï¼Œä½ å¾ˆéš¾ä»å¤–éƒ¨â€œæŠ â€æ‰é‚£ä¸ªå·²ç»æ³¨å†Œè¿›å»çš„åŒ¿åå§”æ‰˜ã€‚

* **è¶…è¶Šæ–¹æ¡ˆ**: å¿…é¡»ä½¿ç”¨ **åç¨‹ (Coroutine)** å¹¶æŒæœ‰å®ƒçš„å¼•ç”¨ã€‚
* `HandleMovement` è§¦å‘ -> `StopCoroutine(_farmingRoutine)` -> **å½»åº•æ€æ­»æ—§æ„å›¾**ã€‚è¿™æ˜¯å”¯ä¸€çš„â€œæ— æ®‹ç•™â€æ‰“æ–­æ–¹å¼ã€‚



---

### ğŸ—ºï¸ 9.0.4 ç»ˆææ‰§è¡Œè“å›¾ï¼šè¶…è¶Šå¼ºåº¦çš„æ¶æ„ (THE SUPREME BLUEPRINT)

åŸºäºä¸Šè¿°ç¢¾å‹çº§çš„åˆ†æï¼Œè¿™æ˜¯æˆ‘ç»™å‡ºçš„ **9.0.4 æœ€ç»ˆæ‰§è¡Œä»¤**ã€‚

#### Phase 0: åŸºç¡€è®¾æ–½æ ¸éªŒ (Infrastructure check)

ä¸è¦åªæ˜¯â€œéªŒè¯â€ã€‚è¦**æ”¹é€ **ã€‚

* **Task 0.1**: æ”¹é€  `PlayerAutoNavigator`ã€‚ç¡®ä¿ `onComplete` è§¦å‘æ—¶ï¼Œå¯¼èˆªçŠ¶æ€å·²å½»åº•æ¸…é™¤ï¼Œä¸”ç©å®¶å¤„äº `Idle` çŠ¶æ€ã€‚
* **Task 0.2**: å¼•å…¥ `ForceStop()` æ¥å£ï¼Œç”¨äºå¤–éƒ¨å¼ºè¡Œæ‰“æ–­å¯¼èˆªå¹¶æ¸…ç©ºæ‰€æœ‰æŒ‚èµ·çš„å›è°ƒã€‚

#### Phase 1: è§†è§‰è§£è€¦ (Visual Decoupling)

* **Task 1.1**: `FarmToolPreview` å½»åº•å‰¥ç¦»è·ç¦»åˆ¤æ–­ã€‚**ç»¿æ¡†å°±æ˜¯ç»¿æ¡†ï¼Œå¤©æ¶¯æµ·è§’ä¹Ÿæ˜¯ç»¿æ¡†ã€‚**
* **Task 1.2**: å¼•å…¥ `CurrentCursorPos` å…¬å¼€å±æ€§ï¼Œä¾› Input å±‚è¯»å–ä½œä¸ºå¯¼èˆªç»ˆç‚¹ã€‚

#### Phase 2: å¤§è„‘é‡æ„ (The Brain Refactor) - **æ ¸å¿ƒå·®å¼‚ç‚¹**

ä¸è¦ç”¨ Kiro çš„å›è°ƒæµã€‚ç”¨æˆ‘çš„ **åç¨‹çŠ¶æ€æœº**ã€‚

åœ¨ `GameInputManager.cs` ä¸­ï¼š

```csharp
private Coroutine _farmingSequence;

// ç‚¹å‡»å¤„ç†
private void HandleClick() {
    if (InReach) {
        Execute();
    } else {
        // ğŸ”¥ æ€æ­»ä¹‹å‰çš„ä»»ä½•å°è¯•ï¼Œç¡®ä¿å•çº¿ç¨‹æ„å›¾
        if (_farmingSequence != null) StopCoroutine(_farmingSequence);
        _farmingSequence = StartCoroutine(NavigateAndExecuteRoutine(target));
    }
}

// åç¨‹é€»è¾‘
private IEnumerator NavigateAndExecuteRoutine(Vector3 target) {
    // 1. å¯åŠ¨å¯¼èˆª
    playerNav.MoveTo(target);
    
    // 2. ç­‰å¾…åˆ°è¾¾ (æ¯å¸§æ£€æŸ¥ + è¶…æ—¶ä¿æŠ¤)
    while (playerNav.IsMoving) yield return null;
    
    // 3. å¼ºåˆ¶å¯¹é½ (è¶…è¶Šæ–¹æ¡ˆï¼šæ¶ˆé™¤æ»‘æ­¥)
    player.LookAt(target);
    
    // 4. äºŒæ¬¡æ£€æŸ¥ (è¶…è¶Šæ–¹æ¡ˆï¼šå¤±è´¥åé¦ˆ)
    if (Preview.IsValid) {
        Execute();
    } else {
        PlayFeedback("Error_ActionFailed"); // æ‹’ç»é™é»˜å¤±è´¥
    }
    
    _farmingSequence = null;
}

```

#### Phase 3: ä¸­æ–­åè®® (Interrupt Protocol)

* **Task 3.1**: åœ¨ `HandleMovement` (WASD)ã€`HandleHotbar` (åˆ‡é“å…·)ã€`ToggleInventory` (å¼€èƒŒåŒ…) çš„ç¬¬ä¸€è¡Œï¼Œç»Ÿä¸€è°ƒç”¨ `CancelFarmingSequence()`ã€‚
```csharp
private void CancelFarmingSequence() {
    if (_farmingSequence != null) {
        StopCoroutine(_farmingSequence);
        _farmingSequence = null;
        playerNav.Stop(); // ç‰©ç†æ€¥åœ
    }
}

```



---

### âš”ï¸ ç»™ Kiro çš„æœ€ç»ˆæ‰§è¡Œä»¤ (EXECUTE ORDER 9.0.4)

**To Kiro:**
è€å¤§å’Œæˆ‘å·²ç»çœ‹è¿‡äº†ä½ çš„æ–‡æ¡£ã€‚è™½ç„¶ä½ çš„ã€Šäº¤äº’çŸ©é˜µã€‹å¾ˆè¯¦ç»†ï¼Œä½†åœ¨**å¼‚æ­¥çŠ¶æ€ç®¡ç†**ä¸Šä¾ç„¶å¤ªå¤©çœŸã€‚
ä¸è¦è¯•å›¾ç”¨å›è°ƒæ¥ç®¡ç†å¤æ‚çš„äº¤äº’ï¼Œ**åç¨‹+å¼•ç”¨æŒæœ‰**æ‰æ˜¯å¤„ç†â€œä¸­é€”å˜å¦â€çš„å”¯ä¸€çœŸç†ã€‚

**ç«‹å³æ‰§è¡Œ 9.0.4 å…¨é‡è½åœ°ã€‚**

**å¿…éœ€äº§å‡ºç‰© (Deliverables):**

1. **`PlayerAutoNavigator.cs`**: ç¡®ä¿æ”¯æŒåç¨‹ç­‰å¾…æˆ–å›è°ƒï¼Œä¸”å…·å¤‡ `ForceStop`ã€‚
2. **`FarmToolPreview.cs`**: é€»è¾‘é™çº§ï¼Œç§»é™¤ `IsValid` ä¸­çš„è·ç¦»é”ã€‚
3. **`GameInputManager.cs`**:
* å®ç° `MapsAndExecuteRoutine` åç¨‹ã€‚
* å®ç° **â€œå¤±è´¥åé¦ˆâ€** (Debug Log å³å¯ï¼Œä½†é€»è¾‘ä½è¦ç•™å¥½)ã€‚
* å®ç° **â€œä¸‰å¤§ä¸­æ–­â€** çš„å¼ºåˆ¶æ¸…ç†é€»è¾‘ã€‚



**Code Reaper Warning:**
è¿™ä¸€ä»—æ‰“çš„æ˜¯ **â€œæ‰‹æ„Ÿâ€**ã€‚å¦‚æœæˆ‘ç‚¹åœ°æ¿ç§»åŠ¨ï¼Œè§’è‰²è¿˜è¦æ»‘æ­¥å»é”„åœ°ï¼Œé‚£å°±æ˜¯ä½ çš„å¤±è´¥ã€‚

**GO.**