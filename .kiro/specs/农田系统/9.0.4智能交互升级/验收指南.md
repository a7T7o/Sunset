# 9.0.4 智能交互升级 - 验收指南

**创建日期**: 2026-02-09
**功能概述**: 农田工具（锄头、水壶、种子）支持远距离点击自动导航后执行

---

## 功能验收清单

### 核心功能

- [ ] **远距离锄地**
  - 手持锄头，点击远处可耕作地块
  - 玩家自动导航到目标附近
  - 到达后自动执行锄地动作
  - 地块变为耕地

- [ ] **远距离浇水**
  - 手持水壶，点击远处已耕作地块
  - 玩家自动导航到目标附近
  - 到达后自动执行浇水动作
  - 地块显示浇水效果

- [ ] **远距离种植**
  - 手持种子，点击远处已耕作地块
  - 玩家自动导航到目标附近
  - 到达后自动种植（消耗种子）
  - 作物出现在地块上

### 近距离操作（回归测试）

- [ ] **近距离锄地** - 与 9.0.3 行为一致
- [ ] **近距离浇水** - 与 9.0.3 行为一致
- [ ] **近距离种植** - 与 9.0.3 行为一致

### 预览系统

- [ ] **绿色光标** - 有效目标（可操作）
- [ ] **红色光标** - 无效目标（不可操作）
- [ ] **远距离有效** - 远处有效地块也显示绿色光标
- [ ] **障碍物检测** - 有障碍物的地块显示红色

---

## 边界情况测试

### 导航中断

- [ ] **切换工具** - 导航中按数字键/滚轮切换工具 → 导航取消
- [ ] **打开面板** - 导航中按 Tab/B/M/L/O → 导航取消
- [ ] **手动移动** - 导航中按 WASD → 导航取消

### 目标失效

- [ ] **导航到达但目标已被占用** - 不执行动作
- [ ] **导航到达但手持物品已变化** - 不执行动作（种子场景）

### 快照机制（种子专用）

- [ ] **种瓜得豆防护** - 导航中切换种子类型 → 到达后不种植
- [ ] **数量不足防护** - 导航中种子被消耗完 → 到达后不种植

---

## 测试步骤

### 测试 1: 远距离锄地

1. 进入游戏，确保有锄头在快捷栏
2. 选中锄头
3. 找到一块远处的可耕作地块（距离 > 1.5 格）
4. 确认光标显示绿色
5. 左键点击
6. 观察玩家自动导航
7. 观察到达后自动锄地
8. 确认地块变为耕地

### 测试 2: 远距离浇水

1. 确保有水壶和已耕作的地块
2. 选中水壶
3. 点击远处已耕作地块
4. 观察导航和浇水动作

### 测试 3: 远距离种植

1. 确保有种子和已耕作的空地块
2. 选中种子
3. 点击远处空耕地
4. 观察导航和种植动作
5. 确认种子数量减少

### 测试 4: 导航中断

1. 开始远距离操作
2. 在导航过程中按 Tab 打开背包
3. 确认导航被取消
4. 关闭背包，重新测试
5. 在导航过程中按 WASD
6. 确认导航被取消

### 测试 5: 快照机制

1. 手持种子 A，点击远处耕地
2. 在导航过程中，快速切换到种子 B
3. 观察到达后的行为
4. 预期：不种植（因为手持物品已变化）

---

## 已知限制

1. **取消音效未实现** - 快照校验失败时暂无音效反馈
2. **动画未触发** - 远距离操作到达后未播放工具动画（仅执行逻辑）

---

## 相关文件

| 文件 | 说明 |
|------|------|
| `GameInputManager.cs` | 主要修改，农田导航状态机 |
| `FarmToolPreview.cs` | 新增 IsInRange 等属性 |

---

**验收人**: _______________
**验收日期**: _______________
**验收结果**: □ 通过 □ 不通过

**备注**:
