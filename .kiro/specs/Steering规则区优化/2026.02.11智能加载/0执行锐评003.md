我是**编码助手（锐评专家形态）**。

**老大，收到。**
这回我彻底明白了。原来刚才只是“演习”，真正的“实装”还没开始。
既然我们还在设计阶段，而且你要的是**“完美”**，那我们就不能只停留在 Kiro 那个“关键词匹配表”的水平上（那是 V3.5 的产物）。

要实现 **Phase 4.0 级别的完美意图检测**，我们需要把“查字典”升级为**“神经反射”**。

我们需要在 `rules.md` 里植入一段**“元认知指令（Meta-Cognitive Instruction）”**，强制 AI 在干活前先进行一次**思维链（Chain of Thought）分析**。

以下是为你设计的**《意图驱动引擎架构》**，以及需要写入 `rules.md` 的具体内容。

---

### 🧠 核心理念：从“匹配”进化到“路由”

目前的逻辑是：

* 用户说“苹果” -> AI 找“水果.md”。（死板）

完美的逻辑应该是：

* 用户说“苹果” -> AI 分析：是想吃（消耗品）？是想种（农田）？还是想扔（物理交互）？
* 如果是“种苹果” -> 加载 `farming.md` + `trees.md`。
* 如果是“吃苹果” -> 加载 `items.md`。



---

### 🛠️ 实施方案：重写 `rules.md` 的智能加载章节

请将 `rules.md` 末尾的 `智能规则加载` 章节替换为以下**增强版**。这段指令利用了 LLM 的推理能力，强制它进行意图分析。

#### 📄 请复制以下内容覆盖 `rules.md` 末尾的相应章节：

```markdown
## 🔴🔴🔴 智能意图识别与规则路由 (Phase 4.0) 🔴🔴🔴

> **此协议适用于每次对话交互。AI 必须先理解"用户想要什么"，再决定"调用什么知识"。**
> **核心原则：宁可多加载相关规则，不可遗漏隐式约束。**

### 🧠 意图分析流程 (The Thought Process)

在执行任何任务前，必须进行以下三步推演（无需输出推演过程，但必须执行）：

1. **显式意图提取 (Explicit Intent)**
   - 用户直接提到的系统名词。
   - *例："修改背包UI"* -> 命中 `UI`, `Inventory`。

2. **隐式意图推断 (Implicit Intent)**
   - 用户描述的症状、体验或抽象概念。
   - *例："感觉走路有点飘"* -> 推断为物理/运动控制 -> 命中 `rules.md` (中心点规则) + `animation.md` (帧同步)。
   - *例："我想加个新功能"* -> 推断为架构设计 -> 命中 `layers.md` + `communication.md`。
   - *例："这代码太烂了"* -> 推断为代码审查 -> 命中 `code-reaper-review.md`。

3. **上下文关联 (Contextual Link)**
   - 当前正在处理的模块是什么？
   - *例*：上一轮在改树木，这一轮用户只说"掉落不对"，系统必须知道这是"树木的掉落" -> 命中 `trees.md` + `items.md`。

### 🗺️ 意图路由矩阵 (The Routing Matrix)

根据分析结果，按以下维度加载规则（支持多维组合）：

#### 🎨 表现层 (Presentation)
- **视觉/界面/交互**
  - 关键词/意图：UI, 面板, 拖拽, 图标, 布局, HUD, 提示
  - **加载**: `.kiro/steering/ui.md`
- **动画/反馈**
  - 关键词/意图：动作, 播放, 卡顿, 帧, 动画机, 特效, 手感
  - **加载**: `.kiro/steering/animation.md`

#### 💾 数据层 (Data)
- **静态配置 (SO)**
  - 关键词/意图：新建物品, 修改属性, ID, SO, ScriptableObject, 配置
  - **加载**: `.kiro/steering/so-design.md` (结构) + `.kiro/steering/items.md` (内容)
- **动态数据/存档**
  - 关键词/意图：存档, 读档, 丢失, 保存, 序列化, JSON
  - **加载**: `.kiro/steering/systems.md` (核心系统)

#### ⚙️ 逻辑与系统层 (Logic & Systems)
- **环境/世界交互**
  - 关键词/意图：树, 石头, 采集, 砍伐, 生成, 地图, 场景
  - **加载**: `.kiro/steering/trees.md` + `.kiro/steering/placeable-items.md`
- **核心系统**
  - 关键词/意图：时间, 季节, 导航, 寻路, 遮挡, 排序, 渲染
  - **加载**: `.kiro/steering/systems.md`
- **农田/种植 (归档区)**
  - 关键词/意图：种田, 浇水, 作物, 生长, 土地
  - **加载**: `.kiro/steering/archive/farming.md`

#### 🛡️ 质量与维护层 (QA & Ops)
- **审查与锐评**
  - 关键词/意图：锐评, 审查, Review, 检查, 审计, 烂代码, 优化
  - **加载**: `.kiro/steering/code-reaper-review.md`
- **调试与日志**
  - 关键词/意图：报错, Bug, 异常, Log, 调试, 崩溃, 没反应
  - **加载**: `.kiro/steering/debug-logging-standards.md`
- **项目维护**
  - 关键词/意图：清理, 重构, 文件夹, 命名, 整理, 结构
  - **加载**: `.kiro/steering/maintenance-guidelines.md` + `.kiro/steering/archive/structure.md`

### ⚡ 自动加载触发器

一旦确定意图，**立即使用 `File Fetcher` 加载对应文件**。
- **不要询问用户**："是否需要加载XX规则？" -> **直接加载**。
- **不要重复加载**：如果当前会话已读取过该文件，则跳过。
- **P0 规则兜底**：`rules.md`, `layers.md`, `communication.md` 永远在内存中，无需重新加载。

```

---

### 🧐 为什么这个版本更“完美”？

1. **引入了“隐式意图”**：
* 旧版：必须说“UI”才加载 UI 规则。
* 新版：你说“图标歪了”，它就知道是 UI 问题；你说“手感滑”，它就知道是动画或物理问题。这才是智能。


2. **建立了“上下文关联”**：
* 它会根据上一轮对话的状态来补全这一轮的意图，防止断片。


3. **矩阵式路由**：
* 不再是一对一的线性映射，而是多对多的矩阵。
* 比如“做一个带动画的 UI 图标”，它会同时加载 `ui.md` 和 `animation.md`，实现跨领域知识融合。



**老大，请把这段内容更新到 `rules.md` 中。**
这将赋予下一个 Gemini **“察言观色”的能力，而不仅仅是“按图索骥”**。