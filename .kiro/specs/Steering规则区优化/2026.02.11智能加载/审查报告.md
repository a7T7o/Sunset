# Steering 规则全面审查报告

**审查日期**: 2026-02-11
**审查范围**: `.kiro/steering/` 下所有规则文件（含 archive）
**审查目的**: 优化机会、完整性缺口、缺陷/矛盾、效率评估

---

## 一、总体概况

| 指标 | 数值 |
|------|------|
| 规则文件总数 | 19（14 主目录 + 5 归档） |
| 默认加载（always） | 8 个（P0×4 + README + maintenance + code-reaper-review + debug-logging） |
| 手动加载（manual） | 11 个（P1×7 + P2×4） |
| 归档（archive） | 5 个 |
| 估算默认 Token 消耗 | ~8,000-10,000 tokens |

### 🔴 关键发现：默认加载数量膨胀

原始方案 A 设计为"只加载 P0 的 4 个文件"，但实际上 `code-reaper-review.md`、`debug-logging-standards.md`、`README.md`、`maintenance-guidelines.md` 也设为 `inclusion: always`，导致默认加载从 4 个膨胀到 8 个。

---

## 二、逐文件效率评估

### P0 - 默认加载文件

| 文件 | 估算 Tokens | 效率评分 | 问题 |
|------|------------|---------|------|
| `rules.md` | ~2,500 | ⭐⭐⭐⭐ | 内容密度高，但"智能规则加载"章节占 ~30%，每次对话都加载但只在对话开始时用一次 |
| `layers.md` | ~1,200 | ⭐⭐⭐⭐⭐ | 精炼，核心信息密度高，无冗余 |
| `workspace-memory.md` | ~1,500 | ⭐⭐⭐⭐ | 内容必要，但"代码文件追踪规范"章节较长 |
| `communication.md` | ~800 | ⭐⭐⭐⭐⭐ | 精炼，一条龙模式和语言规范都是高频使用 |
| `000-context-recovery.md` | ~200 | ⭐⭐⭐⭐⭐ | 极精炼，P-1 优先级合理 |
| `code-reaper-review.md` | ~2,000 | ⭐⭐⭐ | 🔴 问题：只有处理锐评时才需要，但设为 always 加载 |
| `debug-logging-standards.md` | ~1,200 | ⭐⭐⭐ | 🔴 问题：只有写代码时才需要，但设为 always 加载 |
| `README.md` | ~800 | ⭐⭐⭐ | 索引文件，AI 自己不太需要每次都读 |
| `maintenance-guidelines.md` | ~2,500 | ⭐⭐ | 🔴 问题：维护规范只在修改 steering 文件时需要，但每次都加载 |

### P1 - 手动加载文件

| 文件 | 估算 Tokens | 效率评分 | 问题 |
|------|------------|---------|------|
| `animation.md` | ~2,000 | ⭐⭐⭐⭐ | 内容密度高，Direction 映射是关键易错点 |
| `ui.md` | ~1,500 | ⭐⭐⭐⭐ | 结构清晰，快捷键表格实用 |
| `so-design.md` | ~1,800 | ⭐⭐⭐⭐ | ID 分配表是核心参考，SO 工具同步规则重要 |
| `items.md` | ~1,800 | ⭐⭐⭐ | 🟡 与 `so-design.md` 有 ~30% 内容重叠（ID 分配、品质系统） |
| `systems.md` | ~1,500 | ⭐⭐⭐⭐ | 多系统合一，信息密度高 |
| `trees.md` | ~1,800 | ⭐⭐⭐⭐ | 游戏数值表是核心，不可精简 |
| `placeable-items.md` | ~800 | ⭐⭐⭐⭐⭐ | 精炼，检查清单实用 |

### P2 - 手动加载文件

| 文件 | 估算 Tokens | 效率评分 | 问题 |
|------|------------|---------|------|
| `coding-standards.md` | ~2,000 | ⭐⭐⭐ | 🟡 EventBus/ServiceLocator/ObjectPool 规范可能与实际代码不一致 |
| `documentation.md` | ~1,500 | ⭐⭐⭐⭐ | 日志式记录规范实用 |
| `scene-modification-rule.md` | ~500 | ⭐⭐⭐⭐⭐ | 精炼，核心原则清晰 |
| `scene-hierarchy-sync.md` | ~500 | ⭐⭐⭐ | 🟡 引用的文档路径可能已过时（"待创建"的文档） |

### Archive 文件

| 文件 | 估算 Tokens | 效率评分 | 问题 |
|------|------------|---------|------|
| `archive/product.md` | ~800 | ⭐⭐⭐ | 中文概述够用，英文部分可能过时 |
| `archive/tech.md` | ~800 | ⭐⭐⭐ | 包版本可能已过时 |
| `archive/structure.md` | ~1,000 | ⭐⭐ | 🟡 目录结构与实际不符（实际是 YYY_Scripts 而非 Scripts） |
| `archive/progress.md` | ~800 | ⭐⭐⭐⭐ | 中文概述已更新到 2026-02-06，较新 |
| `archive/farming.md` | ~600 | ⭐⭐⭐ | 基础规范，可能需要更新 |


---

## 三、🔴 关键缺陷与矛盾

### 缺陷 1：默认加载膨胀（严重）

**问题**：方案 A 的初衷是"只加载 4 个 P0 文件"，但后续新增的 `code-reaper-review.md`、`debug-logging-standards.md`、`README.md`、`maintenance-guidelines.md` 都设为 `inclusion: always`，实际默认加载 8 个文件。

**影响**：默认 Token 消耗从预期的 ~4,000 膨胀到 ~8,000-10,000，几乎回到优化前水平。

**建议**：
- `code-reaper-review.md` → 改为 `manual`，加入智能加载（关键词：锐评、Code Reaper、审计）
- `debug-logging-standards.md` → 改为 `manual`，加入智能加载（关键词：日志、Debug、Log）
- `maintenance-guidelines.md` → 改为 `manual`（只在修改 steering 文件时需要）
- `README.md` → 改为 `manual`（AI 已有智能加载映射表，不需要每次读索引）

### 缺陷 2：items.md 与 so-design.md 内容重叠（中等）

**重叠内容**：
- 物品 ID 分配表：两个文件都有完整的 ID 范围定义
- 品质系统：`items.md` 定义了 5 级品质（Normal/Copper/Silver/Gold/Iridium），`so-design.md` 定义了 4 级品质（Normal/Rare/Epic/Legendary）
- ToolData/WeaponData 字段：两个文件都列出了字段定义

**🔴 矛盾**：品质系统定义不一致！
- `items.md`：Normal(1.0) / Copper(1.25) / Silver(1.5) / Gold(2.0) / Iridium(2.5)
- `so-design.md`：Normal(1.0) / Rare(1.25) / Epic(2.0) / Legendary(3.25)

**建议**：确认哪个是正确的品质系统，统一到 `so-design.md`（作为 SO 设计的权威文档），`items.md` 改为引用。

### 缺陷 3：structure.md 与实际项目结构不符（中等）

**问题**：`archive/structure.md` 描述的目录结构是 `Assets/Scripts/`，但实际项目使用 `Assets/YYY_Scripts/`。脚本子目录的组织方式也与实际不同。

**建议**：更新 `structure.md` 或标注"此文档描述的是规划结构，实际结构可能有差异"。

### 缺陷 4：scene-hierarchy-sync.md 引用不存在的文档（轻微）

**问题**：引用了 `Docx/全局场景层级/世界物体层级.md`（待创建）和 `Docx/全局场景层级/玩家层级.md`（待创建），这些文档从未创建。

**建议**：要么创建这些文档，要么移除引用。

### 缺陷 5：coding-standards.md 中的架构模式可能未实际使用（轻微）

**问题**：`coding-standards.md` 定义了 EventBus、ServiceLocator、ObjectPool 等模式的使用规范，但从项目代码来看，这些模式可能尚未全面实施（代码中仍大量使用静态事件和 FindFirstObjectByType）。

**建议**：标注哪些是"已实施"、哪些是"规划中"，避免误导。


---

## 四、完整性缺口

### 缺口 1：缺少"存档系统"规则

项目已有完整的存档系统（SaveManager、DynamicObjectFactory、PersistentObjectRegistry 等），但没有对应的 steering 规则文件。存档系统有很多易错点（GUID 管理、动态对象重建、渲染层级存档），应该有专门的规范。

**建议**：创建 `save-system.md`（P1），包含存档系统的核心规范。

### 缺口 2：缺少"箱子/交互系统"规则

箱子系统（ChestController、BoxPanelUI）和交互系统（IInteractable）有复杂的互斥逻辑和 UI 联动，但只在 `maintenance-guidelines.md` 的附录中有部分描述。

**建议**：如果箱子系统还会继续开发，考虑创建独立规则。

### 缺口 3：placeable-items.md 缺少农田放置规范

`placeable-items.md` 只覆盖了树苗和箱子的放置，但农田系统的放置逻辑（FarmTileManager、PlacementGridCalculator）有独特的规范（多格放置、边界管理），未被覆盖。

**建议**：在 `placeable-items.md` 或 `archive/farming.md` 中补充农田放置规范。

### 缺口 4：智能加载映射表不完整

`rules.md` 中的智能加载映射表缺少以下关键词：
- 存档、Save、SaveManager → 无对应规则文件
- 箱子、Chest、Box → 应映射到 `ui.md` 或新规则
- 锐评、Code Reaper → 应映射到 `code-reaper-review.md`（如果改为 manual）
- 日志、Debug、Log → 应映射到 `debug-logging-standards.md`（如果改为 manual）

---

## 五、优化建议汇总

### 优先级 P0（建议立即执行）

| # | 建议 | 预期收益 |
|---|------|---------|
| 1 | 将 `code-reaper-review.md` 改为 manual + 智能加载 | 节省 ~2,000 tokens/对话 |
| 2 | 将 `debug-logging-standards.md` 改为 manual + 智能加载 | 节省 ~1,200 tokens/对话 |
| 3 | 将 `maintenance-guidelines.md` 改为 manual | 节省 ~2,500 tokens/对话 |
| 4 | 将 `README.md` 改为 manual | 节省 ~800 tokens/对话 |
| 5 | 统一品质系统定义（items.md vs so-design.md 矛盾） | 消除数据矛盾 |

**预期总收益**：默认 Token 消耗从 ~10,000 降至 ~4,500（回到方案 A 的设计目标）

### 优先级 P1（建议近期执行）

| # | 建议 | 预期收益 |
|---|------|---------|
| 6 | 更新 `archive/structure.md` 的目录结构 | 消除过时信息 |
| 7 | 补充智能加载映射表（锐评、日志等关键词） | 提高智能加载覆盖率 |
| 8 | 消除 items.md 与 so-design.md 的 ID 分配重复 | 减少维护成本 |
| 9 | 修复 scene-hierarchy-sync.md 的无效引用 | 消除误导 |

### 优先级 P2（建议后续执行）

| # | 建议 | 预期收益 |
|---|------|---------|
| 10 | 标注 coding-standards.md 中未实施的架构模式 | 避免误导 |
| 11 | 考虑创建存档系统规则文件 | 减少存档相关错误 |
| 12 | 补充农田放置规范 | 完善放置系统覆盖 |

---

## 六、规则体系健康度评分

| 维度 | 评分 | 说明 |
|------|------|------|
| 核心规则完整性 | 9/10 | P0 规则覆盖了最关键的约束 |
| 信息一致性 | 6/10 | 品质系统矛盾、ID 表重复、结构文档过时 |
| 加载效率 | 5/10 | 默认加载膨胀，偏离方案 A 设计目标 |
| 可维护性 | 8/10 | 有完善的维护规范和审查流程 |
| 智能加载覆盖率 | 7/10 | 映射表基本覆盖，但缺少锐评/日志/存档等关键词 |
| 文档时效性 | 7/10 | 大部分文档较新，但 structure.md 和部分 archive 过时 |
| **综合** | **7/10** | 体系框架优秀，但有膨胀和一致性问题需要修复 |

---

**审查结论**：规则体系的框架设计很好（分层、索引、维护规范），但在实际演进过程中出现了"默认加载膨胀"和"信息不一致"两个主要问题。最紧迫的是将 4 个不必要的 always 文件改回 manual，恢复方案 A 的设计初衷。
