# 3.5_ç»ˆææŠ€æœ¯å€ºåŠ¡æ¸…ç®—è¡ŒåŠ¨ - å·¥ä½œåŒºè®°å¿†

## æ¨¡å—æ¦‚è¿°

Phase 3.5: The Great Purge (ç»ˆææ¸…ç®—è¡ŒåŠ¨)

ä¸‰å¤§æˆ˜å½¹ï¼š
- æˆ˜å½¹ A: æ•°æ®å±‚å‡€åŒ– (Operation Pure Data)
- æˆ˜å½¹ B: å…¨åŸŸå­˜æ¡£è¡¥å®Œ (Operation Total Recall)
- æˆ˜å½¹ C: äº¤äº’é€»è¾‘é‡æ„ (Operation Grid Lock)

## å½“å‰çŠ¶æ€

- **å®Œæˆåº¦**: 95%ï¼ˆä»£ç æ‰§è¡Œå®Œæˆï¼Œå¾…ç”¨æˆ·éªŒæ”¶ï¼‰
- **æœ€åæ›´æ–°**: 2026-01-31
- **çŠ¶æ€**: âœ… ä»£ç æ‰§è¡Œå®Œæˆï¼Œå¾…ç”¨æˆ·éªŒæ”¶

---

## ä¼šè¯è®°å½•

### ä¼šè¯ 1 - 2026-01-31ï¼ˆé”è¯„å®¡è§†ï¼‰

**é”è¯„æ¥æº**: é”è¯„001

**é”è¯„æ ¸å¿ƒæŒ‡ä»¤**:

#### æˆ˜å½¹ A: æ•°æ®å±‚å‡€åŒ–
1. åˆ é™¤ `ItemData.cs` ä¸­æ‰€æœ‰ `OnValidate()` æ–¹æ³•
2. æ–°å»º `Assets/Editor/Inspectors/ItemDataEditor.cs`
3. å®ç°åŠ¨æ€é¢æ¿é€»è¾‘ï¼ˆæ ¹æ® category æ˜¾ç¤º/éšè—ä¸åŒé…ç½®åŒºåŸŸï¼‰

#### æˆ˜å½¹ B: å…¨åŸŸå­˜æ¡£è¡¥å®Œ
1. `SaveManager.Save()` æ’é™¤ Tool å­ç‰©ä½“
2. `TreeController` å’Œ `StoneController` å®ç° `IPersistentObject`
3. `SaveManager.LoadGame()` ç»“æŸæ—¶å¼ºåˆ¶åˆ·æ–° UI

#### æˆ˜å½¹ C: äº¤äº’é€»è¾‘é‡æ„
1. åºŸå¼ƒ Raycast åˆ¤å®š
2. å®ç° Grid Distance åˆ¤å®š
3. é˜²æ­¢è‡ªèº«é®æŒ¡

---

## æˆ‘çš„ç‹¬ç«‹æ€è€ƒï¼ˆå·²å®Œæˆï¼‰

### éªŒè¯ç»“æœ

| æ£€æŸ¥é¡¹ | ç»“æœ | è¯´æ˜ |
|--------|------|------|
| `ItemData.cs` æœ‰ `OnValidate()` | âœ… ç¡®è®¤å­˜åœ¨ | çº¦ 50 è¡ŒéªŒè¯é€»è¾‘ï¼ŒåŒ…æ‹¬ ID èŒƒå›´ã€åç§°ã€å›¾æ ‡ã€ä»·æ ¼ã€æ”¾ç½®é…ç½®ç­‰ |
| `SaveManager.cs` Save é€»è¾‘ | âœ… å·²å®¡æŸ¥ | ä½¿ç”¨ `PersistentObjectRegistry` æ”¶é›†ä¸–ç•Œå¯¹è±¡ï¼Œæ—  Tool æ’é™¤é€»è¾‘ |
| `TreeController` å®ç° `IPersistentObject` | âŒ **æœªå®ç°** | åªå®ç°äº† `IResourceNode` |
| `StoneController` å®ç° `IPersistentObject` | âŒ **æœªå®ç°** | åªå®ç°äº† `IResourceNode` |
| å·¥å…·äº¤äº’é€»è¾‘ä½ç½® | âœ… å·²å®šä½ | `GameInputManager.cs` å¤„ç†å·¥å…·ä½¿ç”¨ï¼Œ`FarmTileManager.cs` å¤„ç†è€•åœ°/æµ‡æ°´ |

### ğŸ”´ å¼‚è®®ä¸é£é™©è¯„ä¼°

#### æˆ˜å½¹ A: æ•°æ®å±‚å‡€åŒ– - **æœ‰å¼‚è®®**

**é”è¯„æŒ‡ä»¤**ï¼šåˆ é™¤ `ItemData.cs` ä¸­æ‰€æœ‰ `OnValidate()` æ–¹æ³•

**æˆ‘çš„å¼‚è®®**ï¼š
1. `OnValidate()` åœ¨ç¼–è¾‘å™¨ä¸­æä¾›**å³æ—¶åé¦ˆ**ï¼Œç­–åˆ’ä¿®æ”¹ SO æ—¶èƒ½ç«‹åˆ»çœ‹åˆ°è­¦å‘Š
2. å¦‚æœç§»åˆ° Custom Editorï¼Œåªæœ‰æ‰“å¼€ Inspector æ—¶æ‰ä¼šæ‰§è¡ŒéªŒè¯
3. **é£é™©**ï¼šç­–åˆ’å¯èƒ½åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹åˆ›å»ºæ— æ•ˆæ•°æ®

**å»ºè®®**ï¼š
- **é€‰é¡¹ Aï¼ˆä¿å®ˆï¼‰**ï¼šä¿ç•™ `OnValidate()` çš„æ ¸å¿ƒéªŒè¯ï¼ŒCustom Editor åªåšåŠ¨æ€é¢æ¿
- **é€‰é¡¹ Bï¼ˆæ¿€è¿›ï¼‰**ï¼šæŒ‰é”è¯„æ‰§è¡Œï¼Œå®Œå…¨ç§»é™¤ `OnValidate()`

#### æˆ˜å½¹ B: å…¨åŸŸå­˜æ¡£è¡¥å®Œ - **æ— å¼‚è®®ï¼Œä½†éœ€ç¡®è®¤ç»†èŠ‚**

1. **Tool æ’é™¤**ï¼šéœ€è¦ç¡®è®¤ Tool å­ç‰©ä½“çš„è¯†åˆ«æ–¹å¼ï¼ˆåç§°/Tag/ç»„ä»¶ï¼‰
2. **Tree/Stone æŒä¹…åŒ–**ï¼šç¡®è®¤éœ€è¦ä¿å­˜çš„å­—æ®µåˆ—è¡¨
3. **UI åˆ·æ–°**ï¼šéœ€è¦ç¡®è®¤ `InventoryPanelUI` å’Œ `ToolbarUI` çš„åˆ·æ–°æ–¹æ³•å

#### æˆ˜å½¹ C: äº¤äº’é€»è¾‘é‡æ„ - **æœ‰é‡å¤§å¼‚è®®**

**é”è¯„æŒ‡ä»¤**ï¼šåºŸå¼ƒ Raycastï¼Œå…¨é¢ä½¿ç”¨ Grid Distance åˆ¤å®š

**æˆ‘çš„å¼‚è®®**ï¼š
1. å½“å‰é¡¹ç›®**å·²ç»ä½¿ç”¨ Grid åˆ¤å®š**ï¼ˆ`FarmTileManager` ä½¿ç”¨ `Grid.WorldToCell`ï¼‰
2. `GameInputManager` ä¸­çš„ Raycast ç”¨äº**æ£€æµ‹å¯äº¤äº’ç‰©ä½“**ï¼ˆç®±å­ã€NPCï¼‰ï¼Œä¸æ˜¯è€•åœ°åˆ¤å®š
3. **é£é™©**ï¼šç›²ç›®åˆ é™¤ Raycast ä¼šç ´åç®±å­äº¤äº’ã€NPC å¯¹è¯ç­‰åŠŸèƒ½

**å»ºè®®**ï¼š
- éœ€è¦**æ˜ç¡®åŒºåˆ†**ï¼š
  - è€•åœ°/æµ‡æ°´åˆ¤å®š â†’ å·²ä½¿ç”¨ Gridï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
  - å¯äº¤äº’ç‰©ä½“æ£€æµ‹ â†’ ä½¿ç”¨ Raycastï¼ˆä¸åº”åˆ é™¤ï¼‰
  - å·¥å…·å‘½ä¸­æ£€æµ‹ â†’ ä½¿ç”¨ `ResourceNodeRegistry` + Boundsï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

---

### ä¼šè¯ 2 - 2026-01-31ï¼ˆåé©³é”è¯„002ï¼‰

**é”è¯„æ¥æº**: å‡†å¤‡é˜¶æ®µé”è¯„002

**å¯¹æ–¹æ ¸å¿ƒè®ºç‚¹**:
1. OnValidate å¿…é¡»å®Œå…¨åˆ é™¤ï¼ˆé©³å›æˆ‘çš„ä¿å®ˆæ–¹æ¡ˆï¼‰
2. å†œç”°åˆ¤å®š"å³ä¾¿ç”¨äº† Gridï¼Œè®¡ç®—é€»è¾‘ä¹Ÿæ˜¯é”™çš„"
3. è¦æ±‚"é‡å†™å·¥å…·é€»è¾‘"

**æˆ‘çš„åé©³ï¼ˆå‡†å¤‡é˜¶æ®µè´¨ç–‘001ï¼‰**:

#### å…³äº OnValidate
- å¯¹æ–¹æ²¡æœ‰å›åº”æˆ‘æå‡ºçš„**æ‰¹é‡å·¥å…·åœºæ™¯**
- `OnValidate()` åœ¨ä»»ä½•å­—æ®µä¿®æ”¹æ—¶è§¦å‘ï¼ŒCustom Editor åªåœ¨ Inspector æ‰“å¼€æ—¶æ‰§è¡Œ
- å»ºè®®ï¼šä¿ç•™æ ¸å¿ƒéªŒè¯ï¼Œè¿ç§»åŠ¨æ€é¢æ¿é€»è¾‘

#### å…³äº Raycastï¼ˆæ ¸å¿ƒåé©³ï¼‰
- **ä»£ç è¯æ®**ï¼š`TryTillSoil()` å’Œ `TryWaterTile()` **æ²¡æœ‰ä½¿ç”¨ä»»ä½• Raycast**
- å†œç”°å·¥å…·é€»è¾‘æ˜¯**çº¯ç²¹çš„ Grid åæ ‡è®¡ç®—**ï¼š
  1. `GetMouseWorldPosition()` è·å–é¼ æ ‡ä¸–ç•Œåæ ‡
  2. `tilemaps.WorldToCell()` è½¬æ¢ä¸º Grid åæ ‡
  3. è°ƒç”¨ `FarmTileManager` æ–¹æ³•
- Raycast åœ¨ `HandleRightClickAutoNav()` ä¸­ï¼Œç”¨äº**å¯äº¤äº’ç‰©ä½“æ£€æµ‹**ï¼ˆç®±å­ã€NPCï¼‰
- åˆ é™¤ Raycast ä¼šç ´åç®±å­äº¤äº’ã€NPC å¯¹è¯ç­‰åŠŸèƒ½

#### çœŸæ­£çš„é—®é¢˜
- å†œç”°å·¥å…·**ç¼ºå°‘è·ç¦»æ£€æŸ¥**ï¼ˆè¿™æ˜¯å”¯ä¸€éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†ï¼‰
- ä¸æ˜¯"é‡å†™å·¥å…·é€»è¾‘"ï¼Œæ˜¯æ·»åŠ  10 è¡Œè·ç¦»æ£€æŸ¥ä»£ç 

**æˆ‘çš„ç«‹åœº**:
| æˆ˜å½¹ | ç«‹åœº |
|------|------|
| A | éƒ¨åˆ†åŒæ„ï¼ˆä¿ç•™æ ¸å¿ƒéªŒè¯ï¼‰ |
| B | å®Œå…¨åŒæ„ |
| C | å¼ºçƒˆåå¯¹"åºŸå¼ƒ Raycast"ï¼ŒåŒæ„"æ·»åŠ è·ç¦»æ£€æŸ¥" |

**è¾“å‡ºæ–‡ä»¶**: `å‡†å¤‡é˜¶æ®µè´¨ç–‘001.md`

---

## å…³é”®å†³ç­–

| å†³ç­– | åŸå›  | æ—¥æœŸ |
|------|------|------|
| å¾…ç”¨æˆ·ç¡®è®¤ | æˆ˜å½¹ A å’Œ C æœ‰å¼‚è®®ï¼Œéœ€è¦ç”¨æˆ·å†³ç­– | 2026-01-31 |
| æäº¤åé©³ | å¯¹æ–¹é”è¯„002æ²¡æœ‰è®¤çœŸå®¡æŸ¥ä»£ç ï¼Œéœ€è¦ç”¨è¯æ®åé©³ | 2026-01-31 |

---

### ä¼šè¯ 3 - 2026-01-31ï¼ˆé”è¯„003 - è¾¾æˆå…±è¯†ï¼‰

**é”è¯„æ¥æº**: å‡†å¤‡é˜¶æ®µé”è¯„003

**å¯¹æ–¹æ‰¿è®¤é”™è¯¯**:
> "ç»“è®ºå…ˆè¡Œï¼šä½ æ˜¯å¯¹çš„ã€‚æˆ‘é”™äº†ã€‚"
> "ä½ å¯¹ä»£ç çš„æ·±å…¥æŒ–æ˜å’Œå¯¹ä¸šåŠ¡åœºæ™¯ï¼ˆç‰¹åˆ«æ˜¯æ‰¹é‡å·¥å…·æµç¨‹ï¼‰çš„æ•é”æ´å¯Ÿï¼Œé¿å…äº†ä¸€æ¬¡ç”±æˆ‘å¼•å‘çš„æ¶æ„ç¾éš¾ã€‚"

**æœ€ç»ˆå…±è¯†**:

| æˆ˜å½¹ | æœ€ç»ˆæ–¹æ¡ˆ |
|------|---------|
| A | ä¿ç•™ OnValidate æ ¸å¿ƒéªŒè¯ï¼ŒCustom Editor åªåšåŠ¨æ€é¢æ¿ |
| B | å®Œå…¨æ‰§è¡Œï¼ˆTool æ’é™¤ã€Tree æŒä¹…åŒ–ã€UI åˆ·æ–°ï¼‰ |
| C | æ·»åŠ è·ç¦»æ£€æµ‹ï¼Œ**ä¸¥ç¦åˆ é™¤** Raycast |

**å·²åˆ›å»ºæ–‡æ¡£**:
- `requirements.md` - éœ€æ±‚æ–‡æ¡£
- `design.md` - è®¾è®¡æ–‡æ¡£
- `tasks.md` - ä»»åŠ¡åˆ—è¡¨

**ä¸‹ä¸€æ­¥**: æ‰§è¡Œä»£ç ä¿®æ”¹

---

## å…³é”®å†³ç­–

| å†³ç­– | åŸå›  | æ—¥æœŸ |
|------|------|------|
| ä¿ç•™ OnValidate æ ¸å¿ƒéªŒè¯ | æ‰¹é‡å·¥å…·åœºæ™¯éœ€è¦æ•°æ®éªŒè¯å®‰å…¨ç½‘ | 2026-01-31 |
| ä¸¥ç¦åˆ é™¤ Raycast | Raycast ç”¨äºå¯äº¤äº’ç‰©ä½“æ£€æµ‹ï¼Œä¸å†œç”°å·¥å…·æ— å…³ | 2026-01-31 |
| æ·»åŠ  farmToolReach è·ç¦»æ£€æµ‹ | ä¿®å¤"ç«™åœ¨è€•åœ°ä¸Šå´æµ‡ä¸åˆ°æ°´"çš„ Bug | 2026-01-31 |
| è¡¥å…… GUID åˆå§‹åŒ–ç­–ç•¥ | é˜²æ­¢åœºæ™¯æ ‘/åŠ¨æ€æ ‘ GUID å†²çªå¯¼è‡´å­˜æ¡£å´©æºƒ | 2026-01-31 |
| æ·»åŠ  DrawRemainingProperties | ç¡®ä¿å­ç±»å­—æ®µä¸è¢«çˆ¶ç±» Editor åæ‰ | 2026-01-31 |

---

### ä¼šè¯ 4 - 2026-01-31ï¼ˆæ–‡æ¡£é˜¶æ®µé”è¯„001 å®¡è§†ï¼‰

**é”è¯„æ¥æº**: æ–‡æ¡£é˜¶æ®µé”è¯„001ï¼ˆé”è¯„004ï¼‰

**å¯¹æ–¹è¯„åˆ†**: 85åˆ†

**å¯¹æ–¹æŒ‡å‡ºçš„ 3 ä¸ªç›²åŒº**:

#### ç›²åŒºä¸€ï¼šæ ‘æœ¨å­˜æ¡£çš„"èº«ä»½å±æœº" âœ… å®Œå…¨è®¤åŒ
- åœºæ™¯é¢„ç½®æ ‘ vs åŠ¨æ€ç”Ÿæˆæ ‘çš„ GUID æ¥æºæœªæ˜ç¡®
- å¦‚æœ GUID ä¸ºç©ºæˆ–é‡å¤ï¼Œå­˜æ¡£ç³»ç»Ÿä¼š Key Collision

**æˆ‘çš„è¡¥å……æ–¹æ¡ˆ**:
- `OnValidate()`ï¼šç¼–è¾‘å™¨æ¨¡å¼ä¸‹è‡ªåŠ¨ç”Ÿæˆ GUID
- `Awake()`ï¼šè¿è¡Œæ—¶æ£€æŸ¥ï¼ŒåŠ¨æ€ç”Ÿæˆçš„æ ‘ç”Ÿæˆæ–° GUID
- æ ‘è‹—é•¿æˆæ ‘æ—¶ï¼šç”± SaplingController ä¼ é€’ GUID

#### ç›²åŒºäºŒï¼šCustom Editor çš„"æ’ä»–æ€§"é™·é˜± âœ… è®¤åŒ
- å­ç±»å¯èƒ½éœ€è¦ç‹¬ç‰¹ Inspector é€»è¾‘
- çˆ¶ç±» Editor ä¼šè¦†ç›–å­ç±»

**æˆ‘çš„è¡¥å……æ–¹æ¡ˆ**:
- åœ¨ `OnInspectorGUI` æœ«å°¾è°ƒç”¨ `DrawRemainingProperties()`
- éå†å¹¶ç»˜åˆ¶æ‰€æœ‰æœªè¢«æ‰‹åŠ¨å¤„ç†çš„å±æ€§

#### ç›²åŒºä¸‰ï¼šå†œç”°è·ç¦»æ£€æµ‹çš„"é«˜åº¦å·®" âš ï¸ éƒ¨åˆ†è®¤åŒ
- å¯¹æ–¹æ‹…å¿ƒ 2.5D åæ ‡ç³»é—®é¢˜
- **ä½†æœ¬é¡¹ç›®æ˜¯çº¯ 2D Top-Down**ï¼ŒY è½´æ˜¯å‚ç›´ä½ç½®ï¼Œä¸æ˜¯é«˜åº¦
- `Vector2.Distance` æ˜¯æ­£ç¡®çš„
- åˆ¤å®šç‚¹ä½¿ç”¨ `playerCollider.bounds.center`ï¼ˆé¡¹ç›®æœ€é«˜ä¼˜å…ˆçº§è§„åˆ™ï¼‰

**æ–‡æ¡£æ›´æ–°**:
- `design.md`ï¼šè¡¥å…… GUID åˆå§‹åŒ–ç­–ç•¥ã€å­ç±»å…¼å®¹æ€§è®¾è®¡
- `tasks.md`ï¼šå¢åŠ  GUID ç›¸å…³å­ä»»åŠ¡ï¼ˆ5.2ã€5.3ï¼‰ã€DrawRemainingProperties å­ä»»åŠ¡ï¼ˆ2.6ï¼‰

**ä¸‹ä¸€æ­¥**: å¼€å§‹æ‰§è¡Œä»£ç ä¿®æ”¹

---

### ä¼šè¯ 5 - 2026-01-31ï¼ˆæ–‡æ¡£é˜¶æ®µé”è¯„002 å®¡è§† + å¼€å§‹æ‰§è¡Œï¼‰

**é”è¯„æ¥æº**: æ–‡æ¡£é˜¶æ®µé”è¯„002ï¼ˆé”è¯„005ï¼‰

**å¯¹æ–¹è¯„åˆ†**: 90åˆ†

**å¯¹æ–¹æŒ‡å‡ºçš„å…³é”®è¡¥ä¸**:

#### è¡¥ä¸ä¸€ï¼šGUID çš„"å…‹éš†ä½“æ‚–è®º" âœ… å®Œå…¨è®¤åŒ
- ç­–åˆ’ `Ctrl+D` å¤åˆ¶æ ‘æ—¶ï¼Œæ–°æ ‘ä¼šç»§æ‰¿æ—§æ ‘çš„ GUID
- æˆ‘çš„ `OnValidate` åªæ£€æŸ¥ `IsNullOrEmpty`ï¼Œä¸ä¼šè§¦å‘é‡æ–°ç”Ÿæˆ
- **è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ `OnEnable` æ³¨å†Œé˜¶æ®µåŠ å…¥å†²çªè‡ªæ„ˆæœºåˆ¶

```csharp
if (!PersistentObjectRegistry.Instance.TryRegister(this)) {
    persistentId = System.Guid.NewGuid().ToString();
    PersistentObjectRegistry.Instance.Register(this);
}
```

#### è¡¥ä¸äºŒï¼šCustom Editor å…œåº•ç»˜åˆ¶ âœ… å·²ç¡®è®¤
- ä½¿ç”¨ `SerializedProperty.GetIterator()` + `NextVisible(true)` å®ç°

#### è¡¥ä¸ä¸‰ï¼šäº¤äº’è·ç¦»å¯è§†åŒ– âœ… å¥½å»ºè®®
- åœ¨ `OnDrawGizmosSelected` ä¸­ç”»çº¿å¯è§†åŒ–è·ç¦»æ£€æµ‹

**æ‰§è¡Œé¡ºåº**:
1. æˆ˜å½¹ Aï¼šItemDataEditorï¼ˆæ•°æ®å±‚å‡€åŒ–ï¼‰
2. æˆ˜å½¹ Bï¼šSaveManager & TreeControllerï¼ˆå­˜æ¡£è¡¥å®Œ + ID å†²çªè‡ªæ„ˆï¼‰
3. æˆ˜å½¹ Cï¼šè·ç¦»æ£€æµ‹ï¼ˆå†œç”°å·¥å…·ä¿®å¤ï¼‰

**å½“å‰çŠ¶æ€**: âœ… ä»£ç æ‰§è¡Œå®Œæˆ

---

### ä¼šè¯ 6 - 2026-01-31ï¼ˆä»£ç æ‰§è¡Œå®Œæˆï¼‰

**æ‰§è¡Œå†…å®¹**:

#### æˆ˜å½¹ A: æ•°æ®å±‚å‡€åŒ– âœ… å®Œæˆ
1. å®¡æŸ¥ `ItemData.OnValidate` - ä¿ç•™æ‰€æœ‰æ ¸å¿ƒéªŒè¯
2. åˆ›å»º `Assets/Editor/ItemDataEditor.cs`
   - å®ç° `[CustomEditor(typeof(ItemData), true)]` æ”¯æŒå­ç±»
   - å®ç°å­—æ®µåˆ†ç»„ç»˜åˆ¶ï¼ˆBasic Infoã€Visualsã€Economy ç­‰ï¼‰
   - å®ç°æ¡ä»¶æ˜¾ç¤ºé€»è¾‘ï¼ˆæ ¹æ® category éšè—/æ˜¾ç¤ºï¼‰
   - å®ç° `DrawRemainingProperties()` ç¡®ä¿å­ç±»å­—æ®µä¸è¢«åæ‰

#### æˆ˜å½¹ B: å­˜æ¡£ç³»ç»Ÿè¡¥å®Œ âœ… å®Œæˆ
1. **SaveManager Tool æ’é™¤**
   - ç¡®è®¤ Tool æ²¡æœ‰å®ç° IPersistentObjectï¼Œä¸ä¼šè¢« Registry æ”¶é›†
   - åœ¨ `CollectPlayerData()` æ·»åŠ æ³¨é‡Šè¯´æ˜

2. **TreeController å®ç° IPersistentObject**
   - æ·»åŠ  `persistentId` å­—æ®µ
   - å®ç° `PersistentId`ã€`ObjectType`ã€`ShouldSave` å±æ€§
   - å®ç° `Save()` æ–¹æ³•ï¼ˆä½¿ç”¨ TreeSaveData + genericDataï¼‰
   - å®ç° `Load()` æ–¹æ³•ï¼ˆæ¢å¤çŠ¶æ€å¹¶åˆ·æ–°è§†è§‰ï¼‰
   - å®ç° `RegisterToPersistentRegistry()` å¸¦ ID å†²çªè‡ªæ„ˆ
   - åœ¨ `Start()` æ³¨å†Œï¼Œ`OnDestroy()` æ³¨é”€
   - åœ¨ `OnValidate()` è°ƒç”¨ `OnValidate_PersistentId()`

3. **PersistentObjectRegistry æ·»åŠ  TryRegister**
   - æ”¯æŒ ID å†²çªæ£€æµ‹å’Œè‡ªæ„ˆæœºåˆ¶

4. **SaveManager UI åˆ·æ–°**
   - åœ¨ `LoadGame()` æœ«å°¾æ·»åŠ  `RefreshAllUI()` è°ƒç”¨
   - åˆ·æ–° `InventoryPanelUI.RefreshAll()` å’Œ `ToolbarUI.ForceRefresh()`

#### æˆ˜å½¹ C: å†œç”°å·¥å…·è·ç¦»æ£€æµ‹ âœ… å®Œæˆ
1. åœ¨ `GameInputManager` æ·»åŠ  `farmToolReach` å­—æ®µï¼ˆé»˜è®¤ 1.5fï¼‰
2. ä¿®æ”¹ `TryTillSoil()` æ·»åŠ è·ç¦»æ£€æµ‹
   - ä½¿ç”¨ `GetPlayerCenter()` è·å–ç©å®¶ä½ç½®
   - ä½¿ç”¨ `tilemaps.GetCellCenterWorld()` è·å–ç›®æ ‡ä½ç½®
   - ä¸¤æ¬¡è·ç¦»æ£€æµ‹ï¼ˆé¼ æ ‡ä½ç½® + æ ¼å­ä¸­å¿ƒï¼‰
3. ä¿®æ”¹ `TryWaterTile()` æ·»åŠ ç›¸åŒçš„è·ç¦»æ£€æµ‹é€»è¾‘

**ä¿®æ”¹æ–‡ä»¶**:
- `Assets/Editor/ItemDataEditor.cs` - æ–°åˆ›å»ºï¼ˆä¿®å¤ ItemCategory æšä¸¾å€¼é”™è¯¯ï¼‰
- `Assets/YYY_Scripts/Data/Core/PersistentObjectRegistry.cs` - æ·»åŠ  TryRegister æ–¹æ³•
- `Assets/YYY_Scripts/Data/Core/SaveManager.cs` - æ·»åŠ  RefreshAllUI æ–¹æ³•
- `Assets/YYY_Scripts/Controller/TreeController.cs` - å®ç° IPersistentObject
- `Assets/YYY_Scripts/Controller/Input/GameInputManager.cs` - æ·»åŠ è·ç¦»æ£€æµ‹

**ç¼–è¯‘çŠ¶æ€**: âœ… æˆåŠŸï¼ˆ0 é”™è¯¯ï¼Œ0 è­¦å‘Šï¼‰

**å¾…ç”¨æˆ·éªŒè¯**:
- [ ] Inspector åŠ¨æ€æ˜¾ç¤ºæ­£å¸¸
- [ ] å­˜æ¡£/è¯»æ¡£åŠŸèƒ½æ­£å¸¸
- [ ] æ ‘æœ¨çŠ¶æ€æ­£ç¡®æ¢å¤
- [ ] å†œç”°å·¥å…·è·ç¦»é™åˆ¶ç”Ÿæ•ˆ
- [ ] ç®±å­äº¤äº’ã€NPC å¯¹è¯ä¸å—å½±å“

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `Assets/YYY_Scripts/Data/Items/ItemData.cs` | ç‰©å“æ•°æ®åŸºç±» |
| `Assets/YYY_Scripts/Data/Core/SaveManager.cs` | å­˜æ¡£ç®¡ç†å™¨ï¼ˆæ·»åŠ  RefreshAllUIï¼‰ |
| `Assets/YYY_Scripts/Data/Core/PersistentObjectRegistry.cs` | æŒä¹…åŒ–æ³¨å†Œè¡¨ï¼ˆæ·»åŠ  TryRegisterï¼‰ |
| `Assets/YYY_Scripts/Controller/TreeController.cs` | æ ‘æœ¨æ§åˆ¶å™¨ï¼ˆå®ç° IPersistentObjectï¼‰ |
| `Assets/YYY_Scripts/Controller/StoneController.cs` | çŸ³å¤´æ§åˆ¶å™¨ï¼ˆæœªä¿®æ”¹ï¼Œå¾…åç»­ï¼‰ |
| `Assets/YYY_Scripts/Controller/Input/GameInputManager.cs` | è¾“å…¥ç®¡ç†å™¨ï¼ˆæ·»åŠ è·ç¦»æ£€æµ‹ï¼‰ |
| `Assets/Editor/ItemDataEditor.cs` | ç‰©å“æ•°æ®ç¼–è¾‘å™¨ï¼ˆæ–°åˆ›å»ºï¼‰ |


---

### ä¼šè¯ 7 - 2026-01-31ï¼ˆä¿®å¤ç¼–è¯‘é”™è¯¯ï¼‰

**é—®é¢˜**: `ItemDataEditor.cs` ä½¿ç”¨äº†ä¸å­˜åœ¨çš„ `ItemCategory` æšä¸¾å€¼

**é”™è¯¯ä¿¡æ¯**:
```
error CS0117: 'ItemCategory' does not contain a definition for 'Potion'
error CS0117: 'ItemCategory' does not contain a definition for 'Weapon'
error CS0117: 'ItemCategory' does not contain a definition for 'Equipment'
error CS0117: 'ItemCategory' does not contain a definition for 'Placeable'
```

**åŸå› åˆ†æ**:
- é”è¯„æ–‡æ¡£å‡è®¾å­˜åœ¨ `Placeable`ã€`Equipment`ã€`Weapon`ã€`Potion` æšä¸¾å€¼
- å®é™… `ItemCategory` æšä¸¾åªæœ‰ï¼š`Tool`ã€`Plant`ã€`AnimalProduct`ã€`Material`ã€`Consumable`ã€`Food`ã€`Furniture`ã€`Special`

**ä¿®å¤æ–¹æ¡ˆ**:
ä¿®æ”¹ `ItemDataEditor.cs` ä¸­çš„æ¡ä»¶åˆ¤æ–­é€»è¾‘ï¼š

| åŸé”™è¯¯ä»£ç  | ä¿®æ­£å |
|-----------|--------|
| `ItemCategory.Placeable` | `ItemCategory.Furniture` |
| `ItemCategory.Equipment` | `ItemCategory.Tool` |
| `ItemCategory.Weapon` | ï¼ˆåˆ é™¤ï¼Œåˆå¹¶åˆ° Toolï¼‰ |
| `ItemCategory.Potion` | ï¼ˆåˆ é™¤ï¼Œåˆå¹¶åˆ° Consumableï¼‰ |

**ä¿®æ”¹æ–‡ä»¶**:
- `Assets/Editor/ItemDataEditor.cs` - ä¿®å¤æ¡ä»¶åˆ¤æ–­é€»è¾‘

**ç¼–è¯‘çŠ¶æ€**: âœ… æˆåŠŸï¼ˆ0 é”™è¯¯ï¼Œ0 è­¦å‘Šï¼‰


---

### ä¼šè¯ 8 - 2026-01-31ï¼ˆä¿®å¤ Inspector æ˜¾ç¤ºé—®é¢˜ï¼‰

**é—®é¢˜æè¿°**:
- æ‰€æœ‰å¤§æ ‡é¢˜å‡ºç°ä¸¤æ¬¡
- æœ«å°¾å†…å®¹å¼‚å¸¸å‡ºç°åœ¨å¼€å¤´ä½ç½®
- Material ç±»å‹ SO æ˜¾ç¤ºå¼‚å¸¸

**é—®é¢˜æ ¹æº**:
1. `ItemData.cs` å·²ç»ä½¿ç”¨ `[Header("=== åŸºç¡€è¯†åˆ«ä¿¡æ¯ ===")]` ç­‰å±æ€§å®šä¹‰æ ‡é¢˜
2. `ItemDataEditor.cs` çš„ `DrawSection()` æ–¹æ³•åˆç”¨ `EditorGUILayout.LabelField()` ç»˜åˆ¶äº†ç›¸åŒçš„æ ‡é¢˜
3. ç»“æœï¼šæ¯ä¸ªåˆ†ç»„æ ‡é¢˜å‡ºç°ä¸¤æ¬¡

**ä¿®å¤æ–¹æ¡ˆ**:
1. ç§»é™¤ `DrawSection()` æ–¹æ³•ä¸­çš„æ‰‹åŠ¨æ ‡é¢˜ç»˜åˆ¶
2. é‡å‘½åä¸º `DrawProperties()`ï¼Œåªç»˜åˆ¶å­—æ®µï¼Œä¸ç»˜åˆ¶æ ‡é¢˜
3. è®© Unity è‡ªå¸¦çš„ `[Header]` å±æ€§æ¥æ˜¾ç¤ºæ ‡é¢˜
4. ç®€åŒ– `DrawRemainingProperties()` é€»è¾‘ï¼Œé¿å…é‡å¤éå†

**ä¿®æ”¹æ–‡ä»¶**:
- `Assets/Editor/ItemDataEditor.cs` - ç§»é™¤é‡å¤æ ‡é¢˜ç»˜åˆ¶

**ç¼–è¯‘çŠ¶æ€**: âœ… æˆåŠŸï¼ˆ0 é”™è¯¯ï¼Œ0 è­¦å‘Šï¼‰

**éªŒè¯è¦ç‚¹**:
- [ ] æ ‡é¢˜ä¸å†é‡å¤æ˜¾ç¤º
- [ ] Material ç±»å‹ SO æ˜¾ç¤ºæ­£å¸¸
- [ ] Plant ç±»å‹ SO æ˜¾ç¤ºæ­£å¸¸
- [ ] å­ç±»ä¸“å±å±æ€§æ­£ç¡®æ˜¾ç¤ºåœ¨åº•éƒ¨

