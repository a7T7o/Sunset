# è‡ªåŠ¨åŒ–å­˜æ¡£ç³»ç»Ÿ - å¼€å‘è®°å¿†

## æ¨¡å—æ¦‚è¿°

å¯¹å­˜æ¡£ç³»ç»Ÿè¿›è¡Œæ¶æ„çº§é‡æ„ï¼Œä»"æ‰‹åŠ¨é…ç½®ã€é€ä¸ªä¿®è¡¥"è½¬å‘"è‡ªåŠ¨åŒ–ã€ç»Ÿä¸€ç®¡ç†"çš„è®¾è®¡ç†å¿µã€‚

## å½“å‰çŠ¶æ€

- **å®Œæˆåº¦**: 90%ï¼ˆä»£ç å®Œæˆï¼Œå¾…ç”¨æˆ·éªŒè¯ï¼‰
- **æœ€åæ›´æ–°**: 2026-02-03
- **çŠ¶æ€**: å·²å®Œæˆä»£ç å®ç°ï¼Œå¾…ç”¨æˆ·åœ¨ Unity ä¸­éªŒè¯

## ä¼šè¯è®°å½•

### ä¼šè¯ 3 - 2026-02-03ï¼ˆä¸€æ¡é¾™æ‰§è¡Œï¼‰

**ç”¨æˆ·éœ€æ±‚**:
> å®¡æ ¸é”è¯„002ï¼Œå¦‚æœæ— å¼‚è®®åˆ™ä¸€æ¡é¾™å®Œæˆæ‰€æœ‰ä»»åŠ¡

**é”è¯„002 å®¡æ ¸ç»“æœ**:
- Code Reaper è¯„åˆ† 98åˆ† (S+)ï¼Œå…¨é¢é€šè¿‡
- å”¯ä¸€æé†’ï¼šåˆ›å»º PrefabDatabase.asset æ—¶éœ€è¦é¢„å¡«å……é»˜è®¤åˆ«åæ•°æ®

**æ‰§è¡Œè¿‡ç¨‹**:

1. **ç¼–è¯‘é”™è¯¯ä¿®å¤**
   - é—®é¢˜ï¼š`PrefabDatabase.cs` ç¼ºå°‘ `.meta` æ–‡ä»¶ï¼Œå¯¼è‡´ Unity æ— æ³•è¯†åˆ«
   - è§£å†³ï¼šæ‰§è¡Œ `Assets/Refresh` èœå•å‘½ä»¤ï¼ŒUnity è‡ªåŠ¨ç”Ÿæˆ `.meta` æ–‡ä»¶
   - ç»“æœï¼šç¼–è¯‘æˆåŠŸï¼ˆ0 é”™è¯¯ï¼Œ0 è­¦å‘Šï¼‰

2. **åˆ›å»º PrefabDatabase.asset**
   - æ‰§è¡Œèœå•ï¼š`FarmGame/PrefabDatabase/åˆ›å»º PrefabDatabase`
   - æ‰«æç»“æœï¼š57 ä¸ªé¢„åˆ¶ä½“
   - é»˜è®¤åˆ«åï¼š5 ä¸ªï¼ˆç®±å­ ID æ˜ å°„ï¼‰

**å®Œæˆä»»åŠ¡**:
- âœ… é˜¶æ®µ 1ï¼šæ ¸å¿ƒç»„ä»¶ï¼ˆPrefabDatabase.csã€ç¼–è¾‘å™¨å·¥å…·ï¼‰
- âœ… é˜¶æ®µ 2ï¼šé›†æˆæ”¹é€ ï¼ˆDynamicObjectFactoryã€ChestControllerã€PersistentManagersï¼‰
- âœ… é˜¶æ®µ 3ï¼šé…ç½®ä¸éªŒè¯ï¼ˆPrefabDatabase.assetã€æ ‡è®°æ—§ä»£ç åºŸå¼ƒï¼‰
- â³ é˜¶æ®µ 4ï¼šæµ‹è¯•éªŒè¯ï¼ˆå¾…ç”¨æˆ·æ‰‹åŠ¨éªŒè¯ï¼‰

**æ–°å¢æ–‡ä»¶**:
- `Assets/YYY_Scripts/Data/Core/PrefabDatabase.cs` - é¢„åˆ¶ä½“æ•°æ®åº“æ ¸å¿ƒç±»
- `Assets/Editor/PrefabDatabaseEditor.cs` - è‡ªå®šä¹‰ç¼–è¾‘å™¨
- `Assets/Editor/PrefabDatabaseAutoScanner.cs` - è‡ªåŠ¨æ‰«æå™¨
- `Assets/111_Data/Database/PrefabDatabase.asset` - æ•°æ®åº“èµ„äº§

**ä¿®æ”¹æ–‡ä»¶**:
- `Assets/YYY_Scripts/Data/Core/DynamicObjectFactory.cs` - ä½¿ç”¨ PrefabDatabase
- `Assets/YYY_Scripts/World/Placeable/ChestController.cs` - Save() ä½¿ç”¨ä¸–ç•Œé¢„åˆ¶ä½“åç§°
- `Assets/YYY_Scripts/Service/PersistentManagers.cs` - æ·»åŠ  PrefabDatabase åˆå§‹åŒ–
- `Assets/YYY_Scripts/Data/Core/PrefabRegistry.cs` - æ ‡è®°ä¸ºåºŸå¼ƒ

---

### ä¼šè¯ 2 - 2026-02-03ï¼ˆé”è¯„å®¡æ ¸ï¼‰

**é”è¯„æ¥æº**: é”è¯„001 - Code Reaper åŒæ ¸éªŒæ”¶

**é”è¯„æ ¸å¿ƒè§‚ç‚¹**:
1. 3.7.4 çš„ä¿®å¤ä»£ç ï¼ˆçŸ³å¤´å‡æ­»ã€ç®±å­å•æ•°æ®æºã€æ‰è½ç‰©å…³è”ï¼‰é€šè¿‡éªŒæ”¶
2. 3.7.5 å­˜åœ¨**è‡´å‘½æ–­å±‚**ï¼šæ—§å­˜æ¡£ IDï¼ˆ`M1`, `Storage_1400_...`ï¼‰ä¸æ–°ç³»ç»Ÿè‡ªåŠ¨æ‰«æçš„é¢„åˆ¶ä½“åç§°ï¼ˆ`Tree_M1_00`, `Box_1`ï¼‰ä¸åŒ¹é…
3. éœ€è¦å®ç°**ID åˆ«åæ˜ å°„**ï¼ˆæ™ºèƒ½ç¿»è¯‘å±‚ï¼‰

**æˆ‘çš„ç‹¬ç«‹æ€è€ƒ**:
- è®¤åŒ Code Reaper æŒ‡å‡ºçš„ ID ä¸å…¼å®¹é—®é¢˜ï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªè‡´å‘½æ–­å±‚
- ä½†æˆ‘å»ºè®®ç”¨**é…ç½®åŒ–çš„åˆ«ååˆ—è¡¨**è€Œéç¡¬ç¼–ç ï¼ŒåŸå› ï¼š
  1. æ›´çµæ´»ï¼šå¯ä»¥åœ¨ Inspector ä¸­ç›´æ¥é…ç½®ï¼Œä¸éœ€è¦æ”¹ä»£ç 
  2. æ›´æ˜“ç»´æŠ¤ï¼šæ–°å¢æ˜ å°„åªéœ€è¦æ·»åŠ é…ç½®é¡¹
  3. æ›´é€æ˜ï¼šæ‰€æœ‰æ˜ å°„å…³ç³»ä¸€ç›®äº†ç„¶

**è®¾è®¡æ›´æ–°**:
1. åœ¨ `design.md` ä¸­æ·»åŠ äº† `AliasEntry` ç±»å’Œ `ResolvePrefabId()` æ–¹æ³•
2. åœ¨ `tasks.md` ä¸­æ·»åŠ äº† ID åˆ«åæ˜ å°„ç›¸å…³ä»»åŠ¡ï¼ˆ1.3 èŠ‚ï¼‰
3. åœ¨é…ç½®ä»»åŠ¡ä¸­æ·»åŠ äº†åˆ«åé…ç½®æ­¥éª¤ï¼ˆ6.1.4ï¼‰
4. åœ¨éªŒè¯ä»»åŠ¡ä¸­æ·»åŠ äº†åˆ«åæ˜ å°„éªŒè¯ï¼ˆ8.3.2, 8.3.3ï¼‰

---

### ä¼šè¯ 1 - 2026-02-03

**ç”¨æˆ·éœ€æ±‚**:
> æˆ‘å¸Œæœ›ä½ æŠŠä½ çš„æ–¹æ¡ˆè§„åˆ’è¿˜æœ‰æè®®æ€è·¯éƒ½å†™å…¥è¿™ä¸ªæ–‡ä»¶å¤¹...æˆ‘å¸Œæœ›ä¸è¦å±€é™ï¼Œä½ å¤§å¯ä»¥å¤§æ‰‹ä¸€æŒ¥é‡æ„ï¼Œä½†æ˜¯è¯·ä½ ä¸è¦è¿‡åº¦æ‹˜æŸè®©è®¾è®¡å˜æˆé’ˆå¯¹å°ä¼—é—®é¢˜çš„ä¸€æ­¥æ­¥é€€è®©å’Œå¦¥åï¼Œæˆ‘å¸Œæœ›ä½ æœ‰è‡ªå·±çš„æ€è€ƒå’Œå¤§å±€æ„è¯†

**æˆ‘çš„ç†è§£**:

ç”¨æˆ·å¸Œæœ›æˆ‘è·³å‡º"ä¿®è¡¥æ¼æ´"çš„æ€ç»´æ¨¡å¼ï¼Œä»æ¶æ„å±‚é¢é‡æ–°å®¡è§†å­˜æ¡£ç³»ç»Ÿï¼Œæå‡ºä¸€ä¸ªå®Œæ•´ã€è‡ªåŠ¨åŒ–ã€å¯æ‰©å±•çš„æ–¹æ¡ˆã€‚

**å®Œæˆä»»åŠ¡**:
1. åˆ›å»ºå·¥ä½œåŒº
2. æ’°å†™æ¶æ„åˆ†ææ–‡æ¡£ - æ­£è§†å½“å‰å­˜æ¡£ç³»ç»Ÿçš„æ ¹æœ¬é—®é¢˜
3. æ’°å†™æ–¹æ¡ˆè®¾è®¡æ–‡æ¡£ - æå‡º PrefabDatabase è‡ªåŠ¨åŒ–æ–¹æ¡ˆ
4. åˆ›å»º requirements.md - 6 ä¸ªç”¨æˆ·æ•…äº‹ï¼Œå®Œæ•´çš„éªŒæ”¶æ ‡å‡†
5. åˆ›å»º design.md - è¯¦ç»†çš„ç»„ä»¶è®¾è®¡å’Œæ•°æ®æµ
6. åˆ›å»º tasks.md - 4 ä¸ªé˜¶æ®µï¼Œ8 ä¸ªä¸»ä»»åŠ¡

---

## å…³é”®å†³ç­–

| å†³ç­– | åŸå›  | æ—¥æœŸ |
|------|------|------|
| åˆ›å»º PrefabDatabase æ›¿ä»£ PrefabRegistry | æ”¯æŒè‡ªåŠ¨æ‰«æã€æ™ºèƒ½å›é€€ï¼Œè§£å†³æ‰‹åŠ¨é…ç½®é—®é¢˜ | 2026-02-03 |
| prefabId ä½¿ç”¨é¢„åˆ¶ä½“åç§° | ç»Ÿä¸€å‘½åè§„èŒƒï¼Œæ¶ˆé™¤å†—ä½™å­—æ®µ | 2026-02-03 |
| ä¿ç•™ IPersistentObject æ¥å£ | å‘åå…¼å®¹ï¼Œæ¸è¿›å¼è¿ç§» | 2026-02-03 |
| å®ç°ç±»å‹æ¨æ–­å›é€€ | å…¼å®¹æ—§å­˜æ¡£ï¼Œæé«˜å®¹é”™æ€§ | 2026-02-03 |
| ä½¿ç”¨é…ç½®åŒ–åˆ«ååˆ—è¡¨è€Œéç¡¬ç¼–ç  | æ›´çµæ´»ã€æ›´æ˜“ç»´æŠ¤ã€æ›´é€æ˜ï¼ˆé”è¯„001 åé¦ˆï¼‰ | 2026-02-03 |

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `æ¶æ„åˆ†æ.md` | å½“å‰å­˜æ¡£ç³»ç»Ÿçš„é—®é¢˜åˆ†æï¼ˆæ­£è§†é—®é¢˜ï¼‰ |
| `æ–¹æ¡ˆè®¾è®¡.md` | è‡ªåŠ¨åŒ–å­˜æ¡£ç³»ç»Ÿçš„è®¾è®¡æ–¹æ¡ˆï¼ˆåˆæ­¥æ€è·¯ï¼‰ |
| `requirements.md` | éœ€æ±‚æ–‡æ¡£ï¼ˆ6 ä¸ªç”¨æˆ·æ•…äº‹ï¼‰ |
| `design.md` | è¯¦ç»†è®¾è®¡æ–‡æ¡£ï¼ˆç»„ä»¶è®¾è®¡ã€æ•°æ®æµï¼‰ |
| `tasks.md` | ä»»åŠ¡åˆ—è¡¨ï¼ˆ4 é˜¶æ®µ 8 ä¸»ä»»åŠ¡ï¼‰ |
| `é”è¯„001.md` | Code Reaper åŒæ ¸éªŒæ”¶æŠ¥å‘Š |
| `é”è¯„002.md` | Code Reaper ä»£ç å®¡æ ¸æŠ¥å‘Šï¼ˆ98åˆ† S+ï¼‰ |

## ä»£ç æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `Assets/YYY_Scripts/Data/Core/PrefabDatabase.cs` | æ–°å¢ | é¢„åˆ¶ä½“æ•°æ®åº“ |
| `Assets/Editor/PrefabDatabaseEditor.cs` | æ–°å¢ | ç¼–è¾‘å™¨å·¥å…· |
| `Assets/Editor/PrefabDatabaseAutoScanner.cs` | æ–°å¢ | è‡ªåŠ¨æ‰«æå™¨ |
| `Assets/111_Data/Database/PrefabDatabase.asset` | æ–°å¢ | æ•°æ®åº“èµ„äº§ |
| `Assets/YYY_Scripts/Data/Core/DynamicObjectFactory.cs` | ä¿®æ”¹ | ä½¿ç”¨ PrefabDatabase |
| `Assets/YYY_Scripts/World/Placeable/ChestController.cs` | ä¿®æ”¹ | Save() ä½¿ç”¨é¢„åˆ¶ä½“åç§° |
| `Assets/YYY_Scripts/Service/PersistentManagers.cs` | ä¿®æ”¹ | åˆå§‹åŒ– PrefabDatabase |
| `Assets/YYY_Scripts/Data/Core/PrefabRegistry.cs` | ä¿®æ”¹ | æ ‡è®°ä¸ºåºŸå¼ƒ |


---

### ä¼šè¯ 4 - 2026-02-03ï¼ˆBug ä¿®å¤ï¼‰

**ç”¨æˆ·éœ€æ±‚**:
> æŒ–å–ç®±å­æ—¶åªåˆ é™¤äº† Box å­ç‰©ä½“ï¼Œæ²¡æœ‰åˆ é™¤ Box_1(Clone) çˆ¶ç‰©ä½“ï¼Œå¯¼è‡´åœºæ™¯ä¸­æ®‹ç•™ç©ºçš„çˆ¶ç‰©ä½“

**é—®é¢˜åˆ†æ**:
- ç®±å­å±‚çº§ç»“æ„ï¼š`Box_1(Clone)` çˆ¶ç‰©ä½“ â†’ `Box` å­ç‰©ä½“
- `ChestController` åœ¨ `Box` å­ç‰©ä½“ä¸Š
- `OnDestroyed()` æ–¹æ³•ä½¿ç”¨ `Destroy(gameObject)` åªåˆ é™¤äº†å­ç‰©ä½“
- çˆ¶ç‰©ä½“ `Box_1(Clone)` æ®‹ç•™åœ¨åœºæ™¯ä¸­

**ä¿®å¤æ–¹æ¡ˆ**:
ä¿®æ”¹ `OnDestroyed()` æ–¹æ³•ï¼Œæ£€æµ‹æ˜¯å¦æœ‰çˆ¶ç‰©ä½“ï¼Œå¦‚æœæœ‰åˆ™åˆ é™¤çˆ¶ç‰©ä½“ï¼š
```csharp
GameObject objectToDestroy = transform.parent != null ? transform.parent.gameObject : gameObject;
Destroy(objectToDestroy);
```

**ä¿®æ”¹æ–‡ä»¶**:
- `ChestController.cs` - ä¿®å¤ `OnDestroyed()` æ–¹æ³•ï¼Œåˆ é™¤æ•´ä¸ªç®±å­ç‰©ä½“ï¼ˆåŒ…æ‹¬çˆ¶ç‰©ä½“ï¼‰

**éªŒè¯ç»“æœ**:
- ç¼–è¯‘é€šè¿‡ï¼ˆ0 é”™è¯¯ï¼‰


---

### ä¼šè¯ 5 - 2026-02-05ï¼ˆæ¸²æŸ“å±‚çº§å­˜æ¡£ï¼‰

**ç”¨æˆ·éœ€æ±‚**:
> å­˜æ¡£ç³»ç»Ÿæ²¡æœ‰å­˜å‚¨å±‚çº§å‚æ•°ï¼ˆSorting Layer å’Œ Order in Layerï¼‰ï¼Œè¿™äº›å‚æ•°æ˜¯è¿è¡Œæ—¶åŠ¨æ€è®¡ç®—çš„ï¼Œä¸æ˜¯é¢„åˆ¶ä½“é»˜è®¤å€¼

**é—®é¢˜åˆ†æ**:
ä»ç”¨æˆ·æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼š
- **æ’åºå›¾å±‚ (Sorting Layer)**: `Layer 1`
- **å›¾å±‚é¡ºåº (Order in Layer)**: `-517`

è¿™äº›å‚æ•°æ˜¯æ ¹æ®ç‰©ä½“ Y åæ ‡åŠ¨æ€è®¡ç®—çš„ï¼Œç”¨äºæ­£ç¡®çš„æ¸²æŸ“é®æŒ¡å…³ç³»ã€‚å¦‚æœä¸ä¿å­˜ï¼ŒåŠ è½½å­˜æ¡£åç‰©ä½“ä¼šä½¿ç”¨é¢„åˆ¶ä½“é»˜è®¤å€¼ï¼Œå¯¼è‡´æ¸²æŸ“é¡ºåºé”™è¯¯ã€‚

**ä¿®å¤æ–¹æ¡ˆ**:

1. **æ‰©å±• WorldObjectSaveData**ï¼š
   - æ–°å¢ `sortingLayerName` å­—æ®µï¼ˆæ’åºå›¾å±‚åç§°ï¼‰
   - æ–°å¢ `sortingOrder` å­—æ®µï¼ˆå›¾å±‚é¡ºåºï¼‰
   - æ–°å¢ `SetSortingLayer()` æ–¹æ³•ï¼ˆä» SpriteRenderer è·å–ï¼‰
   - æ–°å¢ `RestoreSortingLayer()` æ–¹æ³•ï¼ˆåº”ç”¨åˆ° SpriteRendererï¼‰

2. **ä¿®æ”¹æ‰€æœ‰ IPersistentObject å®ç°**ï¼š
   - `ChestController.cs` - Save/Load æ·»åŠ æ¸²æŸ“å±‚çº§
   - `TreeController.cs` - Save/Load æ·»åŠ æ¸²æŸ“å±‚çº§
   - `StoneController.cs` - Save/Load æ·»åŠ æ¸²æŸ“å±‚çº§
   - `WorldItemPickup.cs` - Save/Load æ·»åŠ æ¸²æŸ“å±‚çº§

**ä¿®æ”¹æ–‡ä»¶**:
- `SaveDataDTOs.cs` - æ‰©å±• WorldObjectSaveDataï¼Œæ·»åŠ æ¸²æŸ“å±‚çº§å­—æ®µå’Œæ–¹æ³•
- `ChestController.cs` - Save/Load æ·»åŠ æ¸²æŸ“å±‚çº§ä¿å­˜/æ¢å¤
- `TreeController.cs` - Save/Load æ·»åŠ æ¸²æŸ“å±‚çº§ä¿å­˜/æ¢å¤
- `StoneController.cs` - Save/Load æ·»åŠ æ¸²æŸ“å±‚çº§ä¿å­˜/æ¢å¤
- `WorldItemPickup.cs` - Save/Load æ·»åŠ æ¸²æŸ“å±‚çº§ä¿å­˜/æ¢å¤

**éªŒè¯ç»“æœ**:
- ç¼–è¯‘é€šè¿‡ï¼ˆ0 é”™è¯¯ï¼‰

**ğŸ”´ é‡è¦è¯´æ˜**:
- `sortingLayerName` å’Œ `sortingOrder` æ˜¯ SpriteRenderer çš„æ¸²æŸ“å‚æ•°
- ä¸æ˜¯ GameObject.layerï¼ˆç‰©ç†å±‚ï¼‰
- ä¸æ˜¯ WorldObjectSaveData.layerï¼ˆæ¥¼å±‚ï¼‰
- è¿™äº›å‚æ•°é€šå¸¸æ ¹æ® Y åæ ‡åŠ¨æ€è®¡ç®—ï¼Œå¿…é¡»å­˜æ¡£ä¿å­˜
