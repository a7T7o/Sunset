# 锐评处理规范

**创建日期**: 2026-01-27
**适用范围**: 所有来自外部架构师/Code Reaper 的锐评文档
**优先级**: P0（最高优先级）

---

## 核心原则

锐评是来自外部架构师的专业审计报告，需要严肃对待、独立思考、规范执行。

---

## 锐评处理流程

### 第一步：创建/更新 Memory（必须先做！）

**在阅读锐评之前**，必须先确保工作区的 memory 文件存在：

1. **主工作区 memory**：`.kiro/specs/{工作区名}/memory.md`
2. **子工作区 memory**：`.kiro/specs/{工作区名}/{子工作区}/memory.md`

如果 memory 不存在，**立即创建**，记录：
- 工作区概述
- 当前状态
- 会话开始时间

### 第二步：阅读锐评

1. **完整阅读**：不要跳读，逐段理解
2. **记录要点**：在 memory 中记录锐评的核心指令
3. **标注疑虑**：对有疑问的指令做标记

### 第三步：独立思考与审视

**必须进行独立思考**，不能盲目执行：

1. **验证可行性**：检查指令涉及的文件是否存在
2. **评估影响**：删除/重命名操作会影响哪些代码
3. **识别风险**：是否会导致编译错误、Missing Script 等问题
4. **判断结论**：根据事实核查结果决定走哪条路径

### 第四步：根据核查结论分流（2026-02-11 重大修订）

#### 🟢 路径 A：完全认可 → 直接执行，不中断会话

**触发条件**：事实核查全部通过（全 ✅），无异议，无重大风险

**行为**：
- **不生成审视报告文件**（避免赘述浪费）
- **不中断会话等待用户确认**
- 在对话中简短说明"锐评核查通过，开始执行"（1-2句话）
- 直接进入第五步执行任务
- 执行完成后在 memory 中记录核查结论即可

#### 🟡 路径 B：部分认可/有小疑虑 → 简短说明后执行

**触发条件**：核心观点正确但有细节需注意（⚠️），不影响执行方向

**行为**：
- **不生成审视报告文件**
- 在对话中简短列出注意事项（3-5行）
- 直接进入第五步执行任务
- 在 memory 中记录疑虑点

#### 🔴 路径 C：有重大异议 → 生成审视报告，中断等待确认

**触发条件**：存在事实错误（❌）、架构误解、方向性分歧、高风险操作

**行为**：
- **生成审视报告文件**（按回应文档规范）
- 中断会话，向用户反馈异议
- 等待用户确认后再执行

**核心原则**：审视报告是用来表达异议的，不是用来表达认可的。完全认可就直接干。

### 第五步：执行

1. **按顺序执行**：不要跳过任何步骤
2. **每步汇报**：完成一个战场后简短汇报
3. **遇错中断**：如果执行过程中发现问题，立即中断并报告

### 第六步：更新 Memory

执行完成后，**必须更新 memory**：

```markdown
### 会话 N - YYYY-MM-DD（锐评执行）

**锐评来源**: 锐评XXX

**执行内容**:
1. [已完成的操作]
2. [已完成的操作]

**修改文件**:
- `path/to/file` - [操作说明]

**遗留问题**:
- [ ] [如果有]
```

---

## 锐评类型与处理方式

### 类型 A：分析型锐评

**特征**：对代码库进行深度分析，指出问题和风险
**处理**：
- 仔细阅读，理解问题本质
- 记录到 memory 作为技术债务清单
- 不需要立即执行，但需要规划

### 类型 B：指令型锐评

**特征**：给出具体的执行指令（删除、重命名、重构）
**处理**：
- 验证指令的可行性
- 检查依赖关系
- 有疑虑时必须中断并反馈
- 用户确认后按顺序执行

### 类型 C：混合型锐评

**特征**：既有分析也有指令
**处理**：
- 分析部分记录到 memory
- 指令部分按类型 B 处理

---

## 异议处理规范

### 何时提出异议

1. **指令涉及的文件不存在**
2. **删除操作会导致编译错误**（有代码依赖被删除的类）
3. **重命名操作会导致 Missing Script**
4. **指令与项目实际情况不符**
5. **指令之间存在矛盾**

### 如何提出异议

```markdown
## 🔴 异议：[简述问题]

**锐评指令**：[原文引用]

**我的发现**：
- [具体问题描述]
- [证据/代码引用]

**影响评估**：
- [如果执行会发生什么]

**我的建议**：
- [替代方案]

**请用户确认**：
1. [选项 A]
2. [选项 B]
```

---

## 汇报格式

### 战场完成汇报

```markdown
## 第 N 战场完成：[战场名称]

**Deleted**:
- `path/to/file1.cs`
- `path/to/file2.cs`

**Renamed**:
- `OldName.cs` → `NewName.cs`

**Refactored**:
- `GameInputManager.cs` - 修复引用
- `SomeEditor.cs` - 更新类名

**编译状态**: ✅ 成功 / ❌ 失败（原因）
```

### 全部完成汇报

```markdown
## 锐评执行完成

**执行时间**: YYYY-MM-DD
**锐评编号**: XXX

**总结**:
- 删除文件：N 个
- 重命名文件：N 个
- 修复引用：N 处

**验证状态**: ✅ 编译通过 / ⚠️ 需要用户验证

**下一步**:
- [建议的后续操作]
```

---

## 锐评事实核查规范（2026-02-09 新增）

### 核心原则

**锐评不是圣旨。** 外部架构师没有实时访问代码库的能力，其声明可能与代码事实不符。

### 强制事实核查清单

对于锐评中的每一条技术声明，必须执行以下核查：

| # | 核查项 | 方法 | 若不符 |
|---|--------|------|--------|
| 1 | **声称某功能不存在** | 在代码中搜索相关方法/类 | 标记为"事实错误" |
| 2 | **声称某文件需要修改** | 确认文件存在且内容匹配描述 | 标记为"信息过时" |
| 3 | **声称某架构缺陷** | 阅读实际代码验证 | 标记为"需要验证" |
| 4 | **提出的代码示例** | 检查是否与项目风格/API 匹配 | 标记为"不兼容" |
| 5 | **声称某系统的行为** | 运行或阅读代码确认实际行为 | 标记为"推测性声明" |

### 事实核查结果分类

| 分类 | 含义 | 处理方式 |
|------|------|---------|
| ✅ 事实正确 | 声明与代码一致 | 正常采纳 |
| ⚠️ 部分正确 | 核心观点对但细节有误 | 采纳核心，修正细节 |
| ❌ 事实错误 | 声明与代码不符 | 不采纳，记录到回应文档 |
| 🔍 推测性声明 | 无法从代码直接验证 | 标记为待验证，不盲目采纳 |

### 历史教训（从 9.0.4 锐评系列总结）

| 锐评 | 问题 | 教训 |
|------|------|------|
| 003 | "协程是唯一真理"过度绝对化 | 不接受绝对化表述 |
| 004 | 声称 Navigator 不支持回调（实际已有） | 必须验证代码再下结论 |
| 005 | 提出的方案已经存在于代码中 | 先搜索现有实现 |

---

## 锐评回应文档规范（2026-02-09 新增）

### 何时生成回应文档

**只有存在重大异议时才生成回应文档**（对应第四步路径 C）：

1. **事实错误** - 锐评中的技术声明与代码不符
2. **架构误解** - 锐评对项目架构的理解有偏差
3. **过度设计** - 锐评建议的方案复杂度远超问题本身
4. **遗漏关键信息** - 锐评没有考虑到项目的某些重要约束
5. **方向性分歧** - 锐评的战略方向与项目实际需求不一致

### 何时不生成回应文档

**完全认可或仅有小疑虑时，不生成回应文档**（对应第四步路径 A/B）：
- 事实核查全部通过 → 直接执行
- 核心观点正确、细节有小注意事项 → 对话中简述后直接执行
- **审视报告是异议工具，不是认可工具**

### 回应文档格式

```markdown
# 锐评回应：[锐评编号]

**回应日期**: YYYY-MM-DD
**锐评来源**: [锐评文件路径]

## 一、锐评核心观点摘要
[简述锐评的主要观点]

## 二、事实核查结果

| # | 锐评声明 | 代码事实 | 核查结论 |
|---|---------|---------|---------|
| 1 | [声明] | [事实] | ✅/⚠️/❌ |

## 三、认同的部分
[列出认同的观点及原因]

## 四、疑虑与异议
[列出不认同的观点及原因，附代码证据]

## 五、我的独立分析
[基于代码事实的独立分析]

## 六、建议的执行方向
[综合锐评和独立分析后的建议]

## 七、给 Gemini 的信息补充
[帮助 Gemini 更好理解项目的关键信息]
```

### 回应文档命名规范

- 格式：`锐评{编号}审视报告.md`
- 位置：与锐评文件同目录
- 示例：`锐评001审视报告.md`

---

## 锐评采纳决策矩阵（2026-02-09 新增）

### 决策流程

```
锐评观点
    ↓
事实核查
    ├─ ❌ 事实错误 → 不采纳，生成回应文档
    ├─ ⚠️ 部分正确 → 提取有价值部分，修正错误部分
    └─ ✅ 事实正确
        ↓
    评估实用性
        ├─ 过度设计 → 简化后采纳
        ├─ 与项目不匹配 → 不采纳，记录原因
        └─ 实用且匹配
            ↓
        评估优先级
            ├─ P0 → 立即执行
            ├─ P1 → 纳入当前迭代
            └─ P2+ → 记录为技术债务
```

### 采纳程度分级

| 级别 | 含义 | 行动 |
|------|------|------|
| 完全采纳 | 观点正确、方案实用、优先级匹配 | **不生成审视报告，直接执行**（路径 A） |
| 部分采纳 | 核心观点对但方案需调整 | 对话中简述注意事项后执行（路径 B） |
| 概念采纳 | 方向对但实现方式不同 | 对话中说明差异后执行（路径 B） |
| 记录不采纳 | 有价值但当前不适用 | 记录到 memory |
| 不采纳 | 事实错误或不适用 | **生成审视报告，中断等待确认**（路径 C） |

---

## 禁止事项

1. ❌ **不创建 memory 就开始执行**
2. ❌ **不阅读完整锐评就开始执行**
3. ❌ **不验证可行性就盲目执行**
4. ❌ **发现问题不中断继续执行**
5. ❌ **执行完成不更新 memory**
6. ❌ **跳过用户确认直接执行有风险的操作**（仅路径 C 需要确认）
7. ❌ **不进行事实核查就采纳锐评声明**（2026-02-09 新增）
8. ❌ **接受绝对化表述（"唯一真理"、"必须用XX"）**（2026-02-09 新增）
9. ❌ **完全认可时还生成审视报告文件中断会话**（2026-02-11 新增）
10. ❌ **有重大异议时不生成审视报告就忽略**（2026-02-11 修订）

---

## 检查清单

每次处理锐评时，必须确认：

- [ ] memory 文件已创建/更新
- [ ] 锐评已完整阅读
- [ ] **事实核查已完成**（2026-02-09 新增）
- [ ] 独立思考已完成
- [ ] **路径判断已完成（A/B/C）**（2026-02-11 新增）
- [ ] **路径 C 时：回应文档已生成，疑虑已向用户反馈**
- [ ] **路径 A/B 时：直接执行，不生成审视报告**（2026-02-11 新增）
- [ ] 执行过程已汇报
- [ ] memory 已更新执行结果

---

**文档维护者**: Kiro
**最后更新**: 2026-02-11
