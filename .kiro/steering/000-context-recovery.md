# ⚠️ 上下文恢复检查 - 最高优先级规则

---
inclusion: always
priority: -999
---

## ⛔ 停！在做任何事情之前，先执行这个检查！

**这是所有规则中优先级最高的规则。在响应用户之前，必须先完成以下检查。**

---

## 第一步：检测是否为继承对话

检查你的输入中是否存在以下任一标志：

| 标志 | 含义 |
|------|------|
| `Conversation Summary` | 对话已被压缩 |
| `对话摘要` | 对话已被压缩（中文） |
| `Conversation above has been summarized` | 系统提示对话已压缩 |
| 用户消息中包含文件路径但你没有完整的对话历史 | 继承的对话 |

**如果以上任一条件为真 → 执行第二步**
**如果全部为假 → 跳过此规则，正常响应**

---

## 第二步：强制输出任务回顾

**禁止**直接开始工作！**必须**先输出以下格式的回顾：

```
## 🔄 上下文恢复检查

我检测到这是继承自上一个对话的上下文，在继续工作前先回顾任务：

### 用户最近的核心要求
1. [从摘要中提取]
2. [如果有第二个任务]

### 关键约束
- [用户说过的限制]
- [用户纠正过的错误]

### 当前进度
- 已完成：[列出]
- 待完成：[列出]

### 请确认
以上理解是否正确？确认后我再继续工作。
```

---

## 第三步：等待用户确认

**在用户确认之前，不要开始执行任何任务。**

---

## 为什么这个规则如此重要？

1. 上下文压缩会丢失任务细节
2. 我可能基于错误的理解继续工作
3. 用户需要机会纠正我的理解
4. 这能避免浪费时间做错误的事情

---

## 违反此规则的后果

如果我跳过这个检查直接开始工作：
- 可能做错事情
- 浪费用户时间
- 需要返工
- 用户会不满意

---

## 检查清单

每次响应前：
- [ ] 检查是否为继承对话
- [ ] 如果是，输出任务回顾
- [ ] 等待用户确认
- [ ] 确认后才开始工作

---

## ⛔ 每次修改代码后必须执行！

**无论是否为继承对话，每次修改文件后，必须在回复末尾列出修改的文件。**

### 强制格式（Kiro 自动渲染为可点击链接）

**修改的文件**

- 文件路径1 - 简短说明
- 文件路径2 - 简短说明

### 关键规则

1. "修改的文件" 作为独立标题行（加粗，无冒号）
2. 每个文件路径直接写，不要用反引号包裹
3. Kiro 会自动识别文件路径并渲染为可点击链接

### 禁止

- ❌ 不列出修改的文件就结束回复
- ❌ 用反引号 ` 包裹文件路径
- ❌ 在"修改的文件"后加冒号
